{"file_contents":{"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 transition-all duration-150\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2415,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/pages/project-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useSearch } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ArrowLeft, Save, Loader2, Sparkles } from \"lucide-react\";\nimport type { Client } from \"@shared/schema\";\n\nconst projectFormSchema = z.object({\n  name: z.string().min(1, \"Nome do projeto é obrigatório\"),\n  description: z.string().optional(),\n  clientId: z.string().min(1, \"Selecione um cliente\"),\n  methodology: z.enum([\"scrum\", \"kanban\", \"waterfall\", \"hybrid\"]),\n});\n\ntype ProjectFormValues = z.infer<typeof projectFormSchema>;\n\nexport default function ProjectForm() {\n  const [, navigate] = useLocation();\n  const searchString = useSearch();\n  const searchParams = new URLSearchParams(searchString);\n  const preselectedClientId = searchParams.get(\"clientId\");\n  const { toast } = useToast();\n\n  const { data: clients, isLoading: clientsLoading } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const form = useForm<ProjectFormValues>({\n    resolver: zodResolver(projectFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      clientId: preselectedClientId || \"\",\n      methodology: \"hybrid\",\n    },\n  });\n\n  useEffect(() => {\n    if (preselectedClientId) {\n      form.setValue(\"clientId\", preselectedClientId);\n    }\n  }, [preselectedClientId, form]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: ProjectFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/projects\", data);\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\"] });\n      toast({\n        title: \"Projeto criado\",\n        description: \"Agora vamos iniciar o briefing inteligente.\",\n        variant: \"success\",\n      });\n      navigate(`/projects/${data.id}/briefing`);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível criar o projeto.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ProjectFormValues) => {\n    createMutation.mutate(data);\n  };\n\n  const methodologyOptions = [\n    { value: \"hybrid\", label: \"Híbrido (IA define)\" },\n    { value: \"scrum\", label: \"Scrum\" },\n    { value: \"kanban\", label: \"Kanban\" },\n    { value: \"waterfall\", label: \"Waterfall\" },\n  ];\n\n  return (\n    <div className=\"p-6 max-w-2xl mx-auto\">\n      <div className=\"mb-6\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => navigate(\"/\")}\n          className=\"mb-4\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          Voltar\n        </Button>\n        <div className=\"flex items-center gap-3 mb-2\">\n          <div className=\"p-2 rounded-lg bg-primary/10\">\n            <Sparkles className=\"w-5 h-5 text-primary\" />\n          </div>\n          <h1 className=\"text-2xl font-semibold text-foreground\">Novo Projeto</h1>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Crie um novo projeto e inicie o briefing inteligente com IA\n        </p>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Nome do Projeto *</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Ex: App de Delivery, Sistema de Gestão...\"\n                        {...field}\n                        data-testid=\"input-project-name\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Descrição Breve</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Uma breve descrição do projeto...\"\n                        className=\"min-h-[100px]\"\n                        {...field}\n                        data-testid=\"input-project-description\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"clientId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Cliente *</FormLabel>\n                    <Select\n                      onValueChange={field.onChange}\n                      value={field.value}\n                      disabled={clientsLoading}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-client\">\n                          <SelectValue placeholder=\"Selecione um cliente\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {clients?.map((client) => (\n                          <SelectItem key={client.id} value={client.id}>\n                            {client.name}\n                            {client.company && ` - ${client.company}`}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                    {(!clients || clients.length === 0) && !clientsLoading && (\n                      <p className=\"text-sm text-muted-foreground\">\n                        Nenhum cliente cadastrado.{\" \"}\n                        <button\n                          type=\"button\"\n                          onClick={() => navigate(\"/clients/new\")}\n                          className=\"text-primary hover:underline\"\n                        >\n                          Criar cliente primeiro\n                        </button>\n                      </p>\n                    )}\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"methodology\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Metodologia</FormLabel>\n                    <Select\n                      onValueChange={field.onChange}\n                      value={field.value}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-methodology\">\n                          <SelectValue placeholder=\"Selecione a metodologia\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {methodologyOptions.map((option) => (\n                          <SelectItem key={option.value} value={option.value}>\n                            {option.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex justify-end gap-4 pt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => navigate(\"/\")}\n                  data-testid=\"button-cancel\"\n                >\n                  Cancelar\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || !clients?.length}\n                  data-testid=\"button-create-project\"\n                >\n                  {createMutation.isPending ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Sparkles className=\"w-4 h-4 mr-2\" />\n                  )}\n                  Criar e Iniciar Briefing\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":9020,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertCircle, ArrowLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-background\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2 items-center\">\n            <AlertCircle className=\"h-8 w-8 text-destructive\" />\n            <h1 className=\"text-2xl font-bold text-foreground\">404 - Página não encontrada</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-muted-foreground\">\n            A página que você está procurando não existe ou foi movida.\n          </p>\n\n          <Link href=\"/\">\n            <Button className=\"mt-6\" data-testid=\"button-go-home\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Voltar ao início\n            </Button>\n          </Link>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50 transition-colors md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":863,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"server/storage.ts":{"content":"import {\n  users,\n  clients,\n  projects,\n  briefings,\n  scopes,\n  roadmaps,\n  stages,\n  tasks,\n  checklists,\n  documents,\n  aiCommands,\n  vaultItems,\n  mindMaps,\n  agentAnalyses,\n  orchestratorSessions,\n  projectMembers,\n  stageAssignments,\n  progressLogs,\n  projectInvites,\n  type User,\n  type UpsertUser,\n  type Client,\n  type InsertClient,\n  type Project,\n  type InsertProject,\n  type Briefing,\n  type InsertBriefing,\n  type Scope,\n  type InsertScope,\n  type Roadmap,\n  type InsertRoadmap,\n  type Stage,\n  type InsertStage,\n  type Task,\n  type InsertTask,\n  type Checklist,\n  type InsertChecklist,\n  type Document,\n  type InsertDocument,\n  type AiCommand,\n  type InsertAiCommand,\n  type VaultItem,\n  type InsertVaultItem,\n  type AgentAnalysis,\n  type InsertAgentAnalysis,\n  type OrchestratorSession,\n  type InsertOrchestratorSession,\n  type ProjectMember,\n  type InsertProjectMember,\n  type StageAssignment,\n  type InsertStageAssignment,\n  type ProgressLog,\n  type InsertProgressLog,\n  type ProjectInvite,\n  type InsertProjectInvite,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, desc, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: Omit<UpsertUser, \"id\">): Promise<User>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  updateUser(id: string, data: Partial<UpsertUser>): Promise<User | undefined>;\n\n  // Client operations\n  getClients(userId: string): Promise<Client[]>;\n  getClient(id: string): Promise<Client | undefined>;\n  createClient(data: InsertClient): Promise<Client>;\n  updateClient(id: string, data: Partial<InsertClient>): Promise<Client | undefined>;\n  deleteClient(id: string): Promise<boolean>;\n\n  // Project operations\n  getProjects(userId: string): Promise<Project[]>;\n  getProjectsByClient(clientId: string): Promise<Project[]>;\n  getProject(id: string): Promise<Project | undefined>;\n  createProject(data: InsertProject): Promise<Project>;\n  updateProject(id: string, data: Partial<InsertProject>): Promise<Project | undefined>;\n  deleteProject(id: string): Promise<boolean>;\n\n  // Briefing operations\n  getBriefing(projectId: string): Promise<Briefing | undefined>;\n  createBriefing(data: InsertBriefing): Promise<Briefing>;\n  updateBriefing(projectId: string, data: Partial<InsertBriefing>): Promise<Briefing | undefined>;\n\n  // Scope operations\n  getScope(projectId: string): Promise<Scope | undefined>;\n  createScope(data: InsertScope): Promise<Scope>;\n  updateScope(projectId: string, data: Partial<InsertScope>): Promise<Scope | undefined>;\n\n  // Roadmap operations\n  getRoadmap(projectId: string): Promise<Roadmap | undefined>;\n  createRoadmap(data: InsertRoadmap): Promise<Roadmap>;\n  updateRoadmap(projectId: string, data: Partial<InsertRoadmap>): Promise<Roadmap | undefined>;\n\n  // Stage operations\n  getStages(projectId: string): Promise<Stage[]>;\n  getStage(id: string): Promise<Stage | undefined>;\n  createStage(data: InsertStage): Promise<Stage>;\n  updateStage(id: string, data: Partial<InsertStage>): Promise<Stage | undefined>;\n  deleteStage(id: string): Promise<boolean>;\n\n  // Task operations\n  getTasks(stageId: string): Promise<Task[]>;\n  getTask(id: string): Promise<Task | undefined>;\n  createTask(data: InsertTask): Promise<Task>;\n  updateTask(id: string, data: Partial<InsertTask>): Promise<Task | undefined>;\n  deleteTask(id: string): Promise<boolean>;\n\n  // Checklist operations\n  getChecklists(projectId: string): Promise<Checklist[]>;\n  getChecklist(id: string): Promise<Checklist | undefined>;\n  createChecklist(data: InsertChecklist): Promise<Checklist>;\n  updateChecklist(id: string, data: Partial<InsertChecklist>): Promise<Checklist | undefined>;\n\n  // Document operations\n  getDocuments(projectId: string): Promise<Document[]>;\n  getDocument(id: string): Promise<Document | undefined>;\n  createDocument(data: InsertDocument): Promise<Document>;\n  updateDocument(id: string, data: Partial<InsertDocument>): Promise<Document | undefined>;\n\n  // AI Command operations\n  getAiCommand(projectId: string): Promise<AiCommand | undefined>;\n  createAiCommand(data: InsertAiCommand): Promise<AiCommand>;\n  updateAiCommand(id: string, data: Partial<InsertAiCommand>): Promise<AiCommand | undefined>;\n\n  // Vault operations\n  getVaultItems(projectId: string): Promise<VaultItem[]>;\n  getVaultItem(id: string): Promise<VaultItem | undefined>;\n  createVaultItem(data: InsertVaultItem): Promise<VaultItem>;\n  updateVaultItem(id: string, data: Partial<InsertVaultItem>): Promise<VaultItem | undefined>;\n  deleteVaultItem(id: string): Promise<boolean>;\n\n  // Agent Analysis operations\n  getAgentAnalyses(projectId: string): Promise<AgentAnalysis[]>;\n  getAgentAnalysis(id: string): Promise<AgentAnalysis | undefined>;\n  getAgentAnalysisByType(projectId: string, agentType: string): Promise<AgentAnalysis | undefined>;\n  createAgentAnalysis(data: InsertAgentAnalysis): Promise<AgentAnalysis>;\n  updateAgentAnalysis(id: string, data: Partial<InsertAgentAnalysis>): Promise<AgentAnalysis | undefined>;\n  deleteAgentAnalysis(id: string): Promise<boolean>;\n\n  // Orchestrator Session operations\n  getOrchestratorSessions(projectId: string): Promise<OrchestratorSession[]>;\n  getOrchestratorSession(id: string): Promise<OrchestratorSession | undefined>;\n  createOrchestratorSession(data: InsertOrchestratorSession): Promise<OrchestratorSession>;\n  updateOrchestratorSession(id: string, data: Partial<OrchestratorSession>): Promise<OrchestratorSession | undefined>;\n\n  // Project Member operations\n  getProjectMembers(projectId: string): Promise<ProjectMember[]>;\n  getProjectMember(id: string): Promise<ProjectMember | undefined>;\n  getProjectMemberByEmail(projectId: string, email: string): Promise<ProjectMember | undefined>;\n  getProjectMemberByUserId(projectId: string, userId: string): Promise<ProjectMember | undefined>;\n  getProjectsByMemberUserId(userId: string): Promise<Project[]>;\n  createProjectMember(data: InsertProjectMember): Promise<ProjectMember>;\n  updateProjectMember(id: string, data: Partial<InsertProjectMember>): Promise<ProjectMember | undefined>;\n  deleteProjectMember(id: string): Promise<boolean>;\n\n  // Stage Assignment operations\n  getStageAssignments(stageId: string): Promise<StageAssignment[]>;\n  getStageAssignment(id: string): Promise<StageAssignment | undefined>;\n  getAssignmentsByMember(memberId: string): Promise<StageAssignment[]>;\n  createStageAssignment(data: InsertStageAssignment): Promise<StageAssignment>;\n  deleteStageAssignment(id: string): Promise<boolean>;\n\n  // Progress Log operations\n  getProgressLogs(stageId: string): Promise<ProgressLog[]>;\n  createProgressLog(data: InsertProgressLog): Promise<ProgressLog>;\n\n  // Project Invite operations\n  getInviteByToken(token: string): Promise<ProjectInvite | undefined>;\n  createInvite(data: InsertProjectInvite): Promise<ProjectInvite>;\n  acceptInvite(token: string): Promise<ProjectInvite | undefined>;\n  expireInvite(id: string): Promise<boolean>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async createUser(userData: Omit<UpsertUser, \"id\">): Promise<User> {\n    const [user] = await db.insert(users).values(userData).returning();\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async updateUser(id: string, data: Partial<UpsertUser>): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  // Client operations\n  async getClients(userId: string): Promise<Client[]> {\n    return db.select().from(clients).where(eq(clients.userId, userId)).orderBy(desc(clients.createdAt));\n  }\n\n  async getClient(id: string): Promise<Client | undefined> {\n    const [client] = await db.select().from(clients).where(eq(clients.id, id));\n    return client;\n  }\n\n  async createClient(data: InsertClient): Promise<Client> {\n    const [client] = await db.insert(clients).values(data).returning();\n    return client;\n  }\n\n  async updateClient(id: string, data: Partial<InsertClient>): Promise<Client | undefined> {\n    const [client] = await db\n      .update(clients)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(clients.id, id))\n      .returning();\n    return client;\n  }\n\n  async deleteClient(id: string): Promise<boolean> {\n    const result = await db.delete(clients).where(eq(clients.id, id));\n    return true;\n  }\n\n  // Project operations\n  async getProjects(userId: string): Promise<Project[]> {\n    return db.select().from(projects).where(eq(projects.userId, userId)).orderBy(desc(projects.createdAt));\n  }\n\n  async getProjectsByClient(clientId: string): Promise<Project[]> {\n    return db.select().from(projects).where(eq(projects.clientId, clientId));\n  }\n\n  async getProject(id: string): Promise<Project | undefined> {\n    const [project] = await db.select().from(projects).where(eq(projects.id, id));\n    return project;\n  }\n\n  async createProject(data: InsertProject): Promise<Project> {\n    const [project] = await db.insert(projects).values(data).returning();\n    return project;\n  }\n\n  async updateProject(id: string, data: Partial<InsertProject>): Promise<Project | undefined> {\n    const [project] = await db\n      .update(projects)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(projects.id, id))\n      .returning();\n    return project;\n  }\n\n  async deleteProject(id: string): Promise<boolean> {\n    await db.delete(orchestratorSessions).where(eq(orchestratorSessions.projectId, id));\n    await db.delete(agentAnalyses).where(eq(agentAnalyses.projectId, id));\n    await db.delete(mindMaps).where(eq(mindMaps.projectId, id));\n    await db.delete(vaultItems).where(eq(vaultItems.projectId, id));\n    await db.delete(aiCommands).where(eq(aiCommands.projectId, id));\n    await db.delete(documents).where(eq(documents.projectId, id));\n    await db.delete(checklists).where(eq(checklists.projectId, id));\n    const projectStages = await db.select().from(stages).where(eq(stages.projectId, id));\n    for (const stage of projectStages) {\n      await db.delete(tasks).where(eq(tasks.stageId, stage.id));\n    }\n    await db.delete(stages).where(eq(stages.projectId, id));\n    await db.delete(roadmaps).where(eq(roadmaps.projectId, id));\n    await db.delete(scopes).where(eq(scopes.projectId, id));\n    await db.delete(briefings).where(eq(briefings.projectId, id));\n    await db.delete(projects).where(eq(projects.id, id));\n    return true;\n  }\n\n  // Briefing operations\n  async getBriefing(projectId: string): Promise<Briefing | undefined> {\n    const [briefing] = await db.select().from(briefings).where(eq(briefings.projectId, projectId));\n    return briefing;\n  }\n\n  async createBriefing(data: InsertBriefing): Promise<Briefing> {\n    const [briefing] = await db.insert(briefings).values(data).returning();\n    return briefing;\n  }\n\n  async updateBriefing(projectId: string, data: Partial<InsertBriefing>): Promise<Briefing | undefined> {\n    const [briefing] = await db\n      .update(briefings)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(briefings.projectId, projectId))\n      .returning();\n    return briefing;\n  }\n\n  // Scope operations\n  async getScope(projectId: string): Promise<Scope | undefined> {\n    const [scope] = await db.select().from(scopes).where(eq(scopes.projectId, projectId));\n    return scope;\n  }\n\n  async createScope(data: InsertScope): Promise<Scope> {\n    const [scope] = await db.insert(scopes).values(data).returning();\n    return scope;\n  }\n\n  async updateScope(projectId: string, data: Partial<InsertScope>): Promise<Scope | undefined> {\n    const [scope] = await db\n      .update(scopes)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(scopes.projectId, projectId))\n      .returning();\n    return scope;\n  }\n\n  // Roadmap operations\n  async getRoadmap(projectId: string): Promise<Roadmap | undefined> {\n    const [roadmap] = await db.select().from(roadmaps).where(eq(roadmaps.projectId, projectId));\n    return roadmap;\n  }\n\n  async createRoadmap(data: InsertRoadmap): Promise<Roadmap> {\n    const [roadmap] = await db.insert(roadmaps).values(data).returning();\n    return roadmap;\n  }\n\n  async updateRoadmap(projectId: string, data: Partial<InsertRoadmap>): Promise<Roadmap | undefined> {\n    const [roadmap] = await db\n      .update(roadmaps)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(roadmaps.projectId, projectId))\n      .returning();\n    return roadmap;\n  }\n\n  // Stage operations\n  async getStages(projectId: string): Promise<Stage[]> {\n    return db.select().from(stages).where(eq(stages.projectId, projectId));\n  }\n\n  async getStage(id: string): Promise<Stage | undefined> {\n    const [stage] = await db.select().from(stages).where(eq(stages.id, id));\n    return stage;\n  }\n\n  async createStage(data: InsertStage): Promise<Stage> {\n    const [stage] = await db.insert(stages).values(data).returning();\n    return stage;\n  }\n\n  async updateStage(id: string, data: Partial<InsertStage>): Promise<Stage | undefined> {\n    const [stage] = await db\n      .update(stages)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(stages.id, id))\n      .returning();\n    return stage;\n  }\n\n  async deleteStage(id: string): Promise<boolean> {\n    await db.delete(stages).where(eq(stages.id, id));\n    return true;\n  }\n\n  // Task operations\n  async getTasks(stageId: string): Promise<Task[]> {\n    return db.select().from(tasks).where(eq(tasks.stageId, stageId));\n  }\n\n  async getTask(id: string): Promise<Task | undefined> {\n    const [task] = await db.select().from(tasks).where(eq(tasks.id, id));\n    return task;\n  }\n\n  async createTask(data: InsertTask): Promise<Task> {\n    const [task] = await db.insert(tasks).values(data).returning();\n    return task;\n  }\n\n  async updateTask(id: string, data: Partial<InsertTask>): Promise<Task | undefined> {\n    const [task] = await db\n      .update(tasks)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(tasks.id, id))\n      .returning();\n    return task;\n  }\n\n  async deleteTask(id: string): Promise<boolean> {\n    await db.delete(tasks).where(eq(tasks.id, id));\n    return true;\n  }\n\n  // Checklist operations\n  async getChecklists(projectId: string): Promise<Checklist[]> {\n    return db.select().from(checklists).where(eq(checklists.projectId, projectId));\n  }\n\n  async getChecklist(id: string): Promise<Checklist | undefined> {\n    const [checklist] = await db.select().from(checklists).where(eq(checklists.id, id));\n    return checklist;\n  }\n\n  async createChecklist(data: InsertChecklist): Promise<Checklist> {\n    const [checklist] = await db.insert(checklists).values(data).returning();\n    return checklist;\n  }\n\n  async updateChecklist(id: string, data: Partial<InsertChecklist>): Promise<Checklist | undefined> {\n    const [checklist] = await db\n      .update(checklists)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(checklists.id, id))\n      .returning();\n    return checklist;\n  }\n\n  // Document operations\n  async getDocuments(projectId: string): Promise<Document[]> {\n    return db.select().from(documents).where(eq(documents.projectId, projectId));\n  }\n\n  async getDocument(id: string): Promise<Document | undefined> {\n    const [document] = await db.select().from(documents).where(eq(documents.id, id));\n    return document;\n  }\n\n  async createDocument(data: InsertDocument): Promise<Document> {\n    const [document] = await db.insert(documents).values(data).returning();\n    return document;\n  }\n\n  async updateDocument(id: string, data: Partial<InsertDocument>): Promise<Document | undefined> {\n    const [document] = await db\n      .update(documents)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(documents.id, id))\n      .returning();\n    return document;\n  }\n\n  // AI Command operations\n  async getAiCommand(projectId: string): Promise<AiCommand | undefined> {\n    const [command] = await db.select().from(aiCommands).where(eq(aiCommands.projectId, projectId));\n    return command;\n  }\n\n  async createAiCommand(data: InsertAiCommand): Promise<AiCommand> {\n    const [command] = await db.insert(aiCommands).values(data).returning();\n    return command;\n  }\n\n  async updateAiCommand(id: string, data: Partial<InsertAiCommand>): Promise<AiCommand | undefined> {\n    const [command] = await db\n      .update(aiCommands)\n      .set(data)\n      .where(eq(aiCommands.id, id))\n      .returning();\n    return command;\n  }\n\n  // Vault operations\n  async getVaultItems(projectId: string): Promise<VaultItem[]> {\n    return db.select().from(vaultItems).where(eq(vaultItems.projectId, projectId)).orderBy(desc(vaultItems.createdAt));\n  }\n\n  async getVaultItem(id: string): Promise<VaultItem | undefined> {\n    const [item] = await db.select().from(vaultItems).where(eq(vaultItems.id, id));\n    return item;\n  }\n\n  async createVaultItem(data: InsertVaultItem): Promise<VaultItem> {\n    const [item] = await db.insert(vaultItems).values(data).returning();\n    return item;\n  }\n\n  async updateVaultItem(id: string, data: Partial<InsertVaultItem>): Promise<VaultItem | undefined> {\n    const [item] = await db\n      .update(vaultItems)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(vaultItems.id, id))\n      .returning();\n    return item;\n  }\n\n  async deleteVaultItem(id: string): Promise<boolean> {\n    const result = await db.delete(vaultItems).where(eq(vaultItems.id, id));\n    return true;\n  }\n\n  // Agent Analysis operations\n  async getAgentAnalyses(projectId: string): Promise<AgentAnalysis[]> {\n    return db.select().from(agentAnalyses).where(eq(agentAnalyses.projectId, projectId)).orderBy(desc(agentAnalyses.createdAt));\n  }\n\n  async getAgentAnalysis(id: string): Promise<AgentAnalysis | undefined> {\n    const [analysis] = await db.select().from(agentAnalyses).where(eq(agentAnalyses.id, id));\n    return analysis;\n  }\n\n  async getAgentAnalysisByType(projectId: string, agentType: string): Promise<AgentAnalysis | undefined> {\n    const [analysis] = await db\n      .select()\n      .from(agentAnalyses)\n      .where(and(eq(agentAnalyses.projectId, projectId), eq(agentAnalyses.agentType, agentType)))\n      .orderBy(desc(agentAnalyses.createdAt));\n    return analysis;\n  }\n\n  async createAgentAnalysis(data: InsertAgentAnalysis): Promise<AgentAnalysis> {\n    const [analysis] = await db.insert(agentAnalyses).values(data).returning();\n    return analysis;\n  }\n\n  async updateAgentAnalysis(id: string, data: Partial<InsertAgentAnalysis>): Promise<AgentAnalysis | undefined> {\n    const [analysis] = await db\n      .update(agentAnalyses)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(agentAnalyses.id, id))\n      .returning();\n    return analysis;\n  }\n\n  async deleteAgentAnalysis(id: string): Promise<boolean> {\n    await db.delete(agentAnalyses).where(eq(agentAnalyses.id, id));\n    return true;\n  }\n\n  // Orchestrator Session operations\n  async getOrchestratorSessions(projectId: string): Promise<OrchestratorSession[]> {\n    return db.select().from(orchestratorSessions).where(eq(orchestratorSessions.projectId, projectId)).orderBy(desc(orchestratorSessions.createdAt));\n  }\n\n  async getOrchestratorSession(id: string): Promise<OrchestratorSession | undefined> {\n    const [session] = await db.select().from(orchestratorSessions).where(eq(orchestratorSessions.id, id));\n    return session;\n  }\n\n  async createOrchestratorSession(data: InsertOrchestratorSession): Promise<OrchestratorSession> {\n    const [session] = await db.insert(orchestratorSessions).values(data).returning();\n    return session;\n  }\n\n  async updateOrchestratorSession(id: string, data: Partial<OrchestratorSession>): Promise<OrchestratorSession | undefined> {\n    const [session] = await db\n      .update(orchestratorSessions)\n      .set(data)\n      .where(eq(orchestratorSessions.id, id))\n      .returning();\n    return session;\n  }\n\n  // Project Member operations\n  async getProjectMembers(projectId: string): Promise<ProjectMember[]> {\n    return db.select().from(projectMembers).where(eq(projectMembers.projectId, projectId)).orderBy(desc(projectMembers.createdAt));\n  }\n\n  async getProjectMember(id: string): Promise<ProjectMember | undefined> {\n    const [member] = await db.select().from(projectMembers).where(eq(projectMembers.id, id));\n    return member;\n  }\n\n  async getProjectMemberByEmail(projectId: string, email: string): Promise<ProjectMember | undefined> {\n    const [member] = await db.select().from(projectMembers).where(\n      and(eq(projectMembers.projectId, projectId), eq(projectMembers.email, email))\n    );\n    return member;\n  }\n\n  async getProjectMemberByUserId(projectId: string, userId: string): Promise<ProjectMember | undefined> {\n    const [member] = await db.select().from(projectMembers).where(\n      and(eq(projectMembers.projectId, projectId), eq(projectMembers.userId, userId))\n    );\n    return member;\n  }\n\n  async getProjectsByMemberUserId(userId: string): Promise<Project[]> {\n    const memberProjects = await db\n      .select({ projectId: projectMembers.projectId })\n      .from(projectMembers)\n      .where(eq(projectMembers.userId, userId));\n    \n    if (memberProjects.length === 0) return [];\n    \n    const projectIds = memberProjects.map(m => m.projectId);\n    const result: Project[] = [];\n    for (const projectId of projectIds) {\n      const [project] = await db.select().from(projects).where(eq(projects.id, projectId));\n      if (project) result.push(project);\n    }\n    return result;\n  }\n\n  async createProjectMember(data: InsertProjectMember): Promise<ProjectMember> {\n    const [member] = await db.insert(projectMembers).values(data).returning();\n    return member;\n  }\n\n  async updateProjectMember(id: string, data: Partial<InsertProjectMember>): Promise<ProjectMember | undefined> {\n    const [member] = await db\n      .update(projectMembers)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(projectMembers.id, id))\n      .returning();\n    return member;\n  }\n\n  async deleteProjectMember(id: string): Promise<boolean> {\n    await db.delete(stageAssignments).where(eq(stageAssignments.memberId, id));\n    await db.delete(projectInvites).where(eq(projectInvites.memberId, id));\n    await db.delete(projectMembers).where(eq(projectMembers.id, id));\n    return true;\n  }\n\n  // Stage with assignments helper\n  async getStagesWithAssignments(projectId: string): Promise<any[]> {\n    const projectStages = await db.select().from(stages).where(eq(stages.projectId, projectId));\n    if (projectStages.length === 0) return [];\n\n    const stageIds = projectStages.map(s => s.id);\n    const allAssignments = await db.select().from(stageAssignments).where(\n      sql`${stageAssignments.stageId} IN (${sql.join(stageIds.map(id => sql`${id}`), sql`, `)})`\n    );\n    \n    const memberIds = [...new Set(allAssignments.map(a => a.memberId))];\n    let membersMap: Record<string, any> = {};\n    if (memberIds.length > 0) {\n      const membersResult = await db.select().from(projectMembers).where(\n        sql`${projectMembers.id} IN (${sql.join(memberIds.map(id => sql`${id}`), sql`, `)})`\n      );\n      membersMap = Object.fromEntries(membersResult.map(m => [m.id, m]));\n    }\n    \n    return projectStages.map(stage => ({\n      ...stage,\n      assignments: allAssignments\n        .filter(a => a.stageId === stage.id && membersMap[a.memberId])\n        .map(a => ({ ...a, member: membersMap[a.memberId] }))\n    }));\n  }\n\n  // Stage Assignment operations\n  async getStageAssignments(stageId: string): Promise<StageAssignment[]> {\n    return db.select().from(stageAssignments).where(eq(stageAssignments.stageId, stageId));\n  }\n\n  async getStageAssignment(id: string): Promise<StageAssignment | undefined> {\n    const [assignment] = await db.select().from(stageAssignments).where(eq(stageAssignments.id, id));\n    return assignment;\n  }\n\n  async getAssignmentsByMember(memberId: string): Promise<StageAssignment[]> {\n    return db.select().from(stageAssignments).where(eq(stageAssignments.memberId, memberId));\n  }\n\n  async createStageAssignment(data: InsertStageAssignment): Promise<StageAssignment> {\n    const [assignment] = await db.insert(stageAssignments).values(data).returning();\n    return assignment;\n  }\n\n  async deleteStageAssignment(id: string): Promise<boolean> {\n    await db.delete(stageAssignments).where(eq(stageAssignments.id, id));\n    return true;\n  }\n\n  // Progress Log operations\n  async getProgressLogs(stageId: string): Promise<ProgressLog[]> {\n    return db.select().from(progressLogs).where(eq(progressLogs.stageId, stageId)).orderBy(desc(progressLogs.createdAt));\n  }\n\n  async createProgressLog(data: InsertProgressLog): Promise<ProgressLog> {\n    const [log] = await db.insert(progressLogs).values(data).returning();\n    return log;\n  }\n\n  // Project Invite operations\n  async getInviteByToken(token: string): Promise<ProjectInvite | undefined> {\n    const [invite] = await db.select().from(projectInvites).where(eq(projectInvites.token, token));\n    return invite;\n  }\n\n  async createInvite(data: InsertProjectInvite): Promise<ProjectInvite> {\n    const [invite] = await db.insert(projectInvites).values(data).returning();\n    return invite;\n  }\n\n  async acceptInvite(token: string): Promise<ProjectInvite | undefined> {\n    const [invite] = await db\n      .update(projectInvites)\n      .set({ status: \"accepted\", acceptedAt: new Date() })\n      .where(eq(projectInvites.token, token))\n      .returning();\n    return invite;\n  }\n\n  async expireInvite(id: string): Promise<boolean> {\n    await db.update(projectInvites).set({ status: \"expired\" }).where(eq(projectInvites.id, id));\n    return true;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":26374,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n  SidebarMenuSub,\n  SidebarMenuSubItem,\n  SidebarMenuSubButton,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport {\n  LayoutDashboard,\n  Users,\n  FolderKanban,\n  Columns3,\n  Plus,\n  ChevronRight,\n  Settings,\n  LogOut,\n  Brain,\n  ListChecks,\n} from \"lucide-react\";\nimport type { Client, Project } from \"@shared/schema\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { useState } from \"react\";\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  const [expandedClients, setExpandedClients] = useState<Set<string>>(new Set());\n\n  const { data: clients } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const { data: projects } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const toggleClient = (clientId: string) => {\n    setExpandedClients((prev) => {\n      const next = new Set(prev);\n      if (next.has(clientId)) {\n        next.delete(clientId);\n      } else {\n        next.add(clientId);\n      }\n      return next;\n    });\n  };\n\n  const getClientProjects = (clientId: string) => {\n    return projects?.filter((p) => p.clientId === clientId) || [];\n  };\n\n  const getInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4 border-b border-sidebar-border\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex items-center justify-center w-10 h-10 rounded-lg bg-primary text-primary-foreground\">\n            <Brain className=\"w-5 h-5\" />\n          </div>\n          <div className=\"flex flex-col\">\n            <span className=\"font-semibold text-sidebar-foreground\">Project AI</span>\n            <span className=\"text-xs text-muted-foreground\">Gestão Inteligente</span>\n          </div>\n        </div>\n      </SidebarHeader>\n\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              <SidebarMenuItem>\n                <SidebarMenuButton\n                  asChild\n                  isActive={location === \"/\" || location === \"/dashboard\"}\n                  data-testid=\"nav-dashboard\"\n                >\n                  <Link href=\"/\">\n                    <LayoutDashboard className=\"w-4 h-4\" />\n                    <span>Dashboard</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n              <SidebarMenuItem>\n                <SidebarMenuButton\n                  asChild\n                  isActive={location === \"/my-tasks\"}\n                  data-testid=\"nav-my-tasks\"\n                >\n                  <Link href=\"/my-tasks\">\n                    <ListChecks className=\"w-4 h-4\" />\n                    <span>Minhas Tarefas</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n              <SidebarMenuItem>\n                <SidebarMenuButton\n                  asChild\n                  isActive={location === \"/kanban\"}\n                  data-testid=\"nav-kanban\"\n                >\n                  <Link href=\"/kanban\">\n                    <Columns3 className=\"w-4 h-4\" />\n                    <span>Kanban</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"flex items-center justify-between\">\n            <span>Clientes</span>\n            <Link href=\"/clients/new\">\n              <Button variant=\"ghost\" size=\"icon\" className=\"w-6 h-6\" data-testid=\"button-add-client\">\n                <Plus className=\"w-3 h-3\" />\n              </Button>\n            </Link>\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {clients?.map((client) => (\n                <Collapsible\n                  key={client.id}\n                  open={expandedClients.has(client.id)}\n                  onOpenChange={() => toggleClient(client.id)}\n                >\n                  <SidebarMenuItem>\n                    <CollapsibleTrigger asChild>\n                      <SidebarMenuButton\n                        isActive={location === `/clients/${client.id}`}\n                        data-testid={`nav-client-${client.id}`}\n                      >\n                        <Avatar className=\"w-5 h-5\">\n                          <AvatarFallback className=\"text-[10px]\">\n                            {getInitials(client.name)}\n                          </AvatarFallback>\n                        </Avatar>\n                        <span className=\"flex-1 truncate\">{client.name}</span>\n                        <ChevronRight\n                          className={`w-4 h-4 transition-transform ${\n                            expandedClients.has(client.id) ? \"rotate-90\" : \"\"\n                          }`}\n                        />\n                      </SidebarMenuButton>\n                    </CollapsibleTrigger>\n                    <CollapsibleContent>\n                      <SidebarMenuSub>\n                        {getClientProjects(client.id).map((project) => (\n                          <SidebarMenuSubItem key={project.id}>\n                            <SidebarMenuSubButton\n                              asChild\n                              isActive={location === `/projects/${project.id}`}\n                              data-testid={`nav-project-${project.id}`}\n                            >\n                              <Link href={`/projects/${project.id}`}>\n                                <FolderKanban className=\"w-3 h-3\" />\n                                <span className=\"truncate\">{project.name}</span>\n                              </Link>\n                            </SidebarMenuSubButton>\n                          </SidebarMenuSubItem>\n                        ))}\n                        <SidebarMenuSubItem>\n                          <SidebarMenuSubButton asChild data-testid={`button-new-project-${client.id}`}>\n                            <Link href={`/projects/new?clientId=${client.id}`}>\n                              <Plus className=\"w-3 h-3\" />\n                              <span>Novo Projeto</span>\n                            </Link>\n                          </SidebarMenuSubButton>\n                        </SidebarMenuSubItem>\n                      </SidebarMenuSub>\n                    </CollapsibleContent>\n                  </SidebarMenuItem>\n                </Collapsible>\n              ))}\n              {(!clients || clients.length === 0) && (\n                <SidebarMenuItem>\n                  <SidebarMenuButton asChild data-testid=\"nav-clients-empty\">\n                    <Link href=\"/clients/new\">\n                      <Users className=\"w-4 h-4\" />\n                      <span className=\"text-muted-foreground\">Adicionar primeiro cliente</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              )}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4 border-t border-sidebar-border\">\n        <div className=\"flex items-center gap-3\">\n          <Avatar className=\"w-8 h-8\">\n            <AvatarImage src={user?.profileImageUrl || undefined} className=\"object-cover\" />\n            <AvatarFallback>\n              {user?.firstName?.[0] || user?.email?.[0]?.toUpperCase() || \"U\"}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm font-medium truncate text-sidebar-foreground\">\n              {user?.firstName || user?.email?.split(\"@\")[0] || \"Usuario\"}\n            </p>\n            <p className=\"text-xs truncate text-muted-foreground\">{user?.email}</p>\n          </div>\n          <a href=\"/api/logout\">\n            <Button variant=\"ghost\" size=\"icon\" className=\"w-8 h-8\" data-testid=\"button-logout\">\n              <LogOut className=\"w-4 h-4\" />\n            </Button>\n          </a>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":8684,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE - Clean modern design with white, blue and light gray */\n:root {\n  --button-outline: rgba(0,0,0, .08);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -6;\n  --elevate-1: rgba(0,0,0, .04);\n  --elevate-2: rgba(0,0,0, .08);\n  \n  /* Background: Pure white with subtle gray tint */\n  --background: 220 20% 98%;\n  --foreground: 220 25% 10%;\n  \n  /* Borders: Light gray */\n  --border: 220 13% 91%;\n  \n  /* Cards: White with subtle shadow feel */\n  --card: 0 0% 100%;\n  --card-foreground: 220 25% 20%;\n  --card-border: 220 13% 91%;\n  \n  /* Sidebar: Light grayish-blue */\n  --sidebar: 220 20% 97%;\n  --sidebar-foreground: 220 25% 20%;\n  --sidebar-border: 220 13% 91%;\n  --sidebar-primary: 220 90% 56%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 60% 96%;\n  --sidebar-accent-foreground: 220 90% 50%;\n  --sidebar-ring: 220 90% 56%;\n  \n  /* Popover: White */\n  --popover: 0 0% 100%;\n  --popover-foreground: 220 25% 15%;\n  --popover-border: 220 13% 91%;\n  \n  /* Primary: Modern blue (like reference images) */\n  --primary: 220 90% 56%;\n  --primary-foreground: 0 0% 100%;\n  \n  /* Secondary: Light grayish-blue */\n  --secondary: 220 14% 96%;\n  --secondary-foreground: 220 25% 20%;\n  \n  /* Muted: Soft gray */\n  --muted: 220 14% 96%;\n  --muted-foreground: 220 10% 46%;\n  \n  /* Accent: Light blue tint */\n  --accent: 220 60% 96%;\n  --accent-foreground: 220 90% 50%;\n  \n  /* Destructive: Red */\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  \n  /* Input: Light gray border */\n  --input: 220 13% 91%;\n  --ring: 220 90% 56%;\n  \n  /* Chart colors */\n  --chart-1: 220 90% 56%;\n  --chart-2: 160 84% 39%;\n  --chart-3: 43 96% 56%;\n  --chart-4: 280 65% 60%;\n  --chart-5: 340 75% 55%;\n  \n  /* Typography */\n  --font-sans: 'Inter', 'Segoe UI', system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: 'JetBrains Mono', Menlo, monospace;\n  \n  /* Border radius - rounded modern look */\n  --radius: 0.75rem;\n  \n  /* Shadows - subtle and modern */\n  --shadow-2xs: 0 1px 2px 0 rgba(0, 0, 0, 0.03);\n  --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);\n  --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.08), 0 1px 2px -1px rgba(0, 0, 0, 0.05);\n  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -2px rgba(0, 0, 0, 0.05);\n  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);\n  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);\n  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05);\n  --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.15);\n  \n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Border calculations for buttons */\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)));\n}\n\n/* DARK MODE - Modern dark with clean appearance */\n.dark {\n  --button-outline: rgba(255,255,255, .12);\n  --badge-outline: rgba(255,255,255, .06);\n  --opaque-button-border-intensity: 10;\n  --elevate-1: rgba(255,255,255, .05);\n  --elevate-2: rgba(255,255,255, .10);\n  \n  /* Background: Deep dark */\n  --background: 0 0% 4%;\n  --foreground: 0 0% 95%;\n  \n  /* Borders: Subtle dark gray */\n  --border: 0 0% 14%;\n  \n  /* Cards: Slightly elevated dark */\n  --card: 0 0% 8%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 0 0% 14%;\n  \n  /* Sidebar: Dark with subtle blue tint */\n  --sidebar: 220 10% 8%;\n  --sidebar-foreground: 0 0% 90%;\n  --sidebar-border: 0 0% 14%;\n  --sidebar-primary: 220 90% 60%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 40% 15%;\n  --sidebar-accent-foreground: 220 90% 70%;\n  --sidebar-ring: 220 90% 60%;\n  \n  /* Popover: Dark elevated */\n  --popover: 0 0% 6%;\n  --popover-foreground: 0 0% 95%;\n  --popover-border: 0 0% 14%;\n  \n  /* Primary: Bright blue */\n  --primary: 220 90% 60%;\n  --primary-foreground: 0 0% 100%;\n  \n  /* Secondary: Muted dark */\n  --secondary: 0 0% 14%;\n  --secondary-foreground: 0 0% 95%;\n  \n  /* Muted: Dark gray */\n  --muted: 0 0% 12%;\n  --muted-foreground: 0 0% 55%;\n  \n  /* Accent: Blue tinted dark */\n  --accent: 220 40% 15%;\n  --accent-foreground: 220 90% 70%;\n  \n  /* Destructive: Red */\n  --destructive: 0 75% 55%;\n  --destructive-foreground: 0 0% 100%;\n  \n  /* Input */\n  --input: 0 0% 18%;\n  --ring: 220 90% 60%;\n  \n  /* Chart colors */\n  --chart-1: 220 90% 60%;\n  --chart-2: 160 80% 45%;\n  --chart-3: 43 90% 55%;\n  --chart-4: 280 65% 60%;\n  --chart-5: 340 70% 55%;\n  \n  /* Shadows - subtle glow for dark mode */\n  --shadow-2xs: 0 1px 2px 0 rgba(0, 0, 0, 0.4);\n  --shadow-xs: 0 1px 3px 0 rgba(0, 0, 0, 0.5);\n  --shadow-sm: 0 2px 4px 0 rgba(0, 0, 0, 0.5), 0 1px 2px -1px rgba(0, 0, 0, 0.4);\n  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -2px rgba(0, 0, 0, 0.4);\n  --shadow-md: 0 6px 8px -2px rgba(0, 0, 0, 0.5), 0 4px 6px -4px rgba(0, 0, 0, 0.4);\n  --shadow-lg: 0 12px 20px -4px rgba(0, 0, 0, 0.6), 0 6px 8px -6px rgba(0, 0, 0, 0.5);\n  --shadow-xl: 0 20px 30px -6px rgba(0, 0, 0, 0.6), 0 10px 12px -8px rgba(0, 0, 0, 0.5);\n  --shadow-2xl: 0 30px 50px -12px rgba(0, 0, 0, 0.7);\n  \n  --radius: 0.75rem;\n  --spacing: 0.25rem;\n  --font-mono: 'JetBrains Mono', Menlo, monospace;\n  --font-sans: 'Inter', 'Segoe UI', system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --tracking-normal: 0em;\n\n  /* Border calculations for buttons */\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)));\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n  \n  /* Smooth transitions for theme switching */\n  body, .dark {\n    transition: background-color 0.2s ease, color 0.2s ease;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: -1;\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: 999;\n    transition: background-color 0.15s ease;\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n\n/* Custom scrollbar styling */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: hsl(var(--muted));\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: hsl(var(--muted-foreground) / 0.3);\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: hsl(var(--muted-foreground) / 0.5);\n}\n\n.dark ::-webkit-scrollbar-track {\n  background: hsl(220 13% 20%);\n}\n\n.dark ::-webkit-scrollbar-thumb {\n  background: hsl(220 13% 35%);\n}\n\n.dark ::-webkit-scrollbar-thumb:hover {\n  background: hsl(220 13% 45%);\n}\n","path":null,"size_bytes":11274,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","path":null,"size_bytes":257,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport crypto from \"crypto\";\nimport bcrypt from \"bcrypt\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated, AuthenticatedRequest } from \"./auth\";\nimport { registerObjectStorageRoutes, objectStorageService } from \"./replit_integrations/object_storage\";\nimport { sendInviteEmail } from \"./email\";\nimport {\n  analyzeBriefingMessage,\n  generateScope,\n  generateRoadmap,\n  generateChecklists,\n  generateAiCommand,\n  generateTechnicalDoc,\n  generateArchitectureDoc,\n  generateApiDoc,\n  generateInstallGuide,\n  extractTextFromDocument,\n  runSpecializedAgent,\n  runSpecializedAgentAnalysis,\n  runOrchestratedAnalysis,\n  type SpecializedAgentType,\n} from \"./openai\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Auth middleware\n  setupAuth(app);\n\n  // Register object storage routes with authentication\n  registerObjectStorageRoutes(app, isAuthenticated);\n\n  // Client routes\n  app.get(\"/api/clients\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const clients = await storage.getClients(userId);\n      res.json(clients);\n    } catch (error) {\n      console.error(\"Error fetching clients:\", error);\n      res.status(500).json({ message: \"Failed to fetch clients\" });\n    }\n  });\n\n  app.get(\"/api/clients/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const client = await storage.getClient(req.params.id);\n      if (!client) {\n        return res.status(404).json({ message: \"Client not found\" });\n      }\n      res.json(client);\n    } catch (error) {\n      console.error(\"Error fetching client:\", error);\n      res.status(500).json({ message: \"Failed to fetch client\" });\n    }\n  });\n\n  app.post(\"/api/clients\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const client = await storage.createClient({\n        ...req.body,\n        userId,\n      });\n      res.status(201).json(client);\n    } catch (error) {\n      console.error(\"Error creating client:\", error);\n      res.status(500).json({ message: \"Failed to create client\" });\n    }\n  });\n\n  app.put(\"/api/clients/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const client = await storage.updateClient(req.params.id, req.body);\n      if (!client) {\n        return res.status(404).json({ message: \"Client not found\" });\n      }\n      res.json(client);\n    } catch (error) {\n      console.error(\"Error updating client:\", error);\n      res.status(500).json({ message: \"Failed to update client\" });\n    }\n  });\n\n  app.delete(\"/api/clients/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      await storage.deleteClient(req.params.id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting client:\", error);\n      res.status(500).json({ message: \"Failed to delete client\" });\n    }\n  });\n\n  // Project routes\n  app.get(\"/api/projects\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const projects = await storage.getProjects(userId);\n      res.json(projects);\n    } catch (error) {\n      console.error(\"Error fetching projects:\", error);\n      res.status(500).json({ message: \"Failed to fetch projects\" });\n    }\n  });\n\n  app.get(\"/api/projects/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const project = await storage.getProject(req.params.id);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.json(project);\n    } catch (error) {\n      console.error(\"Error fetching project:\", error);\n      res.status(500).json({ message: \"Failed to fetch project\" });\n    }\n  });\n\n  app.post(\"/api/projects\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const project = await storage.createProject({\n        ...req.body,\n        userId,\n        status: \"briefing\",\n        progress: 0,\n      });\n\n      // Create empty briefing\n      await storage.createBriefing({\n        projectId: project.id,\n        status: \"incomplete\",\n        conversation: [],\n      });\n\n      res.status(201).json(project);\n    } catch (error) {\n      console.error(\"Error creating project:\", error);\n      res.status(500).json({ message: \"Failed to create project\" });\n    }\n  });\n\n  app.put(\"/api/projects/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const project = await storage.updateProject(req.params.id, req.body);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.json(project);\n    } catch (error) {\n      console.error(\"Error updating project:\", error);\n      res.status(500).json({ message: \"Failed to update project\" });\n    }\n  });\n\n  app.delete(\"/api/projects/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      await storage.deleteProject(req.params.id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting project:\", error);\n      res.status(500).json({ message: \"Failed to delete project\" });\n    }\n  });\n\n  // Briefing routes\n  app.get(\"/api/projects/:id/briefing\", isAuthenticated, async (req: any, res) => {\n    try {\n      const briefing = await storage.getBriefing(req.params.id);\n      res.json(briefing || null);\n    } catch (error) {\n      console.error(\"Error fetching briefing:\", error);\n      res.status(500).json({ message: \"Failed to fetch briefing\" });\n    }\n  });\n\n  app.patch(\"/api/projects/:id/briefing\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      let briefing = await storage.getBriefing(projectId);\n      \n      if (!briefing) {\n        briefing = await storage.createBriefing({\n          projectId,\n          status: \"in_progress\",\n          conversation: [],\n        });\n      }\n\n      const updatedBriefing = await storage.updateBriefing(projectId, req.body);\n      res.json(updatedBriefing);\n    } catch (error) {\n      console.error(\"Error updating briefing:\", error);\n      res.status(500).json({ message: \"Failed to update briefing\" });\n    }\n  });\n\n  app.post(\"/api/projects/:id/briefing/chat\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const { message } = req.body;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      let briefing = await storage.getBriefing(projectId);\n      if (!briefing) {\n        briefing = await storage.createBriefing({\n          projectId,\n          status: \"in_progress\",\n          conversation: [],\n        });\n      }\n\n      const conversation = [...((briefing.conversation as any[]) || [])];\n      conversation.push({ role: \"user\", content: message });\n\n      // Check if user is asking for suggestions based on agent analysis\n      const lowerMessage = message.toLowerCase();\n      const isSuggestionRequest = lowerMessage.includes(\"sugest\") || \n        lowerMessage.includes(\"recomenda\") || \n        lowerMessage.includes(\"análise\") ||\n        lowerMessage.includes(\"analise\") ||\n        lowerMessage.includes(\"agente\") ||\n        lowerMessage.includes(\"melhoria\") ||\n        lowerMessage.includes(\"o que falta\") ||\n        lowerMessage.includes(\"atualizar projeto\") ||\n        lowerMessage.includes(\"aplicar\") ||\n        lowerMessage.includes(\"sim, pode\") ||\n        lowerMessage.includes(\"pode atualizar\") ||\n        lowerMessage.includes(\"atualize\");\n\n      // Fetch agent analyses if user is asking for suggestions\n      let agentAnalyses: any[] = [];\n      let scope: any = null;\n      let roadmap: any = null;\n      if (isSuggestionRequest) {\n        agentAnalyses = await storage.getAgentAnalyses(projectId);\n        scope = await storage.getScope(projectId);\n        roadmap = await storage.getRoadmap(projectId);\n      }\n\n      // Analyze with AI\n      const analysis = await analyzeBriefingMessage(\n        project.name,\n        conversation,\n        briefing,\n        isSuggestionRequest ? { agentAnalyses, scope, roadmap, briefing } : undefined\n      );\n\n      // Update briefing with extracted data\n      const updateData: any = {\n        conversation,\n        status: analysis.isReadyToFinalize ? \"ready_to_finalize\" : \"in_progress\",\n        currentField: analysis.currentField || null,\n      };\n\n      if (analysis.projectType) updateData.projectType = analysis.projectType;\n      if (analysis.businessObjective) updateData.businessObjective = analysis.businessObjective;\n      if (analysis.targetAudience) updateData.targetAudience = analysis.targetAudience;\n      if (analysis.marketNiche) updateData.marketNiche = analysis.marketNiche;\n      if (analysis.desiredScope) updateData.desiredScope = analysis.desiredScope;\n      if (analysis.successCriteria) updateData.successCriteria = analysis.successCriteria;\n      if (analysis.stack) updateData.stack = analysis.stack;\n      if (analysis.deadlineText) {\n        updateData.deadlineText = analysis.deadlineText;\n        const deadlineMatch = analysis.deadlineText.match(/(\\d+)\\s*(dias?|semanas?|meses?)/i);\n        if (deadlineMatch) {\n          const num = parseInt(deadlineMatch[1]);\n          const unit = deadlineMatch[2].toLowerCase();\n          const deadline = new Date();\n          if (unit.startsWith(\"dia\")) deadline.setDate(deadline.getDate() + num);\n          else if (unit.startsWith(\"semana\")) deadline.setDate(deadline.getDate() + num * 7);\n          else if (unit.startsWith(\"mes\")) deadline.setMonth(deadline.getMonth() + num);\n          updateData.deadline = deadline;\n        }\n      }\n      if (analysis.budget) updateData.budget = analysis.budget;\n      if (analysis.technicalRestrictions) updateData.technicalRestrictions = analysis.technicalRestrictions;\n      if (analysis.compliance) updateData.compliance = analysis.compliance;\n\n      // Add AI response to conversation with finalization flag\n      updateData.conversation = [\n        ...conversation,\n        { \n          role: \"assistant\", \n          content: analysis.nextQuestion,\n          isReadyToFinalize: analysis.isReadyToFinalize || false\n        },\n      ];\n\n      const updatedBriefing = await storage.updateBriefing(projectId, updateData);\n\n      res.json(updatedBriefing);\n    } catch (error) {\n      console.error(\"Error processing briefing chat:\", error);\n      res.status(500).json({ message: \"Failed to process message\" });\n    }\n  });\n\n  // Process uploaded document for briefing\n  app.post(\"/api/projects/:id/briefing/document\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const { filename, objectPath } = req.body;\n\n      // Validate input\n      if (!filename || typeof filename !== \"string\") {\n        return res.status(400).json({ message: \"Filename is required\" });\n      }\n      if (!objectPath || typeof objectPath !== \"string\") {\n        return res.status(400).json({ message: \"Object path is required\" });\n      }\n\n      // Security: Validate objectPath format to prevent path traversal\n      // Only allow paths that start with .private/ (our private upload directory)\n      if (!objectPath.startsWith(\".private/\")) {\n        return res.status(400).json({ message: \"Invalid object path\" });\n      }\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // Verify user owns this project\n      const userId = req.user.id;\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Fetch file content from object storage\n      let content: string;\n      try {\n        const fileBuffer = await objectStorageService.getFileContent(objectPath);\n        content = fileBuffer.toString(\"utf-8\");\n        \n        // Limit content size (50KB)\n        const maxContentLength = 50000;\n        if (content.length > maxContentLength) {\n          content = content.substring(0, maxContentLength) + \"\\n\\n[Conteudo truncado...]\";\n        }\n      } catch (storageError) {\n        console.error(\"Error fetching file from storage:\", storageError);\n        return res.status(400).json({ message: \"Failed to read uploaded file\" });\n      }\n\n      let briefing = await storage.getBriefing(projectId);\n      if (!briefing) {\n        briefing = await storage.createBriefing({\n          projectId,\n          status: \"in_progress\",\n          conversation: [],\n        });\n      }\n\n      // Extract information from document using AI\n      const extractedInfo = await extractTextFromDocument(content, filename);\n\n      // Add document content as a user message\n      const conversation = [...((briefing.conversation as any[]) || [])];\n      conversation.push({\n        role: \"user\",\n        content: `[Documento enviado: ${filename}]\\n\\n${extractedInfo}`,\n      });\n\n      // Analyze with AI\n      const analysis = await analyzeBriefingMessage(\n        project.name,\n        conversation,\n        briefing\n      );\n\n      // Update briefing with extracted data\n      const updateData: any = {\n        conversation,\n        status: analysis.isReadyToFinalize ? \"ready_to_finalize\" : \"in_progress\",\n        rawInput: extractedInfo,\n        currentField: analysis.currentField || null,\n      };\n\n      if (analysis.projectType) updateData.projectType = analysis.projectType;\n      if (analysis.businessObjective) updateData.businessObjective = analysis.businessObjective;\n      if (analysis.targetAudience) updateData.targetAudience = analysis.targetAudience;\n      if (analysis.marketNiche) updateData.marketNiche = analysis.marketNiche;\n      if (analysis.desiredScope) updateData.desiredScope = analysis.desiredScope;\n      if (analysis.successCriteria) updateData.successCriteria = analysis.successCriteria;\n      if (analysis.stack) updateData.stack = analysis.stack;\n      if (analysis.deadlineText) {\n        updateData.deadlineText = analysis.deadlineText;\n        const deadlineMatch = analysis.deadlineText.match(/(\\d+)\\s*(dias?|semanas?|meses?)/i);\n        if (deadlineMatch) {\n          const num = parseInt(deadlineMatch[1]);\n          const unit = deadlineMatch[2].toLowerCase();\n          const deadline = new Date();\n          if (unit.startsWith(\"dia\")) deadline.setDate(deadline.getDate() + num);\n          else if (unit.startsWith(\"semana\")) deadline.setDate(deadline.getDate() + num * 7);\n          else if (unit.startsWith(\"mes\")) deadline.setMonth(deadline.getMonth() + num);\n          updateData.deadline = deadline;\n        }\n      }\n      if (analysis.budget) updateData.budget = analysis.budget;\n\n      // Add AI response with finalization flag\n      updateData.conversation = [\n        ...conversation,\n        { \n          role: \"assistant\", \n          content: analysis.nextQuestion,\n          isReadyToFinalize: analysis.isReadyToFinalize || false\n        },\n      ];\n\n      const updatedBriefing = await storage.updateBriefing(projectId, updateData);\n      res.json(updatedBriefing);\n    } catch (error) {\n      console.error(\"Error processing document:\", error);\n      res.status(500).json({ message: \"Failed to process document\" });\n    }\n  });\n\n  // Upload image reference for visual identity\n  app.post(\"/api/projects/:id/briefing/image-reference\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const { filename, objectPath, mimeType } = req.body;\n\n      if (!filename || !objectPath) {\n        return res.status(400).json({ message: \"Filename and objectPath are required\" });\n      }\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      const userId = req.user.id;\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      let briefing = await storage.getBriefing(projectId);\n      if (!briefing) {\n        briefing = await storage.createBriefing({\n          projectId,\n          status: \"in_progress\",\n          conversation: [],\n        });\n      }\n\n      const currentReferences = (briefing.visualReferences as any[]) || [];\n      const newReference = {\n        id: `ref-${Date.now()}`,\n        filename,\n        objectPath,\n        mimeType: mimeType || \"image/png\",\n        uploadedAt: new Date().toISOString(),\n      };\n\n      const updatedBriefing = await storage.updateBriefing(projectId, {\n        visualReferences: [...currentReferences, newReference],\n      });\n\n      res.json(updatedBriefing);\n    } catch (error) {\n      console.error(\"Error uploading image reference:\", error);\n      res.status(500).json({ message: \"Failed to upload image reference\" });\n    }\n  });\n\n  // Delete image reference\n  app.delete(\"/api/projects/:id/briefing/image-reference/:refId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { id: projectId, refId } = req.params;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      const userId = req.user.id;\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const briefing = await storage.getBriefing(projectId);\n      if (!briefing) {\n        return res.status(404).json({ message: \"Briefing not found\" });\n      }\n\n      const currentReferences = (briefing.visualReferences as any[]) || [];\n      const updatedReferences = currentReferences.filter((ref: any) => ref.id !== refId);\n\n      const updatedBriefing = await storage.updateBriefing(projectId, {\n        visualReferences: updatedReferences,\n      });\n\n      res.json(updatedBriefing);\n    } catch (error) {\n      console.error(\"Error deleting image reference:\", error);\n      res.status(500).json({ message: \"Failed to delete image reference\" });\n    }\n  });\n\n  app.post(\"/api/projects/:id/briefing/complete\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      const briefing = await storage.getBriefing(projectId);\n      if (!briefing) {\n        return res.status(400).json({ message: \"No briefing found\" });\n      }\n\n      // Validate required fields before completing\n      const requiredFields = [\n        { key: \"projectType\", label: \"Tipo de Projeto\" },\n        { key: \"businessObjective\", label: \"Objetivo de Negócio\" },\n        { key: \"targetAudience\", label: \"Público-Alvo\" },\n        { key: \"marketNiche\", label: \"Nicho de Mercado\" },\n        { key: \"desiredScope\", label: \"Escopo Desejado\" },\n        { key: \"successCriteria\", label: \"Critérios de Sucesso\" },\n        { key: \"stack\", label: \"Stack Tecnológica\" },\n        { key: \"visualIdentity\", label: \"Identidade Visual\" },\n        { key: \"deadlineText\", label: \"Prazo\" },\n        { key: \"budget\", label: \"Orçamento\" },\n      ];\n\n      const missingFields = requiredFields.filter((f) => {\n        const value = (briefing as any)[f.key];\n        return !value || value === \"\";\n      });\n\n      if (missingFields.length > 0) {\n        const missingLabels = missingFields.map((f) => f.label).join(\", \");\n        return res.status(400).json({ \n          message: `Campos obrigatórios faltando: ${missingLabels}`,\n          missingFields: missingFields.map((f) => f.key)\n        });\n      }\n\n      // Generate scope (create or update if exists)\n      const scopeData = await generateScope(briefing);\n      const existingScope = await storage.getScope(projectId);\n      if (existingScope) {\n        await storage.updateScope(projectId, {\n          objective: scopeData.objective,\n          deliverables: scopeData.deliverables,\n          outOfScope: scopeData.outOfScope,\n          assumptions: scopeData.assumptions,\n          dependencies: scopeData.dependencies,\n          risks: scopeData.risks,\n        });\n      } else {\n        await storage.createScope({\n          projectId,\n          objective: scopeData.objective,\n          deliverables: scopeData.deliverables,\n          outOfScope: scopeData.outOfScope,\n          assumptions: scopeData.assumptions,\n          dependencies: scopeData.dependencies,\n          risks: scopeData.risks,\n        });\n      }\n\n      // Generate roadmap (create or update if exists)\n      const roadmapData = await generateRoadmap(\n        briefing,\n        scopeData,\n        project.methodology || \"hybrid\"\n      );\n      const existingRoadmap = await storage.getRoadmap(projectId);\n      if (existingRoadmap) {\n        await storage.updateRoadmap(projectId, {\n          phases: roadmapData.phases,\n          milestones: roadmapData.milestones,\n        });\n      } else {\n        await storage.createRoadmap({\n          projectId,\n          phases: roadmapData.phases,\n          milestones: roadmapData.milestones,\n        });\n      }\n\n      // Create default stages (only if they don't exist)\n      const existingStages = await storage.getStages(projectId);\n      const existingStageNames = existingStages.map(s => s.name.toLowerCase());\n      \n      const defaultStages = [\n        { name: \"Planejamento\", type: \"planning\", weight: 15, order: 1 },\n        { name: \"Design\", type: \"design\", weight: 20, order: 2 },\n        { name: \"Desenvolvimento\", type: \"development\", weight: 35, order: 3 },\n        { name: \"Testes\", type: \"testing\", weight: 20, order: 4 },\n        { name: \"Deploy\", type: \"deploy\", weight: 10, order: 5 },\n      ];\n\n      for (const stage of defaultStages) {\n        // Skip if stage already exists\n        if (existingStageNames.includes(stage.name.toLowerCase())) {\n          continue;\n        }\n        await storage.createStage({\n          projectId,\n          ...stage,\n          progress: 0,\n          status: \"pending\",\n        });\n      }\n\n      // Generate checklists (only if they don't exist for each type)\n      const existingChecklists = await storage.getChecklists(projectId);\n      const existingChecklistTypes = existingChecklists.map(c => c.type);\n      \n      const checklistsData = await generateChecklists(briefing, scopeData);\n      const checklistTypes = [\"technical\", \"commercial\", \"legal\", \"delivery\", \"validation\"] as const;\n      for (const type of checklistTypes) {\n        // Skip if checklist of this type already exists\n        if (existingChecklistTypes.includes(type)) {\n          continue;\n        }\n        const items = checklistsData[type] || [];\n        await storage.createChecklist({\n          projectId,\n          type,\n          items: items.map((text: string) => ({ text, checked: false })),\n        });\n      }\n\n      // Generate AI command\n      const roadmap = await storage.getRoadmap(projectId);\n      const aiCommandData = await generateAiCommand(\n        project.name,\n        briefing,\n        scopeData,\n        roadmap\n      );\n      await storage.createAiCommand({\n        projectId,\n        promptText: aiCommandData.promptText,\n        jsonCommand: aiCommandData.jsonCommand,\n        targetPlatform: \"cursor\",\n      });\n\n      // Generate technical documentation\n      const techDoc = await generateTechnicalDoc(project.name, briefing, scopeData);\n      await storage.createDocument({\n        projectId,\n        title: \"Documentação Técnica\",\n        type: \"technical\",\n        content: techDoc,\n      });\n\n      // Update project status\n      await storage.updateProject(projectId, {\n        status: \"planning\",\n        progress: 10,\n      });\n\n      // Update briefing status\n      await storage.updateBriefing(projectId, { status: \"complete\" });\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error completing briefing:\", error);\n      res.status(500).json({ message: \"Failed to complete briefing\" });\n    }\n  });\n\n  // Scope routes\n  app.get(\"/api/projects/:id/scope\", isAuthenticated, async (req: any, res) => {\n    try {\n      const scope = await storage.getScope(req.params.id);\n      res.json(scope || null);\n    } catch (error) {\n      console.error(\"Error fetching scope:\", error);\n      res.status(500).json({ message: \"Failed to fetch scope\" });\n    }\n  });\n\n  // Roadmap routes\n  app.get(\"/api/projects/:id/roadmap\", isAuthenticated, async (req: any, res) => {\n    try {\n      const roadmap = await storage.getRoadmap(req.params.id);\n      res.json(roadmap || null);\n    } catch (error) {\n      console.error(\"Error fetching roadmap:\", error);\n      res.status(500).json({ message: \"Failed to fetch roadmap\" });\n    }\n  });\n\n  // Stages routes\n  app.get(\"/api/projects/:id/stages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const stagesWithAssignments = await storage.getStagesWithAssignments(req.params.id);\n      res.json(stagesWithAssignments);\n    } catch (error) {\n      console.error(\"Error fetching stages:\", error);\n      res.status(500).json({ message: \"Failed to fetch stages\" });\n    }\n  });\n\n  app.put(\"/api/stages/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const stage = await storage.updateStage(req.params.id, req.body);\n      if (!stage) {\n        return res.status(404).json({ message: \"Stage not found\" });\n      }\n\n      // Recalculate project progress\n      const stages = await storage.getStages(stage.projectId);\n      const totalWeight = stages.reduce((sum, s) => sum + (s.weight || 0), 0);\n      const weightedProgress = stages.reduce(\n        (sum, s) => sum + ((s.progress || 0) * (s.weight || 0)) / 100,\n        0\n      );\n      const projectProgress = Math.round((weightedProgress / totalWeight) * 100);\n\n      await storage.updateProject(stage.projectId, { progress: projectProgress });\n\n      res.json(stage);\n    } catch (error) {\n      console.error(\"Error updating stage:\", error);\n      res.status(500).json({ message: \"Failed to update stage\" });\n    }\n  });\n\n  // Stage approval route\n  app.post(\"/api/stages/:id/approve\", isAuthenticated, async (req: any, res) => {\n    try {\n      const stageId = req.params.id;\n      const userId = req.user.id;\n      const { approved, comment } = req.body;\n\n      // Validate input\n      if (typeof approved !== \"boolean\") {\n        return res.status(400).json({ message: \"Invalid approval value\" });\n      }\n\n      const stage = await storage.getStage(stageId);\n      if (!stage) {\n        return res.status(404).json({ message: \"Stage not found\" });\n      }\n\n      // Verify the stage belongs to a project the user has access to\n      const project = await storage.getProject(stage.projectId);\n      if (!project || project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Validate progress requirement for approval\n      if (approved && (stage.progress || 0) < 100) {\n        return res.status(400).json({ message: \"Stage progress must be 100% before approval\" });\n      }\n\n      // Already approved\n      if (stage.status === \"approved\" && approved) {\n        return res.status(400).json({ message: \"Stage is already approved\" });\n      }\n\n      const approvalHistory = [...((stage.approvalHistory as any[]) || [])];\n      const now = new Date();\n\n      approvalHistory.push({\n        action: approved ? \"approved\" : \"rejected\",\n        userId,\n        timestamp: now.toISOString(),\n        comment: comment || null,\n      });\n\n      const updateData: any = {\n        approvalHistory,\n        status: approved ? \"approved\" : \"rejected\",\n        progress: approved ? 100 : stage.progress,\n        updatedAt: now,\n      };\n\n      if (approved) {\n        updateData.approvedBy = userId;\n        updateData.approvedAt = now;\n      }\n\n      const updatedStage = await storage.updateStage(stageId, updateData);\n\n      // Recalculate project progress\n      const stages = await storage.getStages(stage.projectId);\n      const totalWeight = stages.reduce((sum, s) => sum + (s.weight || 0), 0);\n      const weightedProgress = stages.reduce(\n        (sum, s) => sum + ((s.progress || 0) * (s.weight || 0)) / 100,\n        0\n      );\n      const projectProgress = Math.round((weightedProgress / totalWeight) * 100);\n\n      // Update project status if all stages approved\n      const allApproved = stages.every(s => s.status === \"approved\");\n      const projectUpdate: any = { progress: projectProgress };\n      if (allApproved) {\n        projectUpdate.status = \"completed\";\n      }\n\n      await storage.updateProject(stage.projectId, projectUpdate);\n\n      res.json(updatedStage);\n    } catch (error) {\n      console.error(\"Error approving stage:\", error);\n      res.status(500).json({ message: \"Failed to approve stage\" });\n    }\n  });\n\n  // Checklists routes\n  app.get(\"/api/projects/:id/checklists\", isAuthenticated, async (req: any, res) => {\n    try {\n      const checklists = await storage.getChecklists(req.params.id);\n      res.json(checklists);\n    } catch (error) {\n      console.error(\"Error fetching checklists:\", error);\n      res.status(500).json({ message: \"Failed to fetch checklists\" });\n    }\n  });\n\n  app.put(\"/api/checklists/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const checklist = await storage.updateChecklist(req.params.id, req.body);\n      if (!checklist) {\n        return res.status(404).json({ message: \"Checklist not found\" });\n      }\n      res.json(checklist);\n    } catch (error) {\n      console.error(\"Error updating checklist:\", error);\n      res.status(500).json({ message: \"Failed to update checklist\" });\n    }\n  });\n\n  // Documents routes\n  app.get(\"/api/projects/:id/documents\", isAuthenticated, async (req: any, res) => {\n    try {\n      const documents = await storage.getDocuments(req.params.id);\n      res.json(documents);\n    } catch (error) {\n      console.error(\"Error fetching documents:\", error);\n      res.status(500).json({ message: \"Failed to fetch documents\" });\n    }\n  });\n\n  // AI Command routes\n  app.get(\"/api/projects/:id/ai-command\", isAuthenticated, async (req: any, res) => {\n    try {\n      const command = await storage.getAiCommand(req.params.id);\n      res.json(command || null);\n    } catch (error) {\n      console.error(\"Error fetching AI command:\", error);\n      res.status(500).json({ message: \"Failed to fetch AI command\" });\n    }\n  });\n\n  app.post(\"/api/projects/:id/ai-command/regenerate\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      const briefing = await storage.getBriefing(projectId);\n      const scope = await storage.getScope(projectId);\n      const roadmap = await storage.getRoadmap(projectId);\n\n      const aiCommandData = await generateAiCommand(\n        project.name,\n        briefing,\n        scope,\n        roadmap\n      );\n\n      const existingCommand = await storage.getAiCommand(projectId);\n      let command;\n      if (existingCommand) {\n        command = await storage.updateAiCommand(existingCommand.id, {\n          promptText: aiCommandData.promptText,\n          jsonCommand: aiCommandData.jsonCommand,\n        });\n      } else {\n        command = await storage.createAiCommand({\n          projectId,\n          promptText: aiCommandData.promptText,\n          jsonCommand: aiCommandData.jsonCommand,\n          targetPlatform: \"cursor\",\n        });\n      }\n\n      res.json(command);\n    } catch (error) {\n      console.error(\"Error regenerating AI command:\", error);\n      res.status(500).json({ message: \"Failed to regenerate AI command\" });\n    }\n  });\n\n  // AES-256-GCM encryption for vault credentials\n  const ENCRYPTION_KEY = process.env.SESSION_SECRET;\n  if (!ENCRYPTION_KEY) {\n    console.error(\"CRITICAL: SESSION_SECRET is required for vault encryption\");\n  }\n  const ALGORITHM = 'aes-256-gcm';\n  \n  const getKey = (): Buffer => {\n    return crypto.createHash('sha256').update(ENCRYPTION_KEY).digest();\n  };\n\n  const encryptValue = (value: string): string => {\n    const iv = crypto.randomBytes(16);\n    const cipher = crypto.createCipheriv(ALGORITHM, getKey(), iv);\n    let encrypted = cipher.update(value, 'utf8', 'hex');\n    encrypted += cipher.final('hex');\n    const authTag = cipher.getAuthTag();\n    return iv.toString('hex') + ':' + authTag.toString('hex') + ':' + encrypted;\n  };\n\n  const decryptValue = (encrypted: string): string => {\n    if (!ENCRYPTION_KEY) {\n      throw new Error(\"Encryption key not configured\");\n    }\n    try {\n      const parts = encrypted.split(':');\n      if (parts.length !== 3) {\n        throw new Error(\"Invalid encrypted format\");\n      }\n      const iv = Buffer.from(parts[0], 'hex');\n      const authTag = Buffer.from(parts[1], 'hex');\n      const encryptedText = parts[2];\n      const decipher = crypto.createDecipheriv(ALGORITHM, getKey(), iv);\n      decipher.setAuthTag(authTag);\n      let decrypted = decipher.update(encryptedText, 'hex', 'utf8');\n      decrypted += decipher.final('utf8');\n      return decrypted;\n    } catch (error) {\n      console.error(\"Decryption error:\", error);\n      throw new Error(\"Failed to decrypt value\");\n    }\n  };\n\n  const maskValue = (value: string): string => {\n    if (value.length <= 8) return '••••••••';\n    return value.substring(0, 4) + '••••••••' + value.substring(value.length - 4);\n  };\n\n  // Vault routes\n  app.get(\"/api/projects/:id/vault\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const userId = req.user.id;\n\n      const project = await storage.getProject(projectId);\n      if (!project || project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const items = await storage.getVaultItems(projectId);\n      const maskedItems = items.map(item => ({\n        ...item,\n        value: maskValue(decryptValue(item.value)),\n        _encrypted: true,\n      }));\n      res.json(maskedItems);\n    } catch (error) {\n      console.error(\"Error fetching vault items:\", error);\n      res.status(500).json({ message: \"Failed to fetch vault items\" });\n    }\n  });\n\n  app.get(\"/api/projects/:id/vault/:itemId/reveal\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const itemId = req.params.itemId;\n      const userId = req.user.id;\n\n      const project = await storage.getProject(projectId);\n      if (!project || project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const items = await storage.getVaultItems(projectId);\n      const item = items.find(i => i.id === itemId);\n      if (!item) {\n        return res.status(404).json({ message: \"Item not found\" });\n      }\n\n      res.json({ value: decryptValue(item.value) });\n    } catch (error) {\n      console.error(\"Error revealing vault item:\", error);\n      res.status(500).json({ message: \"Failed to reveal vault item\" });\n    }\n  });\n\n  app.post(\"/api/projects/:id/vault\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const userId = req.user.id;\n      const { name, type, value, description, environment } = req.body;\n\n      if (!name || !type || !value) {\n        return res.status(400).json({ message: \"Name, type, and value are required\" });\n      }\n\n      const project = await storage.getProject(projectId);\n      if (!project || project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const encryptedValue = encryptValue(value);\n      const item = await storage.createVaultItem({\n        projectId,\n        name,\n        type,\n        value: encryptedValue,\n        description,\n        environment,\n      });\n\n      res.status(201).json({\n        ...item,\n        value: maskValue(value),\n        _encrypted: true,\n      });\n    } catch (error) {\n      console.error(\"Error creating vault item:\", error);\n      res.status(500).json({ message: \"Failed to create vault item\" });\n    }\n  });\n\n  app.patch(\"/api/vault/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const itemId = req.params.id;\n      const userId = req.user.id;\n\n      const item = await storage.getVaultItem(itemId);\n      if (!item) {\n        return res.status(404).json({ message: \"Vault item not found\" });\n      }\n\n      const project = await storage.getProject(item.projectId);\n      if (!project || project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const updateData = { ...req.body };\n      if (updateData.value) {\n        updateData.value = encryptValue(updateData.value);\n      }\n\n      const updatedItem = await storage.updateVaultItem(itemId, updateData);\n      res.json({\n        ...updatedItem,\n        value: maskValue(req.body.value || \"****\"),\n        _encrypted: true,\n      });\n    } catch (error) {\n      console.error(\"Error updating vault item:\", error);\n      res.status(500).json({ message: \"Failed to update vault item\" });\n    }\n  });\n\n  app.delete(\"/api/vault/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const itemId = req.params.id;\n      const userId = req.user.id;\n\n      const item = await storage.getVaultItem(itemId);\n      if (!item) {\n        return res.status(404).json({ message: \"Vault item not found\" });\n      }\n\n      const project = await storage.getProject(item.projectId);\n      if (!project || project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      await storage.deleteVaultItem(itemId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting vault item:\", error);\n      res.status(500).json({ message: \"Failed to delete vault item\" });\n    }\n  });\n\n  // AI Agent routes\n  app.post(\"/api/projects/:id/agents/run\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const { agentType, task } = req.body;\n      const userId = req.user.id;\n\n      if (!agentType || !task) {\n        return res.status(400).json({ message: \"Agent type and task are required\" });\n      }\n\n      const validAgentTypes = [\"analysis\", \"code\", \"test\", \"review\"];\n      if (!validAgentTypes.includes(agentType)) {\n        return res.status(400).json({ message: \"Invalid agent type\" });\n      }\n\n      const project = await storage.getProject(projectId);\n      if (!project || project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const briefing = await storage.getBriefing(projectId);\n      const scope = await storage.getScope(projectId);\n      const roadmap = await storage.getRoadmap(projectId);\n\n      const projectContext = {\n        name: project.name,\n        description: project.description,\n        status: project.status,\n        methodology: project.methodology,\n        briefing: briefing ? {\n          projectType: briefing.projectType,\n          businessObjective: briefing.businessObjective,\n          targetAudience: briefing.targetAudience,\n          stack: briefing.stack,\n        } : null,\n        scope: scope ? {\n          objective: scope.objective,\n          deliverables: scope.deliverables,\n          risks: scope.risks,\n        } : null,\n        roadmap: roadmap ? {\n          phases: roadmap.phases,\n          milestones: roadmap.milestones,\n        } : null,\n      };\n\n      const result = await runSpecializedAgent(agentType, task, projectContext);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error running AI agent:\", error);\n      res.status(500).json({ message: \"Failed to run AI agent\" });\n    }\n  });\n\n  // Document generation routes\n  app.post(\"/api/projects/:id/documents/generate\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const { type } = req.body;\n      const userId = req.user.id;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const briefing = await storage.getBriefing(projectId);\n      const scope = await storage.getScope(projectId);\n      const roadmap = await storage.getRoadmap(projectId);\n\n      let content: string;\n      let title: string;\n\n      switch (type) {\n        case \"technical\":\n          content = await generateTechnicalDoc(project.name, briefing, scope);\n          title = \"Documentação Técnica\";\n          break;\n        case \"architecture\":\n          content = await generateArchitectureDoc(project.name, briefing, scope, roadmap);\n          title = \"Arquitetura do Sistema\";\n          break;\n        case \"api\":\n          content = await generateApiDoc(project.name, briefing, scope);\n          title = \"Documentação da API\";\n          break;\n        case \"installation\":\n          content = await generateInstallGuide(project.name, briefing, scope);\n          title = \"Guia de Instalação\";\n          break;\n        default:\n          return res.status(400).json({ message: \"Invalid document type\" });\n      }\n\n      // Check if document of this type already exists\n      const existingDocs = await storage.getDocuments(projectId);\n      const existingDoc = existingDocs.find((d) => d.type === type);\n\n      let document;\n      if (existingDoc) {\n        document = await storage.updateDocument(existingDoc.id, { content, title });\n      } else {\n        document = await storage.createDocument({\n          projectId,\n          title,\n          type,\n          content,\n        });\n      }\n\n      res.json(document);\n    } catch (error) {\n      console.error(\"Error generating document:\", error);\n      res.status(500).json({ message: \"Failed to generate document\" });\n    }\n  });\n\n  // Specialized Agent Analysis routes\n  app.get(\"/api/projects/:id/agents\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const userId = req.user.id;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const analyses = await storage.getAgentAnalyses(projectId);\n      res.json(analyses);\n    } catch (error) {\n      console.error(\"Error fetching agent analyses:\", error);\n      res.status(500).json({ message: \"Failed to fetch agent analyses\" });\n    }\n  });\n\n  // Apply agent recommendations to project - MUST come before :agentType route\n  app.post(\"/api/projects/:id/agents/apply-recommendations\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const userId = req.user.id;\n      const { agentType, recommendations, notes } = req.body;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const briefing = await storage.getBriefing(projectId);\n      const scope = await storage.getScope(projectId);\n\n      const appliedRecommendations = recommendations?.length > 0 ? recommendations : [];\n      const userNotes = notes || \"\";\n\n      const agentRecommendationEntry = {\n        agentType,\n        recommendations: appliedRecommendations,\n        notes: userNotes,\n        appliedAt: new Date().toISOString(),\n      };\n\n      if (briefing) {\n        const existingConversation = (briefing.conversation as any[]) || [];\n        const updatedConversation = [\n          ...existingConversation,\n          {\n            role: \"system\",\n            content: `Recomendacoes do ${agentType} aplicadas: ${appliedRecommendations.join(\"; \")}${userNotes ? `. Notas: ${userNotes}` : \"\"}`,\n            timestamp: new Date().toISOString(),\n          }\n        ];\n\n        await storage.updateBriefing(projectId, {\n          conversation: updatedConversation,\n        });\n      }\n\n      if (scope) {\n        const existingMetadata = (scope.metadata as Record<string, any>) || {};\n        const existingRecommendations = existingMetadata.appliedRecommendations || [];\n        await storage.updateScope(projectId, {\n          metadata: {\n            ...existingMetadata,\n            appliedRecommendations: [...existingRecommendations, agentRecommendationEntry],\n            lastUpdated: new Date().toISOString(),\n          },\n        });\n      }\n\n      res.json({ \n        success: true, \n        message: \"Recomendacoes aplicadas com sucesso\",\n        appliedRecommendations: appliedRecommendations.length,\n      });\n    } catch (error) {\n      console.error(\"Error applying recommendations:\", error);\n      res.status(500).json({ message: \"Failed to apply recommendations\" });\n    }\n  });\n\n  // Run orchestrated analysis (all agents) - MUST come before :agentType route\n  app.post(\"/api/projects/:id/agents/orchestrate\", isAuthenticated, async (req: any, res) => {\n    let session: any = null;\n    try {\n      const projectId = req.params.id;\n      const userId = req.user.id;\n      const { agentTypes } = req.body;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const briefing = await storage.getBriefing(projectId);\n      const scope = await storage.getScope(projectId);\n      const roadmap = await storage.getRoadmap(projectId);\n\n      const agentsToRun = agentTypes || [\"scope\", \"technical\", \"timeline\", \"risks\", \"financial\", \"documentation\"];\n\n      session = await storage.createOrchestratorSession({\n        projectId,\n        status: \"running\",\n        agentsExecuted: agentsToRun,\n      });\n\n      const result = await runOrchestratedAnalysis(\n        { project, briefing, scope, roadmap },\n        agentsToRun\n      );\n\n      for (const agentResult of result.agentResults) {\n        const hasValidResult = agentResult.confidence > 0 && agentResult.analysis;\n        await storage.createAgentAnalysis({\n          projectId,\n          agentType: agentResult.agentType,\n          status: hasValidResult ? \"completed\" : \"failed\",\n          result: agentResult.analysis || \"Análise falhou\",\n          confidence: agentResult.confidence || 0,\n          recommendations: agentResult.recommendations || [],\n          warnings: agentResult.warnings || [],\n          metadata: { \n            executionTime: agentResult.executionTime || 0,\n            sessionId: session.id \n          },\n        });\n      }\n\n      const updatedSession = await storage.updateOrchestratorSession(session.id, {\n        status: \"completed\",\n        consolidatedResult: result.consolidatedAnalysis || {\n          overallHealth: 0,\n          criticalIssues: [],\n          topRecommendations: [],\n          projectReadiness: \"not_ready\",\n          summary: \"Análise não pôde ser concluída completamente.\"\n        },\n        totalConfidence: result.consolidatedAnalysis?.overallHealth || 0,\n        executionLog: result.agentResults.map(r => ({\n          agent: r.agentType,\n          status: (r.confidence > 0 && r.analysis) ? \"success\" : \"failed\",\n          confidence: r.confidence || 0,\n          executionTime: r.executionTime || 0,\n        })),\n        completedAt: new Date(),\n      });\n\n      res.json({\n        session: updatedSession,\n        agentResults: result.agentResults,\n        consolidatedAnalysis: result.consolidatedAnalysis,\n        totalExecutionTime: result.totalExecutionTime,\n      });\n    } catch (error) {\n      console.error(\"Error running orchestrated analysis:\", error);\n      \n      if (session) {\n        try {\n          await storage.updateOrchestratorSession(session.id, {\n            status: \"failed\",\n            completedAt: new Date(),\n          });\n        } catch (updateError) {\n          console.error(\"Error updating failed session:\", updateError);\n        }\n      }\n      \n      res.status(500).json({ message: \"Failed to run orchestrated analysis\" });\n    }\n  });\n\n  // Run a single specialized agent\n  app.post(\"/api/projects/:id/agents/:agentType\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const agentType = req.params.agentType as SpecializedAgentType;\n      const userId = req.user.id;\n\n      const validAgentTypes = [\"scope\", \"technical\", \"timeline\", \"risks\", \"financial\", \"documentation\"];\n      if (!validAgentTypes.includes(agentType)) {\n        return res.status(400).json({ message: \"Invalid agent type\" });\n      }\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const briefing = await storage.getBriefing(projectId);\n      const scope = await storage.getScope(projectId);\n      const roadmap = await storage.getRoadmap(projectId);\n\n      // Create pending analysis record\n      const pendingAnalysis = await storage.createAgentAnalysis({\n        projectId,\n        agentType,\n        status: \"running\",\n      });\n\n      // Run the specialized agent\n      const result = await runSpecializedAgentAnalysis(agentType, {\n        project,\n        briefing,\n        scope,\n        roadmap,\n      });\n\n      // Update analysis with results\n      const updatedAnalysis = await storage.updateAgentAnalysis(pendingAnalysis.id, {\n        status: \"completed\",\n        result: result.analysis,\n        confidence: result.confidence,\n        recommendations: result.recommendations,\n        warnings: result.warnings,\n        metadata: { executionTime: result.executionTime },\n      });\n\n      res.json(updatedAnalysis);\n    } catch (error) {\n      console.error(\"Error running specialized agent:\", error);\n      res.status(500).json({ message: \"Failed to run specialized agent\" });\n    }\n  });\n\n  // Get orchestrator sessions\n  app.get(\"/api/projects/:id/orchestrator-sessions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const userId = req.user.id;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      if (project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const sessions = await storage.getOrchestratorSessions(projectId);\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching orchestrator sessions:\", error);\n      res.status(500).json({ message: \"Failed to fetch orchestrator sessions\" });\n    }\n  });\n\n  // ============ TEAM MEMBER ROUTES ============\n\n  // Get project members\n  app.get(\"/api/projects/:id/members\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const userId = req.user.id;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // Allow access if owner or member\n      const membership = await storage.getProjectMemberByUserId(projectId, userId);\n      if (project.userId !== userId && !membership) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const members = await storage.getProjectMembers(projectId);\n      res.json(members);\n    } catch (error) {\n      console.error(\"Error fetching project members:\", error);\n      res.status(500).json({ message: \"Failed to fetch project members\" });\n    }\n  });\n\n  // Add project member\n  app.post(\"/api/projects/:id/members\", isAuthenticated, async (req: any, res) => {\n    try {\n      const projectId = req.params.id;\n      const userId = req.user.id;\n      const { email, name, role, specialty, password } = req.body;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // Only owner or manager can add members\n      if (project.userId !== userId) {\n        const membership = await storage.getProjectMemberByUserId(projectId, userId);\n        if (!membership || membership.role === \"contributor\") {\n          return res.status(403).json({ message: \"Only owners and managers can add members\" });\n        }\n      }\n\n      // Check if member already exists\n      const existingMember = await storage.getProjectMemberByEmail(projectId, email);\n      if (existingMember) {\n        return res.status(400).json({ message: \"Member with this email already exists\" });\n      }\n\n      // Check if user with this email exists\n      let existingUser = await storage.getUserByEmail(email);\n\n      // If user doesn't exist, create one with the provisional password\n      if (!existingUser) {\n        if (!password || password.length < 6) {\n          return res.status(400).json({ message: \"Password is required and must be at least 6 characters\" });\n        }\n\n        const hashedPassword = await bcrypt.hash(password, 10);\n        \n        // Split name into first and last name\n        const nameParts = name.trim().split(\" \");\n        const firstName = nameParts[0];\n        const lastName = nameParts.slice(1).join(\" \") || undefined;\n\n        existingUser = await storage.createUser({\n          email,\n          password: hashedPassword,\n          firstName,\n          lastName,\n        });\n      }\n\n      const member = await storage.createProjectMember({\n        projectId,\n        email,\n        name,\n        role: role || \"contributor\",\n        specialty,\n        userId: existingUser.id,\n        status: \"active\",\n      });\n\n      res.status(201).json(member);\n    } catch (error) {\n      console.error(\"Error adding project member:\", error);\n      res.status(500).json({ message: \"Failed to add project member\" });\n    }\n  });\n\n  // Update project member\n  app.put(\"/api/projects/:id/members/:memberId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { id: projectId, memberId } = req.params;\n      const userId = req.user.id;\n      const { password, ...memberData } = req.body;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // Only owner or manager can update members\n      if (project.userId !== userId) {\n        const membership = await storage.getProjectMemberByUserId(projectId, userId);\n        if (!membership || membership.role === \"contributor\") {\n          return res.status(403).json({ message: \"Only owners and managers can update members\" });\n        }\n      }\n\n      // Get the member to find the associated user\n      const existingMember = await storage.getProjectMember(memberId);\n      if (!existingMember) {\n        return res.status(404).json({ message: \"Member not found\" });\n      }\n\n      // If password is provided and member has a userId, update the user's password\n      if (password && password.length >= 6 && existingMember.userId) {\n        const hashedPassword = await bcrypt.hash(password, 10);\n        await storage.updateUser(existingMember.userId, { password: hashedPassword });\n      }\n\n      const member = await storage.updateProjectMember(memberId, memberData);\n      if (!member) {\n        return res.status(404).json({ message: \"Member not found\" });\n      }\n\n      res.json(member);\n    } catch (error) {\n      console.error(\"Error updating project member:\", error);\n      res.status(500).json({ message: \"Failed to update project member\" });\n    }\n  });\n\n  // Delete project member\n  app.delete(\"/api/projects/:id/members/:memberId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { id: projectId, memberId } = req.params;\n      const userId = req.user.id;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // Only owner or manager can delete members\n      if (project.userId !== userId) {\n        const membership = await storage.getProjectMemberByUserId(projectId, userId);\n        if (!membership || membership.role === \"contributor\") {\n          return res.status(403).json({ message: \"Only owners and managers can remove members\" });\n        }\n      }\n\n      await storage.deleteProjectMember(memberId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error removing project member:\", error);\n      res.status(500).json({ message: \"Failed to remove project member\" });\n    }\n  });\n\n  // ============ STAGE ASSIGNMENT ROUTES ============\n\n  // Get stage assignments\n  app.get(\"/api/stages/:stageId/assignments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { stageId } = req.params;\n      const assignments = await storage.getStageAssignments(stageId);\n      \n      // Enrich with member data\n      const enrichedAssignments = await Promise.all(assignments.map(async (assignment) => {\n        const member = await storage.getProjectMember(assignment.memberId);\n        return { ...assignment, member };\n      }));\n\n      res.json(enrichedAssignments);\n    } catch (error) {\n      console.error(\"Error fetching stage assignments:\", error);\n      res.status(500).json({ message: \"Failed to fetch stage assignments\" });\n    }\n  });\n\n  // Assign member to stage\n  app.post(\"/api/stages/:stageId/assignments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { stageId } = req.params;\n      const userId = req.user.id;\n      const { memberId, dueDate, notes } = req.body;\n\n      const stage = await storage.getStage(stageId);\n      if (!stage) {\n        return res.status(404).json({ message: \"Stage not found\" });\n      }\n\n      const project = await storage.getProject(stage.projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // Only owner or manager can assign tasks\n      if (project.userId !== userId) {\n        const membership = await storage.getProjectMemberByUserId(project.id, userId);\n        if (!membership || membership.role === \"contributor\") {\n          return res.status(403).json({ message: \"Only owners and managers can assign tasks\" });\n        }\n      }\n\n      const assignment = await storage.createStageAssignment({\n        stageId,\n        memberId,\n        assignedBy: userId,\n        dueDate: dueDate ? new Date(dueDate) : undefined,\n        notes,\n      });\n\n      const member = await storage.getProjectMember(memberId);\n      res.status(201).json({ ...assignment, member });\n    } catch (error) {\n      console.error(\"Error assigning stage:\", error);\n      res.status(500).json({ message: \"Failed to assign stage\" });\n    }\n  });\n\n  // Remove stage assignment\n  app.delete(\"/api/stages/:stageId/assignments/:assignmentId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { stageId, assignmentId } = req.params;\n      const userId = req.user.id;\n\n      const stage = await storage.getStage(stageId);\n      if (!stage) {\n        return res.status(404).json({ message: \"Stage not found\" });\n      }\n\n      const project = await storage.getProject(stage.projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // Only owner or manager can remove assignments\n      if (project.userId !== userId) {\n        const membership = await storage.getProjectMemberByUserId(project.id, userId);\n        if (!membership || membership.role === \"contributor\") {\n          return res.status(403).json({ message: \"Only owners and managers can remove assignments\" });\n        }\n      }\n\n      await storage.deleteStageAssignment(assignmentId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error removing stage assignment:\", error);\n      res.status(500).json({ message: \"Failed to remove stage assignment\" });\n    }\n  });\n\n  // ============ MY TASKS ROUTES ============\n\n  // Get all tasks assigned to current user\n  app.get(\"/api/my-tasks\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n\n      // Get all projects where user is owner\n      const ownedProjects = await storage.getProjects(userId);\n\n      // Get all projects where user is a member\n      const memberProjects = await storage.getProjectsByMemberUserId(userId);\n\n      // Combine and dedupe\n      const allProjectIds = new Set([\n        ...ownedProjects.map(p => p.id),\n        ...memberProjects.map(p => p.id),\n      ]);\n\n      const tasks: any[] = [];\n\n      for (const projectId of allProjectIds) {\n        const project = await storage.getProject(projectId);\n        if (!project) continue;\n\n        const stages = await storage.getStages(projectId);\n        const membership = await storage.getProjectMemberByUserId(projectId, userId);\n\n        for (const stage of stages) {\n          const assignments = await storage.getStageAssignments(stage.id);\n          \n          // Check if this stage is assigned to the current user\n          const isAssignedToUser = membership \n            ? assignments.some(a => a.memberId === membership.id)\n            : false;\n\n          // Include if user owns project or is assigned\n          const isOwner = project.userId === userId;\n          const canEdit = isOwner || (membership?.role === \"manager\") || isAssignedToUser;\n\n          if (isOwner || isAssignedToUser) {\n            tasks.push({\n              stage,\n              project,\n              isOwner,\n              isAssigned: isAssignedToUser,\n              canEdit,\n              memberRole: membership?.role,\n            });\n          }\n        }\n      }\n\n      res.json(tasks);\n    } catch (error) {\n      console.error(\"Error fetching my tasks:\", error);\n      res.status(500).json({ message: \"Failed to fetch my tasks\" });\n    }\n  });\n\n  // Update stage progress with permission check\n  app.patch(\"/api/stages/:stageId/progress\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { stageId } = req.params;\n      const userId = req.user.id;\n      const { progress, notes } = req.body;\n\n      const stage = await storage.getStage(stageId);\n      if (!stage) {\n        return res.status(404).json({ message: \"Stage not found\" });\n      }\n\n      const project = await storage.getProject(stage.projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      const isOwner = project.userId === userId;\n      const membership = await storage.getProjectMemberByUserId(project.id, userId);\n      \n      // Check if contributor is assigned to this stage\n      if (!isOwner && membership?.role === \"contributor\") {\n        const assignments = await storage.getStageAssignments(stageId);\n        const isAssigned = assignments.some(a => a.memberId === membership.id);\n        if (!isAssigned) {\n          return res.status(403).json({ message: \"You can only update progress on stages assigned to you\" });\n        }\n      } else if (!isOwner && !membership) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Create progress log\n      await storage.createProgressLog({\n        stageId,\n        userId,\n        memberId: membership?.id,\n        previousProgress: stage.progress || 0,\n        newProgress: progress,\n        notes,\n      });\n\n      // Update stage progress\n      const updatedStage = await storage.updateStage(stageId, { progress });\n\n      // Recalculate project progress\n      const allStages = await storage.getStages(project.id);\n      const totalWeight = allStages.reduce((sum, s) => sum + (s.weight || 0), 0);\n      const weightedProgress = allStages.reduce((sum, s) => {\n        const stageProgress = s.id === stageId ? progress : (s.progress || 0);\n        return sum + (stageProgress * (s.weight || 0));\n      }, 0);\n      const projectProgress = totalWeight > 0 ? Math.round(weightedProgress / totalWeight) : 0;\n      await storage.updateProject(project.id, { progress: projectProgress });\n\n      res.json(updatedStage);\n    } catch (error) {\n      console.error(\"Error updating stage progress:\", error);\n      res.status(500).json({ message: \"Failed to update stage progress\" });\n    }\n  });\n\n  // Get progress logs for a stage\n  app.get(\"/api/stages/:stageId/progress-logs\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { stageId } = req.params;\n      const logs = await storage.getProgressLogs(stageId);\n      \n      // Enrich with user/member data\n      const enrichedLogs = await Promise.all(logs.map(async (log) => {\n        const user = log.userId ? await storage.getUser(log.userId) : null;\n        const member = log.memberId ? await storage.getProjectMember(log.memberId) : null;\n        return {\n          ...log,\n          userName: user ? `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email : null,\n          memberName: member?.name,\n        };\n      }));\n\n      res.json(enrichedLogs);\n    } catch (error) {\n      console.error(\"Error fetching progress logs:\", error);\n      res.status(500).json({ message: \"Failed to fetch progress logs\" });\n    }\n  });\n\n  // PUBLIC INVITE ROUTES (no authentication required)\n  \n  // Validate invite token\n  app.get(\"/api/invites/:token\", async (req, res) => {\n    try {\n      const invite = await storage.getInviteByToken(req.params.token);\n      \n      if (!invite) {\n        return res.status(404).json({ message: \"Convite não encontrado\" });\n      }\n\n      if (invite.status === \"accepted\") {\n        return res.status(400).json({ message: \"Este convite já foi aceito\" });\n      }\n\n      if (invite.status === \"expired\" || new Date() > invite.expiresAt) {\n        return res.status(400).json({ message: \"Este convite expirou\" });\n      }\n\n      // Get project and member info\n      const project = await storage.getProject(invite.projectId);\n      const member = await storage.getProjectMember(invite.memberId);\n\n      res.json({\n        email: invite.email,\n        projectName: project?.name || \"Projeto\",\n        memberName: member?.name || \"\",\n        role: member?.role || \"contributor\",\n      });\n    } catch (error) {\n      console.error(\"Error validating invite:\", error);\n      res.status(500).json({ message: \"Erro ao validar convite\" });\n    }\n  });\n\n  // Accept invite and create account\n  app.post(\"/api/invites/:token/accept\", async (req, res) => {\n    try {\n      const { password, firstName, lastName } = req.body;\n      const token = req.params.token;\n\n      if (!password || password.length < 6) {\n        return res.status(400).json({ message: \"A senha deve ter pelo menos 6 caracteres\" });\n      }\n\n      const invite = await storage.getInviteByToken(token);\n      \n      if (!invite) {\n        return res.status(404).json({ message: \"Convite não encontrado\" });\n      }\n\n      if (invite.status === \"accepted\") {\n        return res.status(400).json({ message: \"Este convite já foi aceito\" });\n      }\n\n      if (invite.status === \"expired\" || new Date() > invite.expiresAt) {\n        return res.status(400).json({ message: \"Este convite expirou\" });\n      }\n\n      // Check if user already exists\n      const existingUser = await storage.getUserByEmail(invite.email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Já existe uma conta com este e-mail\" });\n      }\n\n      // Hash password and create user\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const member = await storage.getProjectMember(invite.memberId);\n\n      const user = await storage.createUser({\n        email: invite.email,\n        password: hashedPassword,\n        firstName: firstName || member?.name?.split(\" \")[0] || \"\",\n        lastName: lastName || member?.name?.split(\" \").slice(1).join(\" \") || \"\",\n      });\n\n      // Update member to link with user and set active\n      await storage.updateProjectMember(invite.memberId, {\n        userId: user.id,\n        status: \"active\",\n      });\n\n      // Accept the invite\n      await storage.acceptInvite(token);\n\n      res.json({ message: \"Conta criada com sucesso! Faça login para continuar.\" });\n    } catch (error) {\n      console.error(\"Error accepting invite:\", error);\n      res.status(500).json({ message: \"Erro ao aceitar convite\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":68945,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"server/openai.ts":{"content":"import OpenAI from \"openai\";\n\n// This is using Replit's AI Integrations service, which provides OpenAI-compatible API access\n// without requiring your own OpenAI API key. Charges are billed to your credits.\nconst openai = new OpenAI({\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n});\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst MODEL = \"gpt-4.1\";\n\ninterface BriefingAnalysis {\n  projectType?: string;\n  businessObjective?: string;\n  targetAudience?: string;\n  marketNiche?: string;\n  desiredScope?: string;\n  stack?: string;\n  deadlineText?: string;\n  budget?: string;\n  successCriteria?: string;\n  technicalRestrictions?: string;\n  compliance?: string;\n  missingFields: string[];\n  nextQuestion: string;\n  currentField: string;\n  isReadyToFinalize: boolean;\n}\n\nconst BRIEFING_FIELD_ORDER = [\n  \"projectType\",\n  \"businessObjective\",\n  \"targetAudience\",\n  \"marketNiche\",\n  \"desiredScope\",\n  \"successCriteria\",\n  \"stack\",\n  \"deadlineText\",\n  \"budget\",\n  \"visualIdentity\"\n];\n\nconst FIELD_QUESTIONS: Record<string, string> = {\n  projectType: \"Qual e o tipo de projeto que voce deseja desenvolver? (ex: aplicativo mobile, sistema web, plataforma SaaS, e-commerce, etc.)\",\n  businessObjective: \"Qual e o objetivo de negocio deste projeto? O que voce espera alcançar com ele?\",\n  targetAudience: \"Quem e o publico-alvo do projeto? Descreva o perfil dos usuarios finais.\",\n  marketNiche: \"Qual e a area de atuacao ou nicho de mercado do projeto?\",\n  desiredScope: \"Quais sao as funcionalidades principais que o sistema deve ter? Descreva o escopo desejado.\",\n  successCriteria: \"Quais sao os criterios de sucesso do projeto? Como voce vai medir se o projeto foi bem-sucedido?\",\n  stack: \"Voce ja possui uma stack tecnologica preferencial ou podemos sugerir a melhor opcao?\",\n  deadlineText: \"Qual e o prazo desejado para entrega do projeto? (ex: 30 dias, 2 meses, ate dezembro)\",\n  budget: \"Qual e o orcamento disponivel para o projeto? (ex: R$50.000, entre R$30.000 e R$50.000, a definir)\",\n  visualIdentity: \"Lembre-se de selecionar um estilo visual na aba lateral para definir a identidade visual do projeto.\"\n};\n\nfunction parseDeadlineFromText(text: string): { deadlineText: string; deadline: Date | null } | null {\n  const lowerText = text.toLowerCase();\n  \n  const daysMatch = lowerText.match(/(\\d+)\\s*(dias?|d\\b)/);\n  if (daysMatch) {\n    const days = parseInt(daysMatch[1]);\n    const deadline = new Date();\n    deadline.setDate(deadline.getDate() + days);\n    return { deadlineText: `${days} dias`, deadline };\n  }\n  \n  const weeksMatch = lowerText.match(/(\\d+)\\s*(semanas?|sem\\b)/);\n  if (weeksMatch) {\n    const weeks = parseInt(weeksMatch[1]);\n    const deadline = new Date();\n    deadline.setDate(deadline.getDate() + (weeks * 7));\n    return { deadlineText: `${weeks} semanas`, deadline };\n  }\n  \n  const monthsMatch = lowerText.match(/(\\d+)\\s*(meses?|mes\\b)/);\n  if (monthsMatch) {\n    const months = parseInt(monthsMatch[1]);\n    const deadline = new Date();\n    deadline.setMonth(deadline.getMonth() + months);\n    return { deadlineText: `${months} meses`, deadline };\n  }\n  \n  const textualMatch = lowerText.match(/(?:ate|até|para|em)\\s+(janeiro|fevereiro|março|marco|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i);\n  if (textualMatch) {\n    return { deadlineText: `Até ${textualMatch[1]}`, deadline: null };\n  }\n  \n  return null;\n}\n\nfunction parseBudgetFromText(text: string): string | null {\n  const lowerText = text.toLowerCase();\n  \n  const valueMatch = text.match(/r\\$\\s*([\\d.,]+)/i);\n  if (valueMatch) {\n    return `R$ ${valueMatch[1]}`;\n  }\n  \n  const rangeMatch = text.match(/entre\\s*r?\\$?\\s*([\\d.,]+)\\s*e\\s*r?\\$?\\s*([\\d.,]+)/i);\n  if (rangeMatch) {\n    return `R$ ${rangeMatch[1]} a R$ ${rangeMatch[2]}`;\n  }\n  \n  const numericMatch = text.match(/([\\d.,]+)\\s*(mil|k|reais)/i);\n  if (numericMatch) {\n    return `R$ ${numericMatch[1]}${numericMatch[2].toLowerCase() === 'mil' || numericMatch[2].toLowerCase() === 'k' ? '.000' : ''}`;\n  }\n  \n  if (lowerText.includes(\"a definir\") || lowerText.includes(\"nao definido\") || lowerText.includes(\"aberto\")) {\n    return \"A definir\";\n  }\n  \n  return null;\n}\n\nexport async function analyzeBriefingMessage(\n  projectName: string,\n  conversation: { role: string; content: string }[],\n  currentBriefing: any,\n  agentContext?: { agentAnalyses: any[]; scope: any; roadmap: any; briefing: any }\n): Promise<BriefingAnalysis> {\n  const lastUserMessage = conversation.filter(m => m.role === \"user\").pop()?.content || \"\";\n  \n  // Check if user is confirming to apply suggestions\n  const lowerMessage = lastUserMessage.toLowerCase();\n  const isConfirmingUpdate = lowerMessage.includes(\"sim\") || \n    lowerMessage.includes(\"pode\") || \n    lowerMessage.includes(\"aplique\") || \n    lowerMessage.includes(\"atualize\") ||\n    lowerMessage.includes(\"confirmo\") ||\n    lowerMessage.includes(\"ok\") ||\n    lowerMessage.includes(\"prossiga\");\n  \n  let extractedDeadline: { deadlineText: string; deadline: Date | null } | null = null;\n  let extractedBudget: string | null = null;\n  \n  if (currentBriefing.currentField === \"deadlineText\" || !currentBriefing.deadlineText) {\n    extractedDeadline = parseDeadlineFromText(lastUserMessage);\n  }\n  if (currentBriefing.currentField === \"budget\" || !currentBriefing.budget) {\n    extractedBudget = parseBudgetFromText(lastUserMessage);\n  }\n  \n  const filledFields = BRIEFING_FIELD_ORDER.filter(field => {\n    if (field === \"visualIdentity\") {\n      return currentBriefing.visualIdentity && Object.keys(currentBriefing.visualIdentity).length > 0;\n    }\n    if (field === \"deadlineText\") {\n      return currentBriefing.deadlineText || (extractedDeadline && extractedDeadline.deadlineText);\n    }\n    if (field === \"budget\") {\n      return currentBriefing.budget || extractedBudget;\n    }\n    return currentBriefing[field];\n  });\n  \n  const nextEmptyField = BRIEFING_FIELD_ORDER.find(field => !filledFields.includes(field)) || \"\";\n  \n  // Build agent recommendations context\n  let agentRecommendationsContext = \"\";\n  if (agentContext && agentContext.agentAnalyses.length > 0) {\n    const recommendations: string[] = [];\n    const warnings: string[] = [];\n    \n    for (const analysis of agentContext.agentAnalyses) {\n      if (analysis.recommendations) {\n        const recs = analysis.recommendations as string[];\n        recommendations.push(...recs.map(r => `[${analysis.agentType}] ${r}`));\n      }\n      if (analysis.warnings) {\n        const warns = analysis.warnings as string[];\n        warnings.push(...warns.map(w => `[${analysis.agentType}] ${w}`));\n      }\n    }\n    \n    if (recommendations.length > 0 || warnings.length > 0) {\n      agentRecommendationsContext = `\n      \nANALISE DOS AGENTES ESPECIALISTAS:\n\n${warnings.length > 0 ? `ALERTAS IDENTIFICADOS:\n${warnings.map((w, i) => `${i + 1}. ${w}`).join('\\n')}\n\n` : ''}${recommendations.length > 0 ? `RECOMENDACOES:\n${recommendations.map((r, i) => `${i + 1}. ${r}`).join('\\n')}` : ''}\n\nESCOPO ATUAL:\n${agentContext.scope ? JSON.stringify({\n  objetivo: agentContext.scope.objective,\n  entregaveis: agentContext.scope.deliverables,\n  riscos: agentContext.scope.risks\n}, null, 2) : 'Nao gerado ainda'}\n\nINSTRUCOES ESPECIAIS PARA SUGESTOES:\n1. Analise as recomendacoes dos agentes e gere sugestoes ESPECIFICAS para melhorar o projeto\n2. Apresente as sugestoes de forma clara e organizada\n3. Pergunte ao usuario se ele deseja aplicar as melhorias ao projeto\n4. Se o usuario confirmar (disse \"sim\", \"pode\", \"aplique\", etc), gere os dados atualizados no JSON\n5. Ao sugerir melhorias, seja especifico sobre O QUE sera adicionado/modificado`;\n    }\n  }\n  \n  const systemPrompt = `Voce e um assistente especializado em coleta de briefing para projetos de software.\nSua funcao e analisar a conversa e extrair informacoes para preencher os campos do briefing.\n\nIMPORTANTE: Voce deve coletar UMA INFORMACAO POR VEZ, na ordem correta.\n\nOrdem de coleta dos campos (seguir rigorosamente):\n1. projectType - Tipo de projeto (app mobile, web, sistema, etc)\n2. businessObjective - Objetivo de negocio do projeto\n3. targetAudience - Publico-alvo (quem vai usar o sistema)\n4. marketNiche - Area de atuacao ou nicho de mercado\n5. desiredScope - Escopo desejado (funcionalidades principais)\n6. successCriteria - Criterios de sucesso do projeto\n7. stack - Stack tecnologica (pode ser definida ou aberta, aceite \"equipe sugere\" como valido)\n8. deadlineText - Prazo esperado para entrega (ex: \"60 dias\", \"2 meses\")\n9. budget - Orcamento disponivel (ex: \"R$30.000\", \"a definir\")\n10. visualIdentity - Selecionado na interface lateral\n\nCAMPO ATUAL SENDO COLETADO: ${nextEmptyField || \"todos preenchidos\"}\n\nCampos ja preenchidos:\n${JSON.stringify({\n  projectType: currentBriefing.projectType,\n  businessObjective: currentBriefing.businessObjective,\n  targetAudience: currentBriefing.targetAudience,\n  marketNiche: currentBriefing.marketNiche,\n  desiredScope: currentBriefing.desiredScope,\n  successCriteria: currentBriefing.successCriteria,\n  stack: currentBriefing.stack,\n  deadlineText: currentBriefing.deadlineText || (extractedDeadline?.deadlineText),\n  budget: currentBriefing.budget || extractedBudget,\n  visualIdentity: currentBriefing.visualIdentity\n}, null, 2)}\n\nREGRAS IMPORTANTES:\n1. Extraia APENAS informacoes relacionadas ao campo atual (${nextEmptyField})\n2. Se o usuario fornecer informacoes de outros campos, armazene-as tambem\n3. A proxima pergunta deve ser SEMPRE sobre o proximo campo vazio na ordem\n4. Se o campo atual for \"deadlineText\", aceite formatos como \"60 dias\", \"2 meses\", \"ate janeiro\"\n5. Se o campo atual for \"budget\", aceite formatos como \"R$30.000\", \"30 mil\", \"a definir\"\n6. isReadyToFinalize so pode ser true quando TODOS os 10 campos estiverem preenchidos\n7. Se isReadyToFinalize for true E NAO houver contexto de agentes, a nextQuestion deve ser: \"Obrigado! Todas as informacoes essenciais foram coletadas. Caso queira adicionar mais detalhes ou tem alguma consideracao adicional, por favor, informe.\"\n${agentRecommendationsContext ? `\n**PRIORIDADE MAXIMA - MODO DE SUGESTOES ATIVO**\nO usuario pediu sugestoes baseadas nas analises dos agentes. IGNORE a regra 7 e faca o seguinte:\n\n1. Analise as recomendacoes dos agentes especialistas listadas acima\n2. Gere uma resposta em nextQuestion que apresente:\n   - As principais melhorias sugeridas pelos agentes de forma clara e organizada\n   - Para cada sugestao, explique O QUE sera adicionado/modificado no projeto\n   - Pergunte ao usuario: \"Posso aplicar essas melhorias ao projeto?\"\n3. Atualize os campos do briefing com as informacoes sugeridas (desiredScope, successCriteria, etc)\n4. Se o usuario confirmar (\"sim\", \"pode\", \"aplique\"), atualize os campos correspondentes\n\nNAO responda com a mensagem padrao \"Obrigado! Todas as informacoes...\". Responda com as SUGESTOES ESPECIFICAS.\n` : ''}\n\nResponda SEMPRE em JSON com o formato:\n{\n  \"projectType\": \"valor extraido ou null\",\n  \"businessObjective\": \"valor extraido ou null\",\n  \"targetAudience\": \"valor extraido ou null\",\n  \"marketNiche\": \"valor extraido ou null\",\n  \"desiredScope\": \"valor extraido ou null\",\n  \"successCriteria\": \"valor extraido ou null\",\n  \"stack\": \"valor extraido ou null\",\n  \"deadlineText\": \"valor extraido ou null\",\n  \"budget\": \"valor extraido ou null\",\n  \"technicalRestrictions\": \"valor extraido ou null\",\n  \"compliance\": \"valor extraido ou null\",\n  \"missingFields\": [\"lista de campos ainda vazios na ordem\"],\n  \"nextQuestion\": \"Proxima pergunta sobre o proximo campo vazio\",\n  \"currentField\": \"${nextEmptyField}\",\n  \"isReadyToFinalize\": true ou false\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      { role: \"system\", content: systemPrompt },\n      ...conversation.map((m) => ({\n        role: m.role as \"user\" | \"assistant\",\n        content: m.content,\n      })),\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 2048,\n  });\n\n  const content = response.choices[0]?.message?.content || \"{}\";\n  const aiResult = JSON.parse(content);\n  \n  if (extractedDeadline?.deadlineText && !aiResult.deadlineText) {\n    aiResult.deadlineText = extractedDeadline.deadlineText;\n  }\n  if (extractedBudget && !aiResult.budget) {\n    aiResult.budget = extractedBudget;\n  }\n  \n  return aiResult;\n}\n\ninterface GeneratedScope {\n  objective: string;\n  deliverables: string[];\n  outOfScope: string[];\n  assumptions: string[];\n  dependencies: string[];\n  risks: string[];\n}\n\nexport async function generateScope(briefing: any): Promise<GeneratedScope> {\n  const systemPrompt = `Voce e um arquiteto de software experiente. Com base no briefing fornecido, gere um escopo completo e estruturado para o projeto.\n\nResponda em JSON com o formato:\n{\n  \"objective\": \"Objetivo principal do projeto em uma frase clara\",\n  \"deliverables\": [\"Lista de entregaveis concretos\"],\n  \"outOfScope\": [\"O que NAO esta incluido no projeto\"],\n  \"assumptions\": [\"Premissas assumidas\"],\n  \"dependencies\": [\"Dependencias externas\"],\n  \"risks\": [\"Riscos identificados\"]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      { role: \"system\", content: systemPrompt },\n      {\n        role: \"user\",\n        content: `Briefing do projeto:\\n${JSON.stringify(briefing, null, 2)}`,\n      },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const content = response.choices[0]?.message?.content || \"{}\";\n  return JSON.parse(content);\n}\n\ninterface GeneratedRoadmap {\n  phases: {\n    name: string;\n    description: string;\n    duration: string;\n    tasks: string[];\n  }[];\n  milestones: {\n    name: string;\n    description: string;\n  }[];\n}\n\nexport async function generateRoadmap(\n  briefing: any,\n  scope: any,\n  methodology: string\n): Promise<GeneratedRoadmap> {\n  const systemPrompt = `Voce e um gerente de projetos experiente. Com base no briefing e escopo, gere um roadmap completo usando a metodologia ${methodology}.\n\nResponda em JSON com o formato:\n{\n  \"phases\": [\n    {\n      \"name\": \"Nome da fase\",\n      \"description\": \"Descricao\",\n      \"duration\": \"Duracao estimada\",\n      \"tasks\": [\"Lista de tarefas principais\"]\n    }\n  ],\n  \"milestones\": [\n    {\n      \"name\": \"Nome do marco\",\n      \"description\": \"Descricao do entregavel\"\n    }\n  ]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      { role: \"system\", content: systemPrompt },\n      {\n        role: \"user\",\n        content: `Briefing:\\n${JSON.stringify(briefing, null, 2)}\\n\\nEscopo:\\n${JSON.stringify(scope, null, 2)}`,\n      },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const content = response.choices[0]?.message?.content || \"{}\";\n  return JSON.parse(content);\n}\n\ninterface GeneratedChecklists {\n  technical: string[];\n  commercial: string[];\n  legal: string[];\n  delivery: string[];\n  validation: string[];\n}\n\nexport async function generateChecklists(\n  briefing: any,\n  scope: any\n): Promise<GeneratedChecklists> {\n  const systemPrompt = `Voce e um especialista em gestao de projetos. Gere checklists inteligentes para o projeto.\n\nResponda em JSON com o formato:\n{\n  \"technical\": [\"Items do checklist tecnico\"],\n  \"commercial\": [\"Items do checklist comercial\"],\n  \"legal\": [\"Items do checklist juridico/compliance\"],\n  \"delivery\": [\"Items do checklist de entrega\"],\n  \"validation\": [\"Items do checklist de validacao com cliente\"]\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      { role: \"system\", content: systemPrompt },\n      {\n        role: \"user\",\n        content: `Briefing:\\n${JSON.stringify(briefing, null, 2)}\\n\\nEscopo:\\n${JSON.stringify(scope, null, 2)}`,\n      },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const content = response.choices[0]?.message?.content || \"{}\";\n  return JSON.parse(content);\n}\n\ninterface GeneratedAiCommand {\n  promptText: string;\n  jsonCommand: object;\n}\n\nexport async function generateAiCommand(\n  projectName: string,\n  briefing: any,\n  scope: any,\n  roadmap: any\n): Promise<GeneratedAiCommand> {\n  const systemPrompt = `Voce e um especialista em prompts para IAs de desenvolvimento como Cursor, Devin e ChatGPT.\nGere um comando estruturado que uma IA de desenvolvimento possa usar para construir o projeto.\n\nO comando deve incluir:\n- Contexto completo do projeto\n- Objetivo final claro\n- Stack obrigatoria\n- Arquitetura recomendada\n- Estrutura de pastas sugerida\n- Regras de seguranca\n- Criterios de aceite\n- Entregaveis esperados\n\nResponda em JSON com o formato:\n{\n  \"promptText\": \"Prompt tecnico completo e detalhado em texto\",\n  \"jsonCommand\": {\n    \"project\": \"nome\",\n    \"context\": \"contexto\",\n    \"objective\": \"objetivo\",\n    \"stack\": {},\n    \"architecture\": {},\n    \"folderStructure\": [],\n    \"securityRules\": [],\n    \"acceptanceCriteria\": [],\n    \"deliverables\": []\n  }\n}`;\n\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      { role: \"system\", content: systemPrompt },\n      {\n        role: \"user\",\n        content: `Projeto: ${projectName}\\n\\nBriefing:\\n${JSON.stringify(briefing, null, 2)}\\n\\nEscopo:\\n${JSON.stringify(scope, null, 2)}\\n\\nRoadmap:\\n${JSON.stringify(roadmap, null, 2)}`,\n      },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 8192,\n  });\n\n  const content = response.choices[0]?.message?.content || \"{}\";\n  return JSON.parse(content);\n}\n\nexport async function generateTechnicalDoc(\n  projectName: string,\n  briefing: any,\n  scope: any\n): Promise<string> {\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      {\n        role: \"system\",\n        content:\n          \"Voce e um arquiteto de software. Gere documentacao tecnica completa em Markdown.\",\n      },\n      {\n        role: \"user\",\n        content: `Gere documentacao tecnica para o projeto \"${projectName}\":\\n\\nBriefing:\\n${JSON.stringify(briefing, null, 2)}\\n\\nEscopo:\\n${JSON.stringify(scope, null, 2)}`,\n      },\n    ],\n    max_completion_tokens: 8192,\n  });\n\n  return response.choices[0]?.message?.content || \"\";\n}\n\nexport async function generateArchitectureDoc(\n  projectName: string,\n  briefing: any,\n  scope: any,\n  roadmap: any\n): Promise<string> {\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      {\n        role: \"system\",\n        content: `Voce e um arquiteto de software senior. Gere documentacao de arquitetura completa em Markdown incluindo:\n- Visao geral da arquitetura\n- Diagrama de componentes (em formato textual/ASCII)\n- Padroes de design utilizados\n- Fluxo de dados\n- Decisoes arquiteturais (ADRs)\n- Consideracoes de escalabilidade\n- Requisitos de infraestrutura`,\n      },\n      {\n        role: \"user\",\n        content: `Projeto: ${projectName}\\n\\nBriefing:\\n${JSON.stringify(briefing, null, 2)}\\n\\nEscopo:\\n${JSON.stringify(scope, null, 2)}\\n\\nRoadmap:\\n${JSON.stringify(roadmap, null, 2)}`,\n      },\n    ],\n    max_completion_tokens: 8192,\n  });\n\n  return response.choices[0]?.message?.content || \"\";\n}\n\nexport async function generateApiDoc(\n  projectName: string,\n  briefing: any,\n  scope: any\n): Promise<string> {\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      {\n        role: \"system\",\n        content: `Voce e um especialista em APIs REST. Gere documentacao de API completa em Markdown incluindo:\n- Visao geral da API\n- Autenticacao e autorizacao\n- Endpoints (metodo, rota, descricao, parametros, respostas)\n- Codigos de status HTTP\n- Exemplos de requisicao/resposta\n- Rate limiting e paginacao\n- Versionamento`,\n      },\n      {\n        role: \"user\",\n        content: `Projeto: ${projectName}\\n\\nBriefing:\\n${JSON.stringify(briefing, null, 2)}\\n\\nEscopo:\\n${JSON.stringify(scope, null, 2)}`,\n      },\n    ],\n    max_completion_tokens: 8192,\n  });\n\n  return response.choices[0]?.message?.content || \"\";\n}\n\nexport async function generateInstallGuide(\n  projectName: string,\n  briefing: any,\n  scope: any\n): Promise<string> {\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      {\n        role: \"system\",\n        content: `Voce e um DevOps engineer. Gere um guia de instalacao e deploy completo em Markdown incluindo:\n- Pre-requisitos\n- Instalacao de dependencias\n- Configuracao de variaveis de ambiente\n- Comandos de build e deploy\n- Configuracao de banco de dados\n- Testes\n- CI/CD sugerido\n- Troubleshooting comum`,\n      },\n      {\n        role: \"user\",\n        content: `Projeto: ${projectName}\\n\\nBriefing:\\n${JSON.stringify(briefing, null, 2)}\\n\\nEscopo:\\n${JSON.stringify(scope, null, 2)}`,\n      },\n    ],\n    max_completion_tokens: 8192,\n  });\n\n  return response.choices[0]?.message?.content || \"\";\n}\n\nexport interface AgentTask {\n  type: \"analysis\" | \"code\" | \"test\" | \"review\";\n  description: string;\n  context: any;\n}\n\nexport interface AgentResponse {\n  type: string;\n  result: string;\n  suggestions: string[];\n  confidence: number;\n}\n\nexport async function runSpecializedAgent(\n  agentType: string,\n  task: AgentTask,\n  projectContext: any\n): Promise<AgentResponse> {\n  const agentPrompts: Record<string, string> = {\n    analysis: `Voce e um agente de IA especializado em analise de requisitos e arquitetura de software.\nSua funcao e analisar o contexto do projeto e fornecer insights estrategicos.\nResponda em JSON com: result (texto da analise), suggestions (array de sugestoes), confidence (0-100).`,\n    \n    code: `Voce e um agente de IA especializado em geracao de codigo e boas praticas.\nSua funcao e gerar snippets de codigo, estruturas e padroes baseados no contexto.\nResponda em JSON com: result (codigo ou estrutura), suggestions (array de melhorias), confidence (0-100).`,\n    \n    test: `Voce e um agente de IA especializado em testes e qualidade de software.\nSua funcao e gerar casos de teste, cenarios de validacao e criterios de aceite.\nResponda em JSON com: result (casos de teste), suggestions (array de testes adicionais), confidence (0-100).`,\n    \n    review: `Voce e um agente de IA especializado em revisao de codigo e seguranca.\nSua funcao e identificar problemas, riscos e sugerir melhorias.\nResponda em JSON com: result (analise de revisao), suggestions (array de correcoes), confidence (0-100).`,\n  };\n\n  const systemPrompt = agentPrompts[agentType] || agentPrompts.analysis;\n\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      { role: \"system\", content: systemPrompt },\n      {\n        role: \"user\",\n        content: `Tarefa: ${task.description}\\n\\nContexto do Projeto:\\n${JSON.stringify(projectContext, null, 2)}\\n\\nContexto adicional:\\n${JSON.stringify(task.context, null, 2)}`,\n      },\n    ],\n    response_format: { type: \"json_object\" },\n    max_completion_tokens: 4096,\n  });\n\n  const content = response.choices[0]?.message?.content || \"{}\";\n  \n  let parsed: any;\n  try {\n    parsed = JSON.parse(content);\n  } catch (parseError) {\n    console.error(\"Failed to parse agent response as JSON:\", parseError);\n    return {\n      type: agentType,\n      result: content,\n      suggestions: [\"Resposta não estruturada - considere reformular a tarefa\"],\n      confidence: 50,\n    };\n  }\n  \n  return {\n    type: agentType,\n    result: parsed.result || content,\n    suggestions: Array.isArray(parsed.suggestions) ? parsed.suggestions : [],\n    confidence: typeof parsed.confidence === \"number\" ? parsed.confidence : 75,\n  };\n}\n\n// Specialized Agent Types\nexport type SpecializedAgentType = \"scope\" | \"technical\" | \"timeline\" | \"risks\" | \"financial\" | \"documentation\";\n\nexport interface SpecializedAgentResult {\n  agentType: SpecializedAgentType;\n  analysis: any;\n  recommendations: string[];\n  warnings: string[];\n  confidence: number;\n  executionTime: number;\n}\n\nconst specializedAgentPrompts: Record<SpecializedAgentType, string> = {\n  scope: `Você é o Agente de Escopo, um especialista em definição e análise de escopo de projetos de software.\n\nSua função é:\n1. Analisar o briefing e escopo atual do projeto\n2. Identificar lacunas na definição do escopo\n3. Sugerir entregáveis adicionais que podem estar faltando\n4. Definir claramente o que está DENTRO e FORA do escopo\n5. Identificar ambiguidades que precisam ser esclarecidas\n\nResponda em JSON:\n{\n  \"scopeAnalysis\": {\n    \"completeness\": 0-100,\n    \"clarity\": 0-100,\n    \"definedDeliverables\": [\"lista de entregáveis definidos\"],\n    \"suggestedDeliverables\": [\"entregáveis que deveriam ser adicionados\"],\n    \"outOfScopeItems\": [\"itens que devem ser explicitamente excluídos\"],\n    \"ambiguities\": [\"pontos que precisam esclarecimento\"]\n  },\n  \"recommendations\": [\"recomendações estratégicas\"],\n  \"warnings\": [\"alertas importantes\"],\n  \"confidence\": 0-100\n}`,\n\n  technical: `Você é o Agente Técnico, um arquiteto de software sênior especializado em análise técnica.\n\nSua função é:\n1. Avaliar a viabilidade técnica do projeto\n2. Analisar a stack tecnológica proposta\n3. Identificar desafios técnicos e complexidades\n4. Sugerir arquitetura e padrões adequados\n5. Avaliar requisitos de infraestrutura\n\nResponda em JSON:\n{\n  \"technicalAnalysis\": {\n    \"feasibility\": 0-100,\n    \"complexity\": \"baixa\" | \"média\" | \"alta\" | \"muito alta\",\n    \"stackEvaluation\": {\n      \"proposed\": \"stack proposta\",\n      \"recommendation\": \"stack recomendada\",\n      \"justification\": \"por que\"\n    },\n    \"architecturePattern\": \"padrão sugerido\",\n    \"infrastructureNeeds\": [\"necessidades de infra\"],\n    \"technicalChallenges\": [\"desafios identificados\"],\n    \"integrations\": [\"integrações necessárias\"]\n  },\n  \"recommendations\": [\"recomendações técnicas\"],\n  \"warnings\": [\"riscos técnicos\"],\n  \"confidence\": 0-100\n}`,\n\n  timeline: `Você é o Agente de Prazos, um especialista em planejamento e estimativas de projetos.\n\nSua função é:\n1. Estimar duração realista para cada fase do projeto\n2. Identificar dependências entre tarefas\n3. Sugerir marcos (milestones) importantes\n4. Avaliar se o prazo desejado é realista\n5. Propor cronograma otimizado\n\nResponda em JSON:\n{\n  \"timelineAnalysis\": {\n    \"estimatedDuration\": {\n      \"optimistic\": \"X semanas\",\n      \"realistic\": \"Y semanas\",\n      \"pessimistic\": \"Z semanas\"\n    },\n    \"phases\": [\n      {\n        \"name\": \"nome da fase\",\n        \"duration\": \"X semanas\",\n        \"dependencies\": [\"dependências\"],\n        \"deliverables\": [\"entregáveis da fase\"]\n      }\n    ],\n    \"milestones\": [\n      {\n        \"name\": \"marco\",\n        \"week\": 0,\n        \"criteria\": \"critério de conclusão\"\n      }\n    ],\n    \"deadlineFeasibility\": {\n      \"isRealistic\": true/false,\n      \"analysis\": \"análise do prazo\"\n    },\n    \"criticalPath\": [\"itens do caminho crítico\"]\n  },\n  \"recommendations\": [\"recomendações de prazo\"],\n  \"warnings\": [\"alertas de cronograma\"],\n  \"confidence\": 0-100\n}`,\n\n  risks: `Você é o Agente de Riscos, um especialista em gestão de riscos de projetos de software.\n\nSua função é:\n1. Identificar riscos potenciais do projeto\n2. Avaliar probabilidade e impacto de cada risco\n3. Propor estratégias de mitigação\n4. Identificar riscos críticos que podem inviabilizar o projeto\n5. Sugerir planos de contingência\n\nResponda em JSON:\n{\n  \"riskAnalysis\": {\n    \"overallRiskLevel\": \"baixo\" | \"médio\" | \"alto\" | \"crítico\",\n    \"risks\": [\n      {\n        \"id\": \"R1\",\n        \"category\": \"técnico\" | \"negócio\" | \"recursos\" | \"externo\" | \"cronograma\",\n        \"description\": \"descrição do risco\",\n        \"probability\": \"baixa\" | \"média\" | \"alta\",\n        \"impact\": \"baixo\" | \"médio\" | \"alto\",\n        \"score\": 1-25,\n        \"mitigation\": \"estratégia de mitigação\",\n        \"contingency\": \"plano de contingência\"\n      }\n    ],\n    \"criticalRisks\": [\"riscos que podem inviabilizar\"],\n    \"riskMatrix\": {\n      \"high\": 0,\n      \"medium\": 0,\n      \"low\": 0\n    }\n  },\n  \"recommendations\": [\"recomendações de gestão de riscos\"],\n  \"warnings\": [\"alertas críticos\"],\n  \"confidence\": 0-100\n}`,\n\n  financial: `Você é o Agente Financeiro, um especialista em estimativas e análise financeira de projetos.\n\nSua função é:\n1. Estimar custos do projeto (desenvolvimento, infra, manutenção)\n2. Avaliar se o orçamento informado é adequado\n3. Identificar custos ocultos potenciais\n4. Sugerir modelo de precificação\n5. Calcular ROI potencial quando aplicável\n\nResponda em JSON:\n{\n  \"financialAnalysis\": {\n    \"estimatedCosts\": {\n      \"development\": {\n        \"min\": 0,\n        \"max\": 0,\n        \"breakdown\": [{\"item\": \"\", \"cost\": 0}]\n      },\n      \"infrastructure\": {\n        \"monthly\": 0,\n        \"annual\": 0\n      },\n      \"maintenance\": {\n        \"monthly\": 0,\n        \"description\": \"\"\n      },\n      \"total\": {\n        \"min\": 0,\n        \"max\": 0\n      }\n    },\n    \"budgetAnalysis\": {\n      \"informedBudget\": \"\",\n      \"isAdequate\": true/false,\n      \"gap\": \"\",\n      \"recommendation\": \"\"\n    },\n    \"hiddenCosts\": [\"custos frequentemente esquecidos\"],\n    \"pricingModel\": {\n      \"suggested\": \"fixo\" | \"hora\" | \"sprint\" | \"híbrido\",\n      \"justification\": \"\"\n    }\n  },\n  \"recommendations\": [\"recomendações financeiras\"],\n  \"warnings\": [\"alertas de orçamento\"],\n  \"confidence\": 0-100\n}`,\n\n  documentation: `Você é o Agente de Documentação, um especialista em documentação técnica e de projeto.\n\nSua função é:\n1. Identificar documentos necessários para o projeto\n2. Avaliar completude da documentação atual\n3. Sugerir estrutura de documentação\n4. Identificar documentação técnica crítica\n5. Propor templates e padrões\n\nResponda em JSON:\n{\n  \"documentationAnalysis\": {\n    \"currentCompleteness\": 0-100,\n    \"requiredDocuments\": [\n      {\n        \"type\": \"tipo do documento\",\n        \"name\": \"nome\",\n        \"priority\": \"alta\" | \"média\" | \"baixa\",\n        \"status\": \"pendente\" | \"parcial\" | \"completo\",\n        \"description\": \"descrição do que deve conter\"\n      }\n    ],\n    \"technicalDocs\": [\"documentos técnicos necessários\"],\n    \"userDocs\": [\"documentação para usuários\"],\n    \"suggestedStructure\": {\n      \"folders\": [\"estrutura de pastas\"],\n      \"templates\": [\"templates sugeridos\"]\n    }\n  },\n  \"recommendations\": [\"recomendações de documentação\"],\n  \"warnings\": [\"documentação crítica faltando\"],\n  \"confidence\": 0-100\n}`\n};\n\nexport async function runSpecializedAgentAnalysis(\n  agentType: SpecializedAgentType,\n  projectContext: {\n    project: any;\n    briefing: any;\n    scope?: any;\n    roadmap?: any;\n  }\n): Promise<SpecializedAgentResult> {\n  const startTime = Date.now();\n  \n  const systemPrompt = specializedAgentPrompts[agentType];\n  \n  const userContent = `Analise o seguinte projeto:\n\nPROJETO: ${projectContext.project?.name || \"Projeto\"}\nDESCRIÇÃO: ${projectContext.project?.description || \"N/A\"}\n\nBRIEFING:\n${JSON.stringify(projectContext.briefing, null, 2)}\n\n${projectContext.scope ? `ESCOPO ATUAL:\\n${JSON.stringify(projectContext.scope, null, 2)}` : \"\"}\n\n${projectContext.roadmap ? `ROADMAP ATUAL:\\n${JSON.stringify(projectContext.roadmap, null, 2)}` : \"\"}\n\nForneça sua análise especializada.`;\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: MODEL,\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userContent }\n      ],\n      response_format: { type: \"json_object\" },\n      max_completion_tokens: 4096,\n    });\n\n    const content = response.choices[0]?.message?.content || \"{}\";\n    const parsed = JSON.parse(content);\n    \n    const executionTime = Date.now() - startTime;\n    \n    return {\n      agentType,\n      analysis: parsed[Object.keys(parsed).find(k => k.includes(\"Analysis\")) || \"analysis\"] || parsed,\n      recommendations: Array.isArray(parsed.recommendations) ? parsed.recommendations : [],\n      warnings: Array.isArray(parsed.warnings) ? parsed.warnings : [],\n      confidence: typeof parsed.confidence === \"number\" ? parsed.confidence : 75,\n      executionTime\n    };\n  } catch (error) {\n    console.error(`Error running ${agentType} agent:`, error);\n    return {\n      agentType,\n      analysis: { error: \"Falha ao executar análise\" },\n      recommendations: [],\n      warnings: [\"Erro na execução do agente\"],\n      confidence: 0,\n      executionTime: Date.now() - startTime\n    };\n  }\n}\n\n// Orchestrator - coordinates multiple agents\nexport interface OrchestratorResult {\n  sessionId?: string;\n  agentResults: SpecializedAgentResult[];\n  consolidatedAnalysis: {\n    overallHealth: number;\n    criticalIssues: string[];\n    topRecommendations: string[];\n    projectReadiness: \"not_ready\" | \"needs_work\" | \"ready\" | \"excellent\";\n    summary: string;\n  };\n  totalExecutionTime: number;\n}\n\nexport async function runOrchestratedAnalysis(\n  projectContext: {\n    project: any;\n    briefing: any;\n    scope?: any;\n    roadmap?: any;\n  },\n  agentTypes: SpecializedAgentType[] = [\"scope\", \"technical\", \"timeline\", \"risks\", \"financial\", \"documentation\"]\n): Promise<OrchestratorResult> {\n  const startTime = Date.now();\n  \n  // Run all agents in parallel\n  const agentPromises = agentTypes.map(type => \n    runSpecializedAgentAnalysis(type, projectContext)\n  );\n  \n  const agentResults = await Promise.all(agentPromises);\n  \n  // Consolidate results\n  const allWarnings = agentResults.flatMap(r => r.warnings);\n  const allRecommendations = agentResults.flatMap(r => r.recommendations);\n  const avgConfidence = agentResults.reduce((sum, r) => sum + r.confidence, 0) / agentResults.length;\n  \n  // Determine project readiness\n  let projectReadiness: \"not_ready\" | \"needs_work\" | \"ready\" | \"excellent\";\n  if (avgConfidence < 40 || allWarnings.length > 10) {\n    projectReadiness = \"not_ready\";\n  } else if (avgConfidence < 60 || allWarnings.length > 5) {\n    projectReadiness = \"needs_work\";\n  } else if (avgConfidence < 80) {\n    projectReadiness = \"ready\";\n  } else {\n    projectReadiness = \"excellent\";\n  }\n  \n  // Generate summary using AI\n  let summary = \"\";\n  try {\n    const summaryResponse = await openai.chat.completions.create({\n      model: MODEL,\n      messages: [\n        {\n          role: \"system\",\n          content: \"Você é um gerente de projetos sênior. Gere um resumo executivo conciso (3-4 frases) consolidando as análises de múltiplos agentes especializados.\"\n        },\n        {\n          role: \"user\",\n          content: `Resultados dos agentes:\\n${JSON.stringify(agentResults.map(r => ({\n            tipo: r.agentType,\n            confiança: r.confidence,\n            alertas: r.warnings.length,\n            recomendações: r.recommendations.length\n          })), null, 2)}\\n\\nGere um resumo executivo em português.`\n        }\n      ],\n      max_completion_tokens: 500,\n    });\n    summary = summaryResponse.choices[0]?.message?.content || \"\";\n  } catch (e) {\n    summary = `Análise concluída com ${agentResults.length} agentes. Confiança média: ${Math.round(avgConfidence)}%. ${allWarnings.length} alertas identificados.`;\n  }\n  \n  return {\n    agentResults,\n    consolidatedAnalysis: {\n      overallHealth: Math.round(avgConfidence),\n      criticalIssues: allWarnings.slice(0, 5),\n      topRecommendations: allRecommendations.slice(0, 10),\n      projectReadiness,\n      summary\n    },\n    totalExecutionTime: Date.now() - startTime\n  };\n}\n\nexport async function extractTextFromDocument(\n  content: string,\n  filename: string\n): Promise<string> {\n  const response = await openai.chat.completions.create({\n    model: MODEL,\n    messages: [\n      {\n        role: \"system\",\n        content: `Você é um assistente que extrai e resume informações relevantes de documentos para briefing de projetos de software.\nExtraia as informações mais importantes do documento, focando em:\n- Objetivos do projeto\n- Requisitos funcionais e não funcionais\n- Público-alvo\n- Escopo desejado\n- Restrições técnicas\n- Prazos e orçamentos mencionados\n\nRetorne um resumo estruturado das informações encontradas.`,\n      },\n      {\n        role: \"user\",\n        content: `Arquivo: ${filename}\\n\\nConteudo:\\n${content}`,\n      },\n    ],\n    max_completion_tokens: 4096,\n  });\n\n  return response.choices[0]?.message?.content || content;\n}\n","path":null,"size_bytes":36333,"size_tokens":null},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"project-ai-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};\n","path":null,"size_bytes":1608,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTheme } from \"@/components/theme-provider\";\n\nexport function ThemeToggle() {\n  const { setTheme } = useTheme();\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-theme-toggle\">\n          <Sun className=\"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n          <Moon className=\"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n          <span className=\"sr-only\">Toggle theme</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        <DropdownMenuItem onClick={() => setTheme(\"light\")} data-testid=\"theme-light\">\n          Light\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"dark\")} data-testid=\"theme-dark\">\n          Dark\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"system\")} data-testid=\"theme-system\">\n          System\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":1323,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","path":null,"size_bytes":116,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines - Plataforma de Inteligência para Gestão de Projetos com IA\n\n## Design Approach\n\n**Selected System:** Hybrid approach combining Linear's modern aesthetics, Notion's content hierarchy, and Material Design 3's structured components\n\n**Rationale:** This is a professional productivity tool requiring exceptional information density management, clear data hierarchy, and seamless workflows. The design must balance sophistication with operational efficiency.\n\n**Key Principles:**\n- Information clarity over decoration\n- Purposeful hierarchy through typography and spacing\n- Streamlined workflows with minimal friction\n- Professional credibility through refined execution\n\n---\n\n## Typography System\n\n**Font Families:**\n- Primary: Inter (headers, navigation, labels)\n- Secondary: JetBrains Mono (code blocks, technical documentation, JSON outputs)\n\n**Type Scale:**\n- Display: 3xl (36px) - Page headers, empty states\n- H1: 2xl (24px) - Section titles, modal headers\n- H2: xl (20px) - Card headers, subsections\n- H3: lg (18px) - List headers, categories\n- Body: base (16px) - Primary content, forms\n- Small: sm (14px) - Secondary info, labels\n- Caption: xs (12px) - Timestamps, metadata\n\n**Weights:**\n- Semibold (600): Headers, primary actions\n- Medium (500): Subheaders, navigation\n- Regular (400): Body text, inputs\n\n---\n\n## Layout System\n\n**Spacing Primitives:** Use Tailwind units: 2, 4, 6, 8, 12, 16, 24\n\n**Grid System:**\n- Main layout: Sidebar (240px fixed) + Content (fluid)\n- Content max-width: 1400px with px-8 padding\n- Card grids: 2-3 columns on desktop, single column mobile\n- Form layouts: Single column max-w-2xl for readability\n\n**Responsive Breakpoints:**\n- Mobile: < 768px (stack everything)\n- Tablet: 768px - 1024px (2-column grids)\n- Desktop: > 1024px (full 3-column layouts)\n\n---\n\n## Component Library\n\n### Navigation\n**Sidebar:**\n- Fixed left sidebar (240px width)\n- Hierarchical tree structure: Clients → Projects → Stages\n- Collapsible sections with expand/collapse icons\n- Active state: subtle background treatment, semibold text\n- Spacing: py-2 for items, px-4 for container\n\n**Top Bar:**\n- Height: h-16\n- Contains: Breadcrumbs, search, user profile, notifications\n- Sticky positioning\n\n### Data Display\n\n**Cards:**\n- Rounded corners: rounded-lg\n- Padding: p-6\n- Shadow: subtle elevation\n- Hover: slight scale transform (scale-[1.01])\n\n**Project Cards:**\n- Header: Project name + status badge\n- Body: Progress bar, key metrics (2-column grid)\n- Footer: Last updated, assigned team\n\n**Tables:**\n- Striped rows for readability\n- Sticky headers\n- Row hover states\n- Action buttons right-aligned\n- Sortable columns with indicator icons\n\n**Progress Indicators:**\n- Linear progress bars (h-2, rounded-full)\n- Percentage display (right-aligned)\n- Stage indicators with checkmarks/pending states\n- Timeline view with connector lines\n\n### Forms & Inputs\n\n**Briefing Interface:**\n- Large textarea: min-h-[200px] with clear focus states\n- Chat-style conversation bubbles for AI questions\n- File upload dropzone: border-dashed, p-12, centered icon\n- Audio recording: waveform visualization, duration counter\n\n**Input Fields:**\n- Height: h-11\n- Padding: px-4\n- Rounded: rounded-md\n- Label above input with text-sm font-medium\n- Helper text below with text-xs\n\n**Select Dropdowns:**\n- Custom styled with chevron icon\n- Max height with scroll for long lists\n- Search functionality for >10 items\n\n**Buttons:**\n- Primary: h-11, px-6, rounded-md, font-medium\n- Secondary: Same size, different treatment\n- Icon buttons: w-11 h-11 (square)\n- Loading states with spinner\n\n### Kanban Board\n- Columns: min-w-[320px], max-w-[400px]\n- Cards: Drag handle, title, assignee avatar, due date\n- Horizontal scroll on overflow\n- Column headers with count badges\n- Add card button at column bottom\n\n### Timeline View\n- Horizontal axis with date markers\n- Milestone diamonds with connecting lines\n- Task bars with drag-to-resize\n- Today indicator line\n- Zoom controls (week/month/quarter views)\n\n### Modals & Overlays\n- Backdrop: semi-transparent with blur\n- Modal: max-w-2xl, rounded-lg, p-8\n- Header with close button (top-right)\n- Footer with action buttons (right-aligned)\n- Slide-in animation from bottom\n\n### Documentation Display\n- Markdown rendering with syntax highlighting\n- Code blocks: JetBrains Mono, rounded-lg, p-4\n- Copy button on code blocks\n- Collapsible sections\n- Table of contents sidebar for long docs\n\n### Command Output Card\n- Monospace font throughout\n- JSON formatting with indentation\n- Copy entire command button\n- Download as file option\n- Syntax highlighting for technical fields\n\n---\n\n## Animations\n\n**Minimal Motion Principle:**\n- Page transitions: None (instant navigation)\n- Hover states: Subtle opacity/scale changes (150ms)\n- Loading states: Spinner only\n- Progress updates: Smooth number counting (500ms)\n- Modal enter/exit: 200ms fade + slide\n\n---\n\n## Dashboard Layout\n\n**Executive Dashboard:**\n- Top: KPI cards in 4-column grid (projects count, active stages, completion rate, upcoming deadlines)\n- Middle: Recent projects table\n- Right sidebar: Activity feed (280px)\n\n**Project Detail View:**\n- Header: Project name, status, progress bar, action buttons\n- Tab navigation: Overview | Briefing | Scope | Roadmap | Execution | Documents\n- Content area: Full-width forms and data displays\n- Right sidebar (320px): Metadata, team, history\n\n---\n\n## Empty States\n\n- Centered icon (96px)\n- Heading: \"Nenhum projeto ainda\"\n- Description: Helper text explaining next action\n- Primary CTA button: \"Criar Primeiro Projeto\"\n- Spacing: py-24 vertical padding\n\n---\n\n## Accessibility\n\n- Focus visible states on all interactive elements\n- ARIA labels on icon-only buttons\n- Keyboard navigation support (Tab, Shift+Tab, Enter, Escape)\n- Screen reader announcements for dynamic content\n- Minimum touch target: 44px × 44px","path":null,"size_bytes":5852,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-red-400 bg-red-950 text-white dark:border-red-500 dark:bg-red-950\",\n        success:\n          \"success group border-green-500 bg-green-950 text-white dark:border-green-400 dark:bg-green-950\",\n        warning:\n          \"warning group border-amber-400 bg-amber-950 text-white dark:border-amber-500 dark:bg-amber-950\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100\",\n      \"group-[.destructive]:text-white/70 group-[.destructive]:hover:text-white group-[.destructive]:focus:ring-red-400\",\n      \"group-[.success]:text-white/70 group-[.success]:hover:text-white group-[.success]:focus:ring-green-400\",\n      \"group-[.warning]:text-white/70 group-[.warning]:hover:text-white group-[.warning]:focus:ring-amber-400\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":5292,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4371,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, boolean, jsonb, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique().notNull(),\n  password: varchar(\"password\").notNull(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Clients table\nexport const clients = pgTable(\"clients\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  email: varchar(\"email\", { length: 255 }),\n  phone: varchar(\"phone\", { length: 50 }),\n  company: varchar(\"company\", { length: 255 }),\n  notes: text(\"notes\"),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Projects table\nexport const projects = pgTable(\"projects\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  status: varchar(\"status\", { length: 50 }).notNull().default(\"briefing\"),\n  methodology: varchar(\"methodology\", { length: 50 }).default(\"hybrid\"),\n  progress: integer(\"progress\").default(0),\n  clientId: varchar(\"client_id\").notNull().references(() => clients.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Briefings table\nexport const briefings = pgTable(\"briefings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  projectType: text(\"project_type\"),\n  businessObjective: text(\"business_objective\"),\n  targetAudience: text(\"target_audience\"),\n  marketNiche: text(\"market_niche\"),\n  desiredScope: text(\"desired_scope\"),\n  stack: text(\"stack\"),\n  deadlineText: text(\"deadline_text\"),\n  deadline: timestamp(\"deadline\"),\n  budget: text(\"budget\"),\n  successCriteria: text(\"success_criteria\"),\n  technicalRestrictions: text(\"technical_restrictions\"),\n  language: varchar(\"language\", { length: 50 }).default(\"technical\"),\n  compliance: text(\"compliance\"),\n  visualIdentity: jsonb(\"visual_identity\").default({}),\n  visualReferences: jsonb(\"visual_references\").default([]),\n  status: varchar(\"status\", { length: 50 }).default(\"incomplete\"),\n  conversation: jsonb(\"conversation\").default([]),\n  rawInput: text(\"raw_input\"),\n  currentField: varchar(\"current_field\", { length: 50 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Scopes table\nexport const scopes = pgTable(\"scopes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  objective: text(\"objective\"),\n  deliverables: jsonb(\"deliverables\").default([]),\n  outOfScope: jsonb(\"out_of_scope\").default([]),\n  assumptions: jsonb(\"assumptions\").default([]),\n  dependencies: jsonb(\"dependencies\").default([]),\n  risks: jsonb(\"risks\").default([]),\n  metadata: jsonb(\"metadata\").default({}),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Roadmaps table\nexport const roadmaps = pgTable(\"roadmaps\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  phases: jsonb(\"phases\").default([]),\n  milestones: jsonb(\"milestones\").default([]),\n  suggestedDates: jsonb(\"suggested_dates\").default({}),\n  slas: jsonb(\"slas\").default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Stages table\nexport const stages = pgTable(\"stages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  type: varchar(\"type\", { length: 50 }).notNull(),\n  weight: integer(\"weight\").default(20),\n  progress: integer(\"progress\").default(0),\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"),\n  order: integer(\"order\").notNull(),\n  approvedBy: varchar(\"approved_by\"),\n  approvedAt: timestamp(\"approved_at\"),\n  approvalHistory: jsonb(\"approval_history\").default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Tasks table\nexport const tasks = pgTable(\"tasks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  stageId: varchar(\"stage_id\").notNull().references(() => stages.id),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  weight: integer(\"weight\").default(1),\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"),\n  assignee: varchar(\"assignee\", { length: 255 }),\n  dueDate: timestamp(\"due_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Checklists table\nexport const checklists = pgTable(\"checklists\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  type: varchar(\"type\", { length: 50 }).notNull(),\n  items: jsonb(\"items\").default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Documents table\nexport const documents = pgTable(\"documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  type: varchar(\"type\", { length: 50 }).notNull(),\n  content: text(\"content\"),\n  metadata: jsonb(\"metadata\").default({}),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// AI Commands table\nexport const aiCommands = pgTable(\"ai_commands\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  promptText: text(\"prompt_text\"),\n  jsonCommand: jsonb(\"json_command\"),\n  targetPlatform: varchar(\"target_platform\", { length: 50 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Vault (sensitive assets) table\nexport const vaultItems = pgTable(\"vault_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  type: varchar(\"type\", { length: 50 }).notNull(),\n  value: text(\"value\").notNull(),\n  description: text(\"description\"),\n  environment: varchar(\"environment\", { length: 50 }).default(\"production\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  clients: many(clients),\n  projects: many(projects),\n}));\n\nexport const clientsRelations = relations(clients, ({ one, many }) => ({\n  user: one(users, { fields: [clients.userId], references: [users.id] }),\n  projects: many(projects),\n}));\n\nexport const projectsRelations = relations(projects, ({ one, many }) => ({\n  client: one(clients, { fields: [projects.clientId], references: [clients.id] }),\n  user: one(users, { fields: [projects.userId], references: [users.id] }),\n  briefing: one(briefings),\n  scope: one(scopes),\n  roadmap: one(roadmaps),\n  stages: many(stages),\n  checklists: many(checklists),\n  documents: many(documents),\n  aiCommands: many(aiCommands),\n}));\n\nexport const briefingsRelations = relations(briefings, ({ one }) => ({\n  project: one(projects, { fields: [briefings.projectId], references: [projects.id] }),\n}));\n\nexport const scopesRelations = relations(scopes, ({ one }) => ({\n  project: one(projects, { fields: [scopes.projectId], references: [projects.id] }),\n}));\n\nexport const roadmapsRelations = relations(roadmaps, ({ one }) => ({\n  project: one(projects, { fields: [roadmaps.projectId], references: [projects.id] }),\n}));\n\nexport const stagesRelations = relations(stages, ({ one, many }) => ({\n  project: one(projects, { fields: [stages.projectId], references: [projects.id] }),\n  tasks: many(tasks),\n}));\n\nexport const tasksRelations = relations(tasks, ({ one }) => ({\n  stage: one(stages, { fields: [tasks.stageId], references: [stages.id] }),\n}));\n\nexport const checklistsRelations = relations(checklists, ({ one }) => ({\n  project: one(projects, { fields: [checklists.projectId], references: [projects.id] }),\n}));\n\nexport const documentsRelations = relations(documents, ({ one }) => ({\n  project: one(projects, { fields: [documents.projectId], references: [projects.id] }),\n}));\n\nexport const aiCommandsRelations = relations(aiCommands, ({ one }) => ({\n  project: one(projects, { fields: [aiCommands.projectId], references: [projects.id] }),\n}));\n\nexport const vaultItemsRelations = relations(vaultItems, ({ one }) => ({\n  project: one(projects, { fields: [vaultItems.projectId], references: [projects.id] }),\n}));\n\n// Mind Maps table\nexport const mindMaps = pgTable(\"mind_maps\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  rootNode: jsonb(\"root_node\").notNull(),\n  metadata: jsonb(\"metadata\").default({}),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const mindMapsRelations = relations(mindMaps, ({ one }) => ({\n  project: one(projects, { fields: [mindMaps.projectId], references: [projects.id] }),\n}));\n\n// Agent Analyses table - stores results from specialized AI agents\nexport const agentAnalyses = pgTable(\"agent_analyses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  agentType: varchar(\"agent_type\", { length: 50 }).notNull(),\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"),\n  result: jsonb(\"result\").default({}),\n  confidence: integer(\"confidence\").default(0),\n  recommendations: jsonb(\"recommendations\").default([]),\n  warnings: jsonb(\"warnings\").default([]),\n  metadata: jsonb(\"metadata\").default({}),\n  executedAt: timestamp(\"executed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const agentAnalysesRelations = relations(agentAnalyses, ({ one }) => ({\n  project: one(projects, { fields: [agentAnalyses.projectId], references: [projects.id] }),\n}));\n\n// Orchestrator Sessions table - tracks multi-agent orchestration runs\nexport const orchestratorSessions = pgTable(\"orchestrator_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  status: varchar(\"status\", { length: 50 }).default(\"running\"),\n  agentsExecuted: jsonb(\"agents_executed\").default([]),\n  consolidatedResult: jsonb(\"consolidated_result\").default({}),\n  totalConfidence: integer(\"total_confidence\").default(0),\n  executionLog: jsonb(\"execution_log\").default([]),\n  startedAt: timestamp(\"started_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const orchestratorSessionsRelations = relations(orchestratorSessions, ({ one }) => ({\n  project: one(projects, { fields: [orchestratorSessions.projectId], references: [projects.id] }),\n}));\n\n// Project Members table - team members with roles\nexport const projectMembers = pgTable(\"project_members\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  userId: varchar(\"user_id\").references(() => users.id),\n  email: varchar(\"email\", { length: 255 }).notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  role: varchar(\"role\", { length: 50 }).notNull().default(\"contributor\"),\n  specialty: varchar(\"specialty\", { length: 100 }),\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"),\n  invitedAt: timestamp(\"invited_at\").defaultNow(),\n  joinedAt: timestamp(\"joined_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const projectMembersRelations = relations(projectMembers, ({ one, many }) => ({\n  project: one(projects, { fields: [projectMembers.projectId], references: [projects.id] }),\n  user: one(users, { fields: [projectMembers.userId], references: [users.id] }),\n  stageAssignments: many(stageAssignments),\n}));\n\n// Stage Assignments table - assigns stages to team members\nexport const stageAssignments = pgTable(\"stage_assignments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  stageId: varchar(\"stage_id\").notNull().references(() => stages.id),\n  memberId: varchar(\"member_id\").notNull().references(() => projectMembers.id),\n  assignedBy: varchar(\"assigned_by\").references(() => users.id),\n  dueDate: timestamp(\"due_date\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const stageAssignmentsRelations = relations(stageAssignments, ({ one }) => ({\n  stage: one(stages, { fields: [stageAssignments.stageId], references: [stages.id] }),\n  member: one(projectMembers, { fields: [stageAssignments.memberId], references: [projectMembers.id] }),\n  assignedByUser: one(users, { fields: [stageAssignments.assignedBy], references: [users.id] }),\n}));\n\n// Project Invites table - team member invitations\nexport const projectInvites = pgTable(\"project_invites\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  projectId: varchar(\"project_id\").notNull().references(() => projects.id),\n  memberId: varchar(\"member_id\").notNull().references(() => projectMembers.id),\n  email: varchar(\"email\", { length: 255 }).notNull(),\n  token: varchar(\"token\", { length: 255 }).notNull().unique(),\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  acceptedAt: timestamp(\"accepted_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const projectInvitesRelations = relations(projectInvites, ({ one }) => ({\n  project: one(projects, { fields: [projectInvites.projectId], references: [projects.id] }),\n  member: one(projectMembers, { fields: [projectInvites.memberId], references: [projectMembers.id] }),\n}));\n\n// Progress Logs table - tracks who updated what\nexport const progressLogs = pgTable(\"progress_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  stageId: varchar(\"stage_id\").notNull().references(() => stages.id),\n  memberId: varchar(\"member_id\").references(() => projectMembers.id),\n  userId: varchar(\"user_id\").references(() => users.id),\n  previousProgress: integer(\"previous_progress\").notNull(),\n  newProgress: integer(\"new_progress\").notNull(),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const progressLogsRelations = relations(progressLogs, ({ one }) => ({\n  stage: one(stages, { fields: [progressLogs.stageId], references: [stages.id] }),\n  member: one(projectMembers, { fields: [progressLogs.memberId], references: [projectMembers.id] }),\n  user: one(users, { fields: [progressLogs.userId], references: [users.id] }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertClientSchema = createInsertSchema(clients).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertProjectSchema = createInsertSchema(projects).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertBriefingSchema = createInsertSchema(briefings).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertScopeSchema = createInsertSchema(scopes).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertRoadmapSchema = createInsertSchema(roadmaps).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertStageSchema = createInsertSchema(stages).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertTaskSchema = createInsertSchema(tasks).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertChecklistSchema = createInsertSchema(checklists).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertDocumentSchema = createInsertSchema(documents).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertAiCommandSchema = createInsertSchema(aiCommands).omit({ id: true, createdAt: true });\nexport const insertVaultItemSchema = createInsertSchema(vaultItems).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertMindMapSchema = createInsertSchema(mindMaps).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertAgentAnalysisSchema = createInsertSchema(agentAnalyses).omit({ id: true, createdAt: true, updatedAt: true, executedAt: true });\nexport const insertOrchestratorSessionSchema = createInsertSchema(orchestratorSessions).omit({ id: true, createdAt: true, startedAt: true, completedAt: true });\nexport const insertProjectMemberSchema = createInsertSchema(projectMembers).omit({ id: true, createdAt: true, updatedAt: true, invitedAt: true, joinedAt: true });\nexport const insertStageAssignmentSchema = createInsertSchema(stageAssignments).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertProgressLogSchema = createInsertSchema(progressLogs).omit({ id: true, createdAt: true });\nexport const insertProjectInviteSchema = createInsertSchema(projectInvites).omit({ id: true, createdAt: true, acceptedAt: true });\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type InsertClient = z.infer<typeof insertClientSchema>;\nexport type Client = typeof clients.$inferSelect;\nexport type InsertProject = z.infer<typeof insertProjectSchema>;\nexport type Project = typeof projects.$inferSelect;\nexport type InsertBriefing = z.infer<typeof insertBriefingSchema>;\nexport type Briefing = typeof briefings.$inferSelect;\nexport type InsertScope = z.infer<typeof insertScopeSchema>;\nexport type Scope = typeof scopes.$inferSelect;\nexport type InsertRoadmap = z.infer<typeof insertRoadmapSchema>;\nexport type Roadmap = typeof roadmaps.$inferSelect;\nexport type InsertStage = z.infer<typeof insertStageSchema>;\nexport type Stage = typeof stages.$inferSelect;\nexport type InsertTask = z.infer<typeof insertTaskSchema>;\nexport type Task = typeof tasks.$inferSelect;\nexport type InsertChecklist = z.infer<typeof insertChecklistSchema>;\nexport type Checklist = typeof checklists.$inferSelect;\nexport type InsertDocument = z.infer<typeof insertDocumentSchema>;\nexport type Document = typeof documents.$inferSelect;\nexport type InsertAiCommand = z.infer<typeof insertAiCommandSchema>;\nexport type AiCommand = typeof aiCommands.$inferSelect;\nexport type InsertVaultItem = z.infer<typeof insertVaultItemSchema>;\nexport type VaultItem = typeof vaultItems.$inferSelect;\nexport type InsertMindMap = z.infer<typeof insertMindMapSchema>;\nexport type MindMap = typeof mindMaps.$inferSelect;\nexport type InsertAgentAnalysis = z.infer<typeof insertAgentAnalysisSchema>;\nexport type AgentAnalysis = typeof agentAnalyses.$inferSelect;\nexport type InsertOrchestratorSession = z.infer<typeof insertOrchestratorSessionSchema>;\nexport type OrchestratorSession = typeof orchestratorSessions.$inferSelect;\nexport type InsertProjectMember = z.infer<typeof insertProjectMemberSchema>;\nexport type ProjectMember = typeof projectMembers.$inferSelect;\nexport type InsertStageAssignment = z.infer<typeof insertStageAssignmentSchema>;\nexport type StageAssignment = typeof stageAssignments.$inferSelect;\nexport type InsertProgressLog = z.infer<typeof insertProgressLogSchema>;\nexport type ProgressLog = typeof progressLogs.$inferSelect;\nexport type InsertProjectInvite = z.infer<typeof insertProjectInviteSchema>;\nexport type ProjectInvite = typeof projectInvites.$inferSelect;\n\n// Enums for type safety\nexport const projectStatuses = [\"briefing\", \"planning\", \"design\", \"development\", \"testing\", \"deploy\", \"completed\"] as const;\nexport const methodologies = [\"scrum\", \"kanban\", \"waterfall\", \"hybrid\"] as const;\nexport const stageTypes = [\"planning\", \"design\", \"development\", \"testing\", \"deploy\"] as const;\nexport const taskStatuses = [\"pending\", \"in_progress\", \"completed\", \"blocked\"] as const;\nexport const briefingStatuses = [\"incomplete\", \"in_progress\", \"complete\"] as const;\nexport const checklistTypes = [\"technical\", \"commercial\", \"legal\", \"delivery\", \"validation\"] as const;\nexport const documentTypes = [\"scope\", \"technical\", \"architecture\", \"api\", \"ai_command\", \"installation\"] as const;\nexport const vaultItemTypes = [\"api_key\", \"password\", \"token\", \"certificate\", \"connection_string\", \"other\"] as const;\nexport const environments = [\"development\", \"staging\", \"production\"] as const;\nexport const agentTypes = [\"scope\", \"technical\", \"timeline\", \"risks\", \"financial\", \"documentation\"] as const;\nexport const agentStatuses = [\"pending\", \"running\", \"completed\", \"failed\"] as const;\nexport const memberRoles = [\"owner\", \"manager\", \"contributor\"] as const;\nexport const memberStatuses = [\"pending\", \"active\", \"inactive\"] as const;\n","path":null,"size_bytes":22318,"size_tokens":null},"client/src/pages/briefing.tsx":{"content":"import { useState, useEffect, useRef, useCallback } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useUpload } from \"@/hooks/use-upload\";\nimport {\n  ArrowLeft,\n  Send,\n  Loader2,\n  Brain,\n  CheckCircle2,\n  MessageSquare,\n  User,\n  Sparkles,\n  Paperclip,\n  FileText,\n  X,\n  Mic,\n  Square,\n  Palette,\n  Check,\n  ImagePlus,\n  Trash2,\n} from \"lucide-react\";\nimport type { Project, Briefing } from \"@shared/schema\";\n\nfunction AudioWaveform({ isActive }: { isActive: boolean }) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const animationRef = useRef<number>();\n  const analyserRef = useRef<AnalyserNode | null>(null);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  useEffect(() => {\n    if (!isActive) {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n      if (audioContextRef.current) {\n        audioContextRef.current.close();\n      }\n      return;\n    }\n\n    const startVisualization = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        streamRef.current = stream;\n        \n        const audioContext = new AudioContext();\n        audioContextRef.current = audioContext;\n        \n        const analyser = audioContext.createAnalyser();\n        analyser.fftSize = 256;\n        analyserRef.current = analyser;\n        \n        const source = audioContext.createMediaStreamSource(stream);\n        source.connect(analyser);\n        \n        const canvas = canvasRef.current;\n        if (!canvas) return;\n        \n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) return;\n        \n        const bufferLength = analyser.frequencyBinCount;\n        const dataArray = new Uint8Array(bufferLength);\n        \n        const draw = () => {\n          if (!isActive) return;\n          \n          animationRef.current = requestAnimationFrame(draw);\n          analyser.getByteFrequencyData(dataArray);\n          \n          ctx.fillStyle = \"transparent\";\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          \n          const barWidth = (canvas.width / bufferLength) * 2.5;\n          let x = 0;\n          \n          for (let i = 0; i < bufferLength; i++) {\n            const barHeight = (dataArray[i] / 255) * canvas.height * 0.8;\n            \n            const gradient = ctx.createLinearGradient(0, canvas.height - barHeight, 0, canvas.height);\n            gradient.addColorStop(0, \"hsl(220, 90%, 56%)\");\n            gradient.addColorStop(1, \"hsl(220, 90%, 40%)\");\n            \n            ctx.fillStyle = gradient;\n            ctx.fillRect(x, canvas.height - barHeight, barWidth - 1, barHeight);\n            \n            x += barWidth + 1;\n          }\n        };\n        \n        draw();\n      } catch (error) {\n        console.error(\"Error accessing microphone for visualization:\", error);\n      }\n    };\n\n    startVisualization();\n\n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n      if (audioContextRef.current) {\n        audioContextRef.current.close();\n      }\n    };\n  }, [isActive]);\n\n  if (!isActive) return null;\n\n  return (\n    <div className=\"flex items-center gap-3 p-3 rounded-xl bg-primary/10 border border-primary/20\">\n      <div className=\"flex items-center gap-2\">\n        <div className=\"w-3 h-3 rounded-full bg-red-500 animate-pulse\" />\n        <span className=\"text-sm font-medium text-primary\">Gravando...</span>\n      </div>\n      <canvas\n        ref={canvasRef}\n        width={200}\n        height={40}\n        className=\"flex-1 rounded-lg\"\n      />\n    </div>\n  );\n}\n\ninterface Message {\n  role: \"user\" | \"assistant\";\n  content: string;\n  timestamp?: string;\n  isReadyToFinalize?: boolean;\n}\n\ninterface VisualReference {\n  id: string;\n  filename: string;\n  objectPath: string;\n  mimeType: string;\n  uploadedAt: string;\n}\n\nconst requiredFields = [\n  { key: \"projectType\", label: \"Tipo de Projeto\" },\n  { key: \"businessObjective\", label: \"Objetivo de Negócio\" },\n  { key: \"targetAudience\", label: \"Público-Alvo\" },\n  { key: \"marketNiche\", label: \"Nicho de Mercado\" },\n  { key: \"desiredScope\", label: \"Escopo Desejado\" },\n  { key: \"successCriteria\", label: \"Critérios de Sucesso\" },\n  { key: \"stack\", label: \"Stack Tecnológica\" },\n  { key: \"visualIdentity\", label: \"Identidade Visual\" },\n  { key: \"deadlineText\", label: \"Prazo\" },\n  { key: \"budget\", label: \"Orçamento\" },\n];\n\nconst visualStyles = [\n  {\n    id: \"modern-minimal\",\n    name: \"Moderno Minimalista\",\n    description: \"Clean, espaçoso, tons neutros\",\n    colors: [\"#FFFFFF\", \"#F8FAFC\", \"#3B82F6\", \"#1E293B\"],\n    preview: \"bg-gradient-to-br from-slate-50 to-blue-50\",\n  },\n  {\n    id: \"dark-elegant\",\n    name: \"Dark Elegante\",\n    description: \"Sofisticado, fundo escuro, detalhes dourados\",\n    colors: [\"#0F172A\", \"#1E293B\", \"#F59E0B\", \"#FBBF24\"],\n    preview: \"bg-gradient-to-br from-slate-900 to-slate-800\",\n  },\n  {\n    id: \"vibrant-creative\",\n    name: \"Vibrante Criativo\",\n    description: \"Cores vivas, gradientes, energético\",\n    colors: [\"#8B5CF6\", \"#EC4899\", \"#06B6D4\", \"#10B981\"],\n    preview: \"bg-gradient-to-br from-purple-500 to-pink-500\",\n  },\n  {\n    id: \"corporate-professional\",\n    name: \"Corporativo Profissional\",\n    description: \"Formal, azul corporativo, confiável\",\n    colors: [\"#1E40AF\", \"#3B82F6\", \"#F1F5F9\", \"#0F172A\"],\n    preview: \"bg-gradient-to-br from-blue-700 to-blue-900\",\n  },\n  {\n    id: \"nature-organic\",\n    name: \"Natural Orgânico\",\n    description: \"Tons terrosos, verde, sustentável\",\n    colors: [\"#166534\", \"#22C55E\", \"#FEF3C7\", \"#78350F\"],\n    preview: \"bg-gradient-to-br from-green-600 to-emerald-700\",\n  },\n  {\n    id: \"tech-futuristic\",\n    name: \"Tech Futurista\",\n    description: \"Neon, cyber, alta tecnologia\",\n    colors: [\"#0F0F23\", \"#00D9FF\", \"#BD00FF\", \"#39FF14\"],\n    preview: \"bg-gradient-to-br from-indigo-950 to-purple-950\",\n  },\n];\n\nexport default function BriefingPage() {\n  const [, navigate] = useLocation();\n  const [, params] = useRoute(\"/projects/:id/briefing\");\n  const projectId = params?.id;\n  const { toast } = useToast();\n  const [input, setInput] = useState(\"\");\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [isListening, setIsListening] = useState(false);\n  const [speechSupported, setSpeechSupported] = useState(false);\n  const [recordedText, setRecordedText] = useState(\"\");\n  const recognitionRef = useRef<any>(null);\n  const scrollRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n    if (SpeechRecognition) {\n      setSpeechSupported(true);\n      const recognition = new SpeechRecognition();\n      recognition.continuous = true;\n      recognition.interimResults = true;\n      recognition.lang = \"pt-BR\";\n\n      recognition.onresult = (event: any) => {\n        let fullTranscript = \"\";\n        for (let i = 0; i < event.results.length; i++) {\n          fullTranscript += event.results[i][0].transcript;\n        }\n        setRecordedText(fullTranscript);\n      };\n\n      recognition.onerror = (event: any) => {\n        console.error(\"Speech recognition error:\", event.error);\n        setIsListening(false);\n        if (event.error === \"not-allowed\") {\n          toast({\n            title: \"Microfone bloqueado\",\n            description: \"Por favor, permita o acesso ao microfone nas configurações do navegador.\",\n            variant: \"destructive\",\n          });\n        }\n      };\n\n      recognition.onend = () => {\n        setIsListening(false);\n      };\n\n      recognitionRef.current = recognition;\n    }\n\n    return () => {\n      if (recognitionRef.current) {\n        recognitionRef.current.stop();\n      }\n    };\n  }, [toast]);\n\n  const startRecording = useCallback(() => {\n    if (!recognitionRef.current) return;\n    \n    setRecordedText(\"\");\n    try {\n      recognitionRef.current.start();\n      setIsListening(true);\n      toast({\n        title: \"Gravação iniciada\",\n        description: \"Fale agora. O texto será transcrito quando você parar a gravação.\",\n      });\n    } catch (error) {\n      console.error(\"Error starting recognition:\", error);\n    }\n  }, [toast]);\n\n  const stopRecording = useCallback(() => {\n    if (!recognitionRef.current) return;\n    \n    recognitionRef.current.stop();\n    setIsListening(false);\n    \n    if (recordedText.trim()) {\n      setInput((prev) => prev + (prev ? \" \" : \"\") + recordedText.trim());\n      setRecordedText(\"\");\n      toast({\n        title: \"Gravação finalizada\",\n        description: \"Texto transcrito com sucesso!\",\n        variant: \"success\",\n      });\n    }\n  }, [recordedText, toast]);\n\n  const { data: project, isLoading: projectLoading } = useQuery<Project>({\n    queryKey: [\"/api/projects\", projectId],\n    enabled: !!projectId,\n  });\n\n  const { data: briefing, isLoading: briefingLoading } = useQuery<Briefing>({\n    queryKey: [\"/api/projects\", projectId, \"briefing\"],\n    enabled: !!projectId,\n  });\n\n  const messages: Message[] = (briefing?.conversation as Message[]) || [];\n\n  const completedFields = requiredFields.filter((f) => {\n    const value = briefing?.[f.key as keyof Briefing];\n    return value && value !== \"\";\n  }).length;\n  const progressPercent = Math.round((completedFields / requiredFields.length) * 100);\n  const allFieldsCompleted = completedFields === requiredFields.length;\n\n  const { uploadFile, isUploading } = useUpload({\n    onError: (error) => {\n      toast({\n        title: \"Erro no upload\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (message: string) => {\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/briefing/chat`, {\n        message,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"briefing\"] });\n      setInput(\"\");\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível enviar a mensagem.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const sendDocumentMutation = useMutation({\n    mutationFn: async (file: File) => {\n      // Max file size 500KB for text files\n      const maxSize = 500 * 1024;\n      if (file.size > maxSize) {\n        throw new Error(\"Arquivo muito grande. Máximo 500KB.\");\n      }\n      \n      // Step 1: Upload to object storage\n      const objectPath = await uploadFile(file);\n      if (!objectPath) {\n        throw new Error(\"Falha no upload do arquivo.\");\n      }\n      \n      // Step 2: Notify backend to process the uploaded document\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/briefing/document`, {\n        filename: file.name,\n        objectPath,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"briefing\"] });\n      setSelectedFile(null);\n      toast({\n        title: \"Documento processado\",\n        description: \"As informações do documento foram extraídas.\",\n        variant: \"success\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error?.message || \"Não foi possível processar o documento.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const completeBriefingMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/briefing/complete`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId] });\n      toast({\n        title: \"Briefing Concluído\",\n        description: \"O escopo e roadmap foram gerados automaticamente.\",\n        variant: \"success\",\n      });\n      navigate(`/projects/${projectId}`);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível concluir o briefing.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const saveVisualIdentityMutation = useMutation({\n    mutationFn: async (styleId: string) => {\n      const selectedStyle = visualStyles.find((s) => s.id === styleId);\n      return await apiRequest(\"PATCH\", `/api/projects/${projectId}/briefing`, {\n        visualIdentity: selectedStyle,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"briefing\"] });\n      toast({\n        title: \"Estilo salvo\",\n        description: \"A identidade visual foi definida para o projeto.\",\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível salvar o estilo.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const uploadImageReferenceMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const maxSize = 5 * 1024 * 1024;\n      if (file.size > maxSize) {\n        throw new Error(\"Imagem muito grande. Máximo 5MB.\");\n      }\n      \n      const objectPath = await uploadFile(file);\n      if (!objectPath) {\n        throw new Error(\"Falha no upload da imagem.\");\n      }\n      \n      return await apiRequest(\"POST\", `/api/projects/${projectId}/briefing/image-reference`, {\n        filename: file.name,\n        objectPath,\n        mimeType: file.type,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"briefing\"] });\n      toast({\n        title: \"Imagem adicionada\",\n        description: \"Referência visual adicionada ao projeto.\",\n        variant: \"success\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error?.message || \"Não foi possível enviar a imagem.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteImageReferenceMutation = useMutation({\n    mutationFn: async (refId: string) => {\n      return await apiRequest(\"DELETE\", `/api/projects/${projectId}/briefing/image-reference/${refId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"briefing\"] });\n      toast({\n        title: \"Imagem removida\",\n        description: \"Referência visual removida do projeto.\",\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível remover a imagem.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const currentVisualIdentity = (briefing?.visualIdentity as any)?.id;\n  const visualReferences = (briefing?.visualReferences as VisualReference[]) || [];\n  const imageInputRef = useRef<HTMLInputElement>(null);\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      uploadImageReferenceMutation.mutate(file);\n    }\n    e.target.value = \"\";\n  };\n\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  const handleSend = () => {\n    if (!input.trim() || sendMessageMutation.isPending) return;\n    sendMessageMutation.mutate(input.trim());\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // Check file type\n      const allowedTypes = [\n        \"text/plain\",\n        \"text/markdown\",\n        \"application/json\",\n        \"text/csv\",\n        \"text/html\",\n      ];\n      if (!allowedTypes.includes(file.type) && !file.name.endsWith(\".md\") && !file.name.endsWith(\".txt\")) {\n        toast({\n          title: \"Tipo de arquivo não suportado\",\n          description: \"Por favor, envie arquivos de texto (.txt, .md, .json, .csv).\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setSelectedFile(file);\n    }\n  };\n\n  const handleSendDocument = () => {\n    if (!selectedFile || sendDocumentMutation.isPending) return;\n    sendDocumentMutation.mutate(selectedFile);\n  };\n\n  const isLoading = projectLoading || briefingLoading;\n  const isSending = sendMessageMutation.isPending || sendDocumentMutation.isPending;\n\n  if (isLoading) {\n    return (\n      <div className=\"h-full flex flex-col\">\n        <div className=\"p-6 border-b border-border\">\n          <Skeleton className=\"h-8 w-64 mb-2\" />\n          <Skeleton className=\"h-4 w-48\" />\n        </div>\n        <div className=\"flex-1 p-6\">\n          <Skeleton className=\"h-full w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <div className=\"p-4 md:p-6 border-b border-border bg-background\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(`/projects/${projectId}`)}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n            </Button>\n            <div>\n              <div className=\"flex items-center gap-2\">\n                <Brain className=\"w-5 h-5 text-primary\" />\n                <h1 className=\"text-xl font-semibold text-foreground\">\n                  Briefing Inteligente\n                </h1>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">{project?.name}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <div className=\"flex items-center gap-2 text-sm\">\n              <span className=\"text-muted-foreground\">Progresso:</span>\n              <Progress value={progressPercent} className=\"w-24 h-2\" />\n              <span className=\"font-medium text-foreground\">{progressPercent}%</span>\n            </div>\n            {progressPercent === 100 && (\n              <Button\n                onClick={() => completeBriefingMutation.mutate()}\n                disabled={completeBriefingMutation.isPending}\n                data-testid=\"button-complete-briefing\"\n              >\n                {completeBriefingMutation.isPending ? (\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                ) : (\n                  <CheckCircle2 className=\"w-4 h-4 mr-2\" />\n                )}\n                Concluir Briefing\n              </Button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 flex overflow-hidden\">\n        <div className=\"flex-1 flex flex-col\">\n          <ScrollArea className=\"flex-1 p-4 md:p-6\" ref={scrollRef}>\n            <div className=\"max-w-3xl mx-auto space-y-4\">\n              {messages.length === 0 && (\n                <div className=\"text-center py-12\">\n                  <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-4\">\n                    <MessageSquare className=\"w-8 h-8 text-primary\" />\n                  </div>\n                  <h3 className=\"font-medium text-foreground mb-2\">\n                    Vamos comecar o briefing!\n                  </h3>\n                  <p className=\"text-sm text-muted-foreground max-w-md mx-auto mb-4\">\n                    Descreva seu projeto de forma livre ou envie um documento.\n                    A IA vai interpretar e fazer perguntas estrategicas.\n                  </p>\n                  <div className=\"flex items-center justify-center gap-2 text-xs text-muted-foreground\">\n                    <FileText className=\"w-3 h-3\" />\n                    <span>Aceita: .txt, .md, .json, .csv</span>\n                  </div>\n                </div>\n              )}\n\n              {messages.map((message, index) => (\n                <div\n                  key={index}\n                  className={`flex gap-3 ${\n                    message.role === \"user\" ? \"justify-end\" : \"justify-start\"\n                  }`}\n                >\n                  {message.role === \"assistant\" && (\n                    <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\n                      <Brain className=\"w-4 h-4 text-primary\" />\n                    </div>\n                  )}\n                  <div className=\"flex flex-col gap-3 max-w-[80%]\">\n                    <div\n                      className={`rounded-lg p-4 ${\n                        message.role === \"user\"\n                          ? \"bg-primary text-primary-foreground\"\n                          : \"bg-muted text-foreground\"\n                      }`}\n                      data-testid={`message-${message.role}-${index}`}\n                    >\n                      <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n                    </div>\n                    \n                    {message.role === \"assistant\" && message.isReadyToFinalize && index === messages.length - 1 && (\n                      <div className=\"flex flex-col gap-2\">\n                        {!allFieldsCompleted && (\n                          <div className=\"text-sm text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-950/30 p-3 rounded-lg\">\n                            <p className=\"font-medium mb-1\">Campos pendentes:</p>\n                            <ul className=\"list-disc list-inside text-xs\">\n                              {requiredFields.filter((f) => {\n                                const value = briefing?.[f.key as keyof Briefing];\n                                return !value || value === \"\";\n                              }).map((f) => (\n                                <li key={f.key}>{f.label}</li>\n                              ))}\n                            </ul>\n                            <p className=\"text-xs mt-2\">Preencha os campos pendentes na aba lateral ou continue a conversa.</p>\n                          </div>\n                        )}\n                        <div className=\"flex gap-2\">\n                          <Button\n                            onClick={() => completeBriefingMutation.mutate()}\n                            disabled={completeBriefingMutation.isPending || !allFieldsCompleted}\n                            className=\"flex-1\"\n                            data-testid=\"button-finalize-yes\"\n                          >\n                            {completeBriefingMutation.isPending ? (\n                              <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                            ) : (\n                              <CheckCircle2 className=\"w-4 h-4 mr-2\" />\n                            )}\n                            Pode finalizar o projeto\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            onClick={() => {\n                              setInput(\"Gostaria de adicionar mais informações: \");\n                            }}\n                            disabled={completeBriefingMutation.isPending}\n                            data-testid=\"button-add-more-info\"\n                          >\n                            Adicionar mais detalhes\n                          </Button>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                  {message.role === \"user\" && (\n                    <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n                      <User className=\"w-4 h-4 text-muted-foreground\" />\n                    </div>\n                  )}\n                </div>\n              ))}\n\n              {isSending && (\n                <div className=\"flex gap-3 justify-start\">\n                  <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\n                    <Brain className=\"w-4 h-4 text-primary\" />\n                  </div>\n                  <div className=\"bg-muted rounded-lg p-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                      <span className=\"text-sm text-muted-foreground\">\n                        Analisando...\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n\n          <div className=\"p-4 md:p-6 border-t border-border bg-background\">\n            <div className=\"max-w-3xl mx-auto\">\n              {selectedFile && (\n                <div className=\"mb-3 flex items-center gap-2 p-2 rounded-lg bg-muted\">\n                  <FileText className=\"w-4 h-4 text-primary\" />\n                  <span className=\"text-sm flex-1 truncate\">{selectedFile.name}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"w-6 h-6\"\n                    onClick={() => setSelectedFile(null)}\n                    data-testid=\"button-remove-file\"\n                  >\n                    <X className=\"w-3 h-3\" />\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    onClick={handleSendDocument}\n                    disabled={sendDocumentMutation.isPending}\n                    data-testid=\"button-send-document\"\n                  >\n                    {sendDocumentMutation.isPending ? (\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                    ) : (\n                      \"Enviar\"\n                    )}\n                  </Button>\n                </div>\n              )}\n\n              {isListening && (\n                <div className=\"mb-3\">\n                  <AudioWaveform isActive={isListening} />\n                </div>\n              )}\n\n              <div className=\"flex items-end gap-2\">\n                <input\n                  type=\"file\"\n                  ref={fileInputRef}\n                  onChange={handleFileSelect}\n                  accept=\".txt,.md,.json,.csv,.html\"\n                  className=\"hidden\"\n                  data-testid=\"input-file\"\n                />\n                \n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"icon\"\n                    className=\"h-12 w-12 rounded-xl shrink-0\"\n                    onClick={() => fileInputRef.current?.click()}\n                    disabled={isSending}\n                    data-testid=\"button-attach-file\"\n                  >\n                    <Paperclip className=\"w-5 h-5\" />\n                  </Button>\n                  \n                  {speechSupported && (\n                    <Button\n                      variant={isListening ? \"destructive\" : \"outline\"}\n                      size=\"icon\"\n                      className=\"h-12 w-12 rounded-xl shrink-0\"\n                      onClick={isListening ? stopRecording : startRecording}\n                      disabled={isSending}\n                      data-testid=\"button-microphone\"\n                    >\n                      {isListening ? (\n                        <Square className=\"w-4 h-4\" />\n                      ) : (\n                        <Mic className=\"w-5 h-5\" />\n                      )}\n                    </Button>\n                  )}\n                </div>\n\n                <Textarea\n                  value={input}\n                  onChange={(e) => setInput(e.target.value)}\n                  onKeyDown={handleKeyDown}\n                  placeholder={isListening ? \"Fale agora... clique no quadrado para parar e transcrever\" : \"Descreva seu projeto ou responda as perguntas da IA...\"}\n                  className=\"min-h-[100px] max-h-[300px] resize-none flex-1 rounded-xl text-base\"\n                  disabled={isSending || isListening}\n                  data-testid=\"input-briefing-message\"\n                />\n                \n                <Button\n                  onClick={handleSend}\n                  disabled={!input.trim() || isSending || isListening}\n                  size=\"icon\"\n                  className=\"h-12 w-12 rounded-xl shrink-0\"\n                  data-testid=\"button-send-message\"\n                >\n                  {sendMessageMutation.isPending ? (\n                    <Loader2 className=\"w-5 h-5 animate-spin\" />\n                  ) : (\n                    <Send className=\"w-5 h-5\" />\n                  )}\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"hidden lg:block w-80 border-l border-border p-4 bg-muted/30 overflow-y-auto\">\n          <h3 className=\"font-medium text-foreground mb-4\">Campos do Briefing</h3>\n          <div className=\"space-y-3 mb-6\">\n            {requiredFields.map((field) => {\n              const value = briefing?.[field.key as keyof Briefing];\n              const isComplete = value && value !== \"\" && (typeof value !== \"object\" || Object.keys(value as object).length > 0);\n              return (\n                <div\n                  key={field.key}\n                  className=\"flex items-center gap-2\"\n                  data-testid={`field-status-${field.key}`}\n                >\n                  {isComplete ? (\n                    <CheckCircle2 className=\"w-4 h-4 text-green-500\" />\n                  ) : (\n                    <div className=\"w-4 h-4 rounded-full border-2 border-muted-foreground/30\" />\n                  )}\n                  <span\n                    className={`text-sm ${\n                      isComplete ? \"text-foreground\" : \"text-muted-foreground\"\n                    }`}\n                  >\n                    {field.label}\n                  </span>\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"border-t border-border pt-4 mb-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"flex items-center gap-2\">\n                <ImagePlus className=\"w-4 h-4 text-primary\" />\n                <h3 className=\"font-medium text-foreground\">Referências Visuais</h3>\n              </div>\n              <input\n                type=\"file\"\n                ref={imageInputRef}\n                onChange={handleImageSelect}\n                accept=\"image/*\"\n                className=\"hidden\"\n                data-testid=\"input-image\"\n              />\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => imageInputRef.current?.click()}\n                disabled={uploadImageReferenceMutation.isPending}\n                data-testid=\"button-add-image\"\n              >\n                {uploadImageReferenceMutation.isPending ? (\n                  <Loader2 className=\"w-3 h-3 animate-spin\" />\n                ) : (\n                  \"Adicionar\"\n                )}\n              </Button>\n            </div>\n            <p className=\"text-xs text-muted-foreground mb-3\">\n              Envie imagens como referência de estilo\n            </p>\n            {visualReferences.length > 0 ? (\n              <div className=\"grid grid-cols-2 gap-2\">\n                {visualReferences.map((ref) => (\n                  <div\n                    key={ref.id}\n                    className=\"relative group rounded-lg overflow-hidden border border-border\"\n                    data-testid={`image-ref-${ref.id}`}\n                  >\n                    <div className=\"aspect-square bg-muted flex items-center justify-center\">\n                      <img\n                        src={`/api/files/${ref.objectPath}`}\n                        alt={ref.filename}\n                        className=\"w-full h-full object-cover\"\n                        onError={(e) => {\n                          e.currentTarget.style.display = 'none';\n                          e.currentTarget.parentElement!.innerHTML = '<div class=\"w-6 h-6 text-muted-foreground flex items-center justify-center\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect width=\"18\" height=\"18\" x=\"3\" y=\"3\" rx=\"2\" ry=\"2\"/><circle cx=\"9\" cy=\"9\" r=\"2\"/><path d=\"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\"/></svg></div>';\n                        }}\n                      />\n                    </div>\n                    <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                      <Button\n                        variant=\"destructive\"\n                        size=\"icon\"\n                        className=\"h-8 w-8\"\n                        onClick={() => deleteImageReferenceMutation.mutate(ref.id)}\n                        disabled={deleteImageReferenceMutation.isPending}\n                        data-testid={`button-delete-ref-${ref.id}`}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground p-1 truncate\">\n                      {ref.filename}\n                    </p>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-4 text-xs text-muted-foreground border border-dashed border-border rounded-lg\">\n                Nenhuma referência adicionada\n              </div>\n            )}\n          </div>\n\n          <div className=\"border-t border-border pt-4\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <Palette className=\"w-4 h-4 text-primary\" />\n              <h3 className=\"font-medium text-foreground\">Estilos Pré-definidos</h3>\n            </div>\n            <p className=\"text-xs text-muted-foreground mb-4\">\n              Ou selecione um estilo visual\n            </p>\n            <div className=\"space-y-2\">\n              {visualStyles.map((style) => (\n                <button\n                  key={style.id}\n                  onClick={() => saveVisualIdentityMutation.mutate(style.id)}\n                  disabled={saveVisualIdentityMutation.isPending}\n                  className={`w-full p-3 rounded-lg border text-left transition-all ${\n                    currentVisualIdentity === style.id\n                      ? \"border-primary bg-primary/5\"\n                      : \"border-border hover:border-primary/50\"\n                  }`}\n                  data-testid={`style-${style.id}`}\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div className={`w-10 h-10 rounded-lg ${style.preview} flex-shrink-0`} />\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-sm font-medium text-foreground\">\n                          {style.name}\n                        </span>\n                        {currentVisualIdentity === style.id && (\n                          <Check className=\"w-3 h-3 text-primary\" />\n                        )}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground mt-0.5\">\n                        {style.description}\n                      </p>\n                      <div className=\"flex gap-1 mt-2\">\n                        {style.colors.map((color, i) => (\n                          <div\n                            key={i}\n                            className=\"w-4 h-4 rounded-full border border-border\"\n                            style={{ backgroundColor: color }}\n                          />\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":36907,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  FolderKanban,\n  Users,\n  CheckCircle2,\n  Clock,\n  Plus,\n  ArrowRight,\n  TrendingUp,\n  AlertCircle,\n} from \"lucide-react\";\nimport type { Client, Project } from \"@shared/schema\";\n\nconst statusColors: Record<string, string> = {\n  briefing: \"bg-yellow-500/10 text-yellow-600 dark:text-yellow-400\",\n  planning: \"bg-blue-500/10 text-blue-600 dark:text-blue-400\",\n  design: \"bg-purple-500/10 text-purple-600 dark:text-purple-400\",\n  development: \"bg-orange-500/10 text-orange-600 dark:text-orange-400\",\n  testing: \"bg-pink-500/10 text-pink-600 dark:text-pink-400\",\n  deploy: \"bg-cyan-500/10 text-cyan-600 dark:text-cyan-400\",\n  completed: \"bg-green-500/10 text-green-600 dark:text-green-400\",\n};\n\nconst statusLabels: Record<string, string> = {\n  briefing: \"Briefing\",\n  planning: \"Planejamento\",\n  design: \"Design\",\n  development: \"Desenvolvimento\",\n  testing: \"Testes\",\n  deploy: \"Deploy\",\n  completed: \"Concluído\",\n};\n\nexport default function Dashboard() {\n  const { data: clients, isLoading: clientsLoading } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const { data: projects, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const isLoading = clientsLoading || projectsLoading;\n\n  const activeProjects = projects?.filter((p) => p.status !== \"completed\") || [];\n  const completedProjects = projects?.filter((p) => p.status === \"completed\") || [];\n  const recentProjects = projects?.slice(0, 5) || [];\n\n  const getClientName = (clientId: string) => {\n    return clients?.find((c) => c.id === clientId)?.name || \"Cliente\";\n  };\n\n  const stats = [\n    {\n      label: \"Total de Clientes\",\n      value: clients?.length || 0,\n      icon: Users,\n      color: \"text-blue-500\",\n    },\n    {\n      label: \"Projetos Ativos\",\n      value: activeProjects.length,\n      icon: FolderKanban,\n      color: \"text-orange-500\",\n    },\n    {\n      label: \"Projetos Concluídos\",\n      value: completedProjects.length,\n      icon: CheckCircle2,\n      color: \"text-green-500\",\n    },\n    {\n      label: \"Em Andamento\",\n      value: projects?.filter((p) => p.status === \"development\").length || 0,\n      icon: TrendingUp,\n      color: \"text-purple-500\",\n    },\n  ];\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <Skeleton className=\"h-8 w-48\" />\n          <Skeleton className=\"h-10 w-32\" />\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {[...Array(4)].map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-4 w-24 mb-2\" />\n                <Skeleton className=\"h-8 w-16\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {[...Array(3)].map((_, i) => (\n              <Skeleton key={i} className=\"h-20 w-full\" />\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold text-foreground\">Dashboard</h1>\n          <p className=\"text-muted-foreground\">\n            Visao geral dos seus projetos e clientes\n          </p>\n        </div>\n        <div className=\"flex gap-2 flex-wrap\">\n          <Link href=\"/clients/new\">\n            <Button variant=\"outline\" data-testid=\"button-new-client-dashboard\">\n              <Users className=\"w-4 h-4 mr-2\" />\n              Novo Cliente\n            </Button>\n          </Link>\n          <Link href=\"/projects/new\">\n            <Button data-testid=\"button-new-project-dashboard\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Novo Projeto\n            </Button>\n          </Link>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {stats.map((stat, index) => (\n          <Card key={index}>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">{stat.label}</p>\n                  <p className=\"text-2xl font-bold text-foreground\">{stat.value}</p>\n                </div>\n                <div className={`p-3 rounded-lg bg-muted ${stat.color}`}>\n                  <stat.icon className=\"w-5 h-5\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-lg\">Projetos Recentes</CardTitle>\n            <Link href=\"/projects\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-view-all-projects\">\n                Ver todos\n                <ArrowRight className=\"w-4 h-4 ml-1\" />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent>\n            {recentProjects.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <FolderKanban className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                <h3 className=\"font-medium text-foreground mb-2\">Nenhum projeto ainda</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Crie seu primeiro projeto para comecar\n                </p>\n                <Link href=\"/projects/new\">\n                  <Button data-testid=\"button-create-first-project\">\n                    <Plus className=\"w-4 h-4 mr-2\" />\n                    Criar Projeto\n                  </Button>\n                </Link>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {recentProjects.map((project) => (\n                  <Link key={project.id} href={`/projects/${project.id}`}>\n                    <div\n                      className=\"p-4 rounded-lg border border-border hover-elevate cursor-pointer\"\n                      data-testid={`project-card-${project.id}`}\n                    >\n                      <div className=\"flex items-start justify-between gap-4 mb-3\">\n                        <div className=\"flex-1 min-w-0\">\n                          <h4 className=\"font-medium text-foreground truncate\">\n                            {project.name}\n                          </h4>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {getClientName(project.clientId)}\n                          </p>\n                        </div>\n                        <Badge\n                          variant=\"secondary\"\n                          className={statusColors[project.status]}\n                        >\n                          {statusLabels[project.status]}\n                        </Badge>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span className=\"text-muted-foreground\">Progresso</span>\n                          <span className=\"font-medium text-foreground\">\n                            {project.progress || 0}%\n                          </span>\n                        </div>\n                        <Progress value={project.progress || 0} className=\"h-2\" />\n                      </div>\n                    </div>\n                  </Link>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Atividade Recente</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {recentProjects.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <Clock className=\"w-10 h-10 mx-auto text-muted-foreground mb-3\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  Nenhuma atividade recente\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {recentProjects.slice(0, 4).map((project) => (\n                  <div\n                    key={project.id}\n                    className=\"flex items-start gap-3 text-sm\"\n                  >\n                    <div className=\"mt-0.5\">\n                      <FolderKanban className=\"w-4 h-4 text-muted-foreground\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-foreground truncate\">\n                        <span className=\"font-medium\">{project.name}</span>\n                      </p>\n                      <p className=\"text-muted-foreground text-xs\">\n                        Status: {statusLabels[project.status]}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9691,"size_tokens":null},"client/src/pages/client-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ArrowLeft, Save, Loader2 } from \"lucide-react\";\nimport type { Client } from \"@shared/schema\";\n\nconst clientFormSchema = z.object({\n  name: z.string().min(1, \"Nome é obrigatório\"),\n  email: z.string().email(\"Email inválido\").optional().or(z.literal(\"\")),\n  phone: z.string().optional(),\n  company: z.string().optional(),\n  notes: z.string().optional(),\n});\n\ntype ClientFormValues = z.infer<typeof clientFormSchema>;\n\nexport default function ClientForm() {\n  const [, navigate] = useLocation();\n  const [, params] = useRoute(\"/clients/:id\");\n  const isEditing = params?.id && params.id !== \"new\";\n  const { toast } = useToast();\n\n  const { data: client, isLoading: clientLoading } = useQuery<Client>({\n    queryKey: [\"/api/clients\", params?.id],\n    enabled: !!isEditing,\n  });\n\n  const form = useForm<ClientFormValues>({\n    resolver: zodResolver(clientFormSchema),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      phone: \"\",\n      company: \"\",\n      notes: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (client && isEditing) {\n      form.reset({\n        name: client.name,\n        email: client.email || \"\",\n        phone: client.phone || \"\",\n        company: client.company || \"\",\n        notes: client.notes || \"\",\n      });\n    }\n  }, [client, isEditing, form]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: ClientFormValues) => {\n      return await apiRequest(\"POST\", \"/api/clients\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      toast({\n        title: \"Cliente criado\",\n        description: \"O cliente foi criado com sucesso.\",\n        variant: \"success\",\n      });\n      navigate(\"/\");\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível criar o cliente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: ClientFormValues) => {\n      return await apiRequest(\"PUT\", `/api/clients/${params?.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\", params?.id] });\n      toast({\n        title: \"Cliente atualizado\",\n        description: \"O cliente foi atualizado com sucesso.\",\n        variant: \"success\",\n      });\n      navigate(\"/\");\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível atualizar o cliente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ClientFormValues) => {\n    if (isEditing) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const isPending = createMutation.isPending || updateMutation.isPending;\n\n  if (isEditing && clientLoading) {\n    return (\n      <div className=\"p-6 flex items-center justify-center min-h-[400px]\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 max-w-2xl mx-auto\">\n      <div className=\"mb-6\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => navigate(\"/\")}\n          className=\"mb-4\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          Voltar\n        </Button>\n        <h1 className=\"text-2xl font-semibold text-foreground\">\n          {isEditing ? \"Editar Cliente\" : \"Novo Cliente\"}\n        </h1>\n        <p className=\"text-muted-foreground\">\n          {isEditing\n            ? \"Atualize as informações do cliente\"\n            : \"Preencha as informações do novo cliente\"}\n        </p>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Nome *</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Nome do cliente\"\n                        {...field}\n                        data-testid=\"input-client-name\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"email\"\n                          placeholder=\"email@exemplo.com\"\n                          {...field}\n                          data-testid=\"input-client-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Telefone</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"(00) 00000-0000\"\n                          {...field}\n                          data-testid=\"input-client-phone\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"company\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Empresa</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Nome da empresa\"\n                        {...field}\n                        data-testid=\"input-client-company\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Observacoes</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Notas adicionais sobre o cliente...\"\n                        className=\"min-h-[100px]\"\n                        {...field}\n                        data-testid=\"input-client-notes\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex justify-end gap-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => navigate(\"/\")}\n                  data-testid=\"button-cancel\"\n                >\n                  Cancelar\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={isPending}\n                  data-testid=\"button-save-client\"\n                >\n                  {isPending ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Save className=\"w-4 h-4 mr-2\" />\n                  )}\n                  {isEditing ? \"Atualizar\" : \"Criar\"} Cliente\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":8703,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport {\n  Brain,\n  Zap,\n  Target,\n  Shield,\n  ArrowRight,\n  FileText,\n  GitBranch,\n  CheckSquare,\n  BarChart3,\n} from \"lucide-react\";\n\nexport default function Landing() {\n  const features = [\n    {\n      icon: Brain,\n      title: \"Briefing Inteligente\",\n      description:\n        \"IA interpreta qualquer entrada - texto, áudio ou conversa - e detecta lacunas críticas automaticamente.\",\n    },\n    {\n      icon: Target,\n      title: \"Escopo Automático\",\n      description:\n        \"Geração completa de escopo com objetivo, entregáveis, premissas, dependências e riscos.\",\n    },\n    {\n      icon: GitBranch,\n      title: \"Roadmap Inteligente\",\n      description:\n        \"Fases, marcos, datas sugeridas e SLAs organizados por metodologia escolhida.\",\n    },\n    {\n      icon: Zap,\n      title: \"Comando para IA Dev\",\n      description:\n        \"Prompt estruturado para IAs executoras como Cursor, Devin, Windsurf e ChatGPT Dev.\",\n    },\n    {\n      icon: CheckSquare,\n      title: \"Checklists Inteligentes\",\n      description:\n        \"Listas técnicas, comerciais, jurídicas, de entrega e validação geradas automaticamente.\",\n    },\n    {\n      icon: BarChart3,\n      title: \"Controle de Progresso\",\n      description:\n        \"Acompanhamento por estágios com cálculo automático de percentual e aprovações.\",\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-50 border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"container mx-auto px-6 h-16 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex items-center justify-center w-10 h-10 rounded-lg bg-primary text-primary-foreground\">\n              <Brain className=\"w-5 h-5\" />\n            </div>\n            <span className=\"font-semibold text-lg\">Project AI</span>\n          </div>\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <ThemeToggle />\n            <a href=\"/login\">\n              <Button variant=\"outline\" data-testid=\"button-login\">\n                Entrar\n              </Button>\n            </a>\n            <a href=\"/register\">\n              <Button data-testid=\"button-register\">\n                Cadastrar\n                <ArrowRight className=\"w-4 h-4 ml-2\" />\n              </Button>\n            </a>\n          </div>\n        </div>\n      </header>\n\n      <main>\n        <section className=\"py-24 px-6\">\n          <div className=\"container mx-auto max-w-5xl text-center\">\n            <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 text-primary text-sm font-medium mb-8\">\n              <Zap className=\"w-4 h-4\" />\n              Plataforma de Inteligência para Gestão de Projetos\n            </div>\n            <h1 className=\"text-4xl md:text-6xl font-bold tracking-tight mb-6 text-foreground\">\n              Transforme qualquer briefing em um{\" \"}\n              <span className=\"text-primary\">projeto completo</span>\n            </h1>\n            <p className=\"text-lg md:text-xl text-muted-foreground max-w-3xl mx-auto mb-10\">\n              Com escopo fechado, roadmap inteligente, comando de execução para IA, \n              gestão de estágios, controle de progresso e governança total.\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n              <a href=\"/register\">\n                <Button size=\"lg\" className=\"w-full sm:w-auto\" data-testid=\"button-get-started\">\n                  Criar Conta Grátis\n                  <ArrowRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n              </a>\n              <a href=\"/login\">\n                <Button size=\"lg\" variant=\"outline\" className=\"w-full sm:w-auto\" data-testid=\"button-already-have-account\">\n                  Já tenho conta\n                </Button>\n              </a>\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-20 px-6 bg-muted/30\">\n          <div className=\"container mx-auto max-w-6xl\">\n            <div className=\"text-center mb-16\">\n              <h2 className=\"text-3xl font-bold mb-4 text-foreground\">\n                Tudo que você precisa para gerenciar projetos com IA\n              </h2>\n              <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n                Uma plataforma completa que elimina caos operacional, retrabalho e \n                falta de previsibilidade.\n              </p>\n            </div>\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {features.map((feature, index) => (\n                <Card key={index} className=\"hover-elevate\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center mb-4\">\n                      <feature.icon className=\"w-6 h-6 text-primary\" />\n                    </div>\n                    <h3 className=\"font-semibold mb-2 text-foreground\">{feature.title}</h3>\n                    <p className=\"text-sm text-muted-foreground\">{feature.description}</p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-20 px-6\">\n          <div className=\"container mx-auto max-w-4xl\">\n            <Card className=\"bg-primary text-primary-foreground\">\n              <CardContent className=\"p-12 text-center\">\n                <h2 className=\"text-3xl font-bold mb-4\">\n                  Pronto para transformar sua gestão de projetos?\n                </h2>\n                <p className=\"text-primary-foreground/80 mb-8 max-w-2xl mx-auto\">\n                  Junte-se a empresas que já estão usando IA para entregar projetos \n                  com mais qualidade, previsibilidade e margem.\n                </p>\n                <a href=\"/api/login\">\n                  <Button\n                    size=\"lg\"\n                    variant=\"secondary\"\n                    data-testid=\"button-cta-bottom\"\n                  >\n                    Começar Gratuitamente\n                    <ArrowRight className=\"w-4 h-4 ml-2\" />\n                  </Button>\n                </a>\n              </CardContent>\n            </Card>\n          </div>\n        </section>\n      </main>\n\n      <footer className=\"border-t border-border py-8 px-6\">\n        <div className=\"container mx-auto text-center text-sm text-muted-foreground\">\n          <p>Project AI - Plataforma de Inteligência para Gestão de Projetos</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":6834,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/pages/project-detail.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation, useRoute, Link } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  ArrowLeft,\n  FileText,\n  GitBranch,\n  CheckSquare,\n  Code,\n  Loader2,\n  Brain,\n  Target,\n  Calendar,\n  Copy,\n  Download,\n  RefreshCw,\n  AlertTriangle,\n  Lightbulb,\n  ListChecks,\n  CheckCircle2,\n  XCircle,\n  Clock,\n  History,\n  BookOpen,\n  Shield,\n  Bot,\n  Trash2,\n  Users,\n  UserPlus,\n  Mail,\n  Briefcase,\n  Pencil,\n  Eye,\n  EyeOff,\n} from \"lucide-react\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport type { Project, Briefing, Scope, Roadmap, Stage, Checklist, Document, AiCommand, Client, ProjectMember, StageAssignment } from \"@shared/schema\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\nconst statusColors: Record<string, string> = {\n  briefing: \"bg-yellow-500/10 text-yellow-600 dark:text-yellow-400\",\n  planning: \"bg-blue-500/10 text-blue-600 dark:text-blue-400\",\n  design: \"bg-purple-500/10 text-purple-600 dark:text-purple-400\",\n  development: \"bg-orange-500/10 text-orange-600 dark:text-orange-400\",\n  testing: \"bg-pink-500/10 text-pink-600 dark:text-pink-400\",\n  deploy: \"bg-cyan-500/10 text-cyan-600 dark:text-cyan-400\",\n  completed: \"bg-green-500/10 text-green-600 dark:text-green-400\",\n};\n\nconst statusLabels: Record<string, string> = {\n  briefing: \"Briefing\",\n  planning: \"Planejamento\",\n  design: \"Design\",\n  development: \"Desenvolvimento\",\n  testing: \"Testes\",\n  deploy: \"Deploy\",\n  completed: \"Concluído\",\n};\n\nconst methodologyLabels: Record<string, string> = {\n  scrum: \"Scrum\",\n  kanban: \"Kanban\",\n  waterfall: \"Waterfall\",\n  hybrid: \"Híbrido\",\n};\n\nexport default function ProjectDetail() {\n  const [, navigate] = useLocation();\n  const [, params] = useRoute(\"/projects/:id\");\n  const projectId = params?.id;\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const { data: project, isLoading: projectLoading } = useQuery<Project>({\n    queryKey: [\"/api/projects\", projectId],\n    enabled: !!projectId,\n  });\n\n  const { data: client } = useQuery<Client>({\n    queryKey: [\"/api/clients\", project?.clientId],\n    enabled: !!project?.clientId,\n  });\n\n  const { data: briefing } = useQuery<Briefing>({\n    queryKey: [\"/api/projects\", projectId, \"briefing\"],\n    enabled: !!projectId,\n  });\n\n  const { data: scope } = useQuery<Scope>({\n    queryKey: [\"/api/projects\", projectId, \"scope\"],\n    enabled: !!projectId,\n  });\n\n  const { data: roadmap } = useQuery<Roadmap>({\n    queryKey: [\"/api/projects\", projectId, \"roadmap\"],\n    enabled: !!projectId,\n  });\n\n  const { data: stages } = useQuery<Stage[]>({\n    queryKey: [\"/api/projects\", projectId, \"stages\"],\n    enabled: !!projectId,\n  });\n\n  const { data: checklists } = useQuery<Checklist[]>({\n    queryKey: [\"/api/projects\", projectId, \"checklists\"],\n    enabled: !!projectId,\n  });\n\n  const { data: documents } = useQuery<Document[]>({\n    queryKey: [\"/api/projects\", projectId, \"documents\"],\n    enabled: !!projectId,\n  });\n\n  const { data: aiCommand } = useQuery<AiCommand>({\n    queryKey: [\"/api/projects\", projectId, \"ai-command\"],\n    enabled: !!projectId,\n  });\n\n  const { data: members } = useQuery<ProjectMember[]>({\n    queryKey: [\"/api/projects\", projectId, \"members\"],\n    enabled: !!projectId,\n  });\n\n  const [showAddMemberModal, setShowAddMemberModal] = useState(false);\n  const [newMember, setNewMember] = useState({ name: \"\", email: \"\", role: \"contributor\", specialty: \"\", password: \"\" });\n  const [assignStageId, setAssignStageId] = useState<string | null>(null);\n  const [selectedMemberToAssign, setSelectedMemberToAssign] = useState<string>(\"\");\n  const [editingMember, setEditingMember] = useState<ProjectMember | null>(null);\n  const [editMemberData, setEditMemberData] = useState({ name: \"\", role: \"\", specialty: \"\", password: \"\" });\n  const [showAddPassword, setShowAddPassword] = useState(false);\n  const [showEditPassword, setShowEditPassword] = useState(false);\n\n  const addMemberMutation = useMutation({\n    mutationFn: async (data: { name: string; email: string; role: string; specialty?: string; password: string }) => {\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/members`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"members\"] });\n      setShowAddMemberModal(false);\n      setNewMember({ name: \"\", email: \"\", role: \"contributor\", specialty: \"\", password: \"\" });\n      toast({\n        title: \"Membro adicionado\",\n        description: \"O profissional foi adicionado à equipe.\",\n        variant: \"success\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Não foi possível adicionar o membro.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const removeMemberMutation = useMutation({\n    mutationFn: async (memberId: string) => {\n      return await apiRequest(\"DELETE\", `/api/projects/${projectId}/members/${memberId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"members\"] });\n      toast({\n        title: \"Membro removido\",\n        description: \"O profissional foi removido da equipe.\",\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível remover o membro.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMemberMutation = useMutation({\n    mutationFn: async ({ memberId, data }: { memberId: string; data: Partial<ProjectMember> }) => {\n      return await apiRequest(\"PUT\", `/api/projects/${projectId}/members/${memberId}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"members\"] });\n      toast({\n        title: \"Membro atualizado\",\n        description: \"As informações do profissional foram atualizadas.\",\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível atualizar o membro.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const assignStageMutation = useMutation({\n    mutationFn: async ({ stageId, memberId }: { stageId: string; memberId: string }) => {\n      return await apiRequest(\"POST\", `/api/stages/${stageId}/assignments`, { memberId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"stages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/me/tasks\"] });\n      setAssignStageId(null);\n      setSelectedMemberToAssign(\"\");\n      toast({\n        title: \"Membro atribuído\",\n        description: \"O profissional foi atribuído ao estágio.\",\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível atribuir o membro.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const regenerateAiCommandMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/ai-command/regenerate`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"ai-command\"] });\n      toast({\n        title: \"Comando Regenerado\",\n        description: \"O comando para IA foi atualizado.\",\n      });\n    },\n  });\n\n  const approveStage = useMutation({\n    mutationFn: async ({ stageId, approved, comment }: { stageId: string; approved: boolean; comment?: string }) => {\n      return await apiRequest(\"POST\", `/api/stages/${stageId}/approve`, { approved, comment });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"stages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId] });\n      toast({\n        title: \"Estágio atualizado\",\n        description: \"O status do estágio foi alterado.\",\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível atualizar o estágio.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteProjectMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"DELETE\", `/api/projects/${projectId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      toast({\n        title: \"Projeto excluído\",\n        description: \"O projeto foi removido com sucesso.\",\n        variant: \"success\",\n      });\n      navigate(\"/\");\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível excluir o projeto.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateChecklistMutation = useMutation({\n    mutationFn: async ({ checklistId, items }: { checklistId: string; items: any[] }) => {\n      return await apiRequest(\"PUT\", `/api/checklists/${checklistId}`, { items });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"checklists\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível atualizar o checklist.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleChecklistItem = (checklist: Checklist, itemIndex: number) => {\n    const items = [...(checklist.items as any[])];\n    items[itemIndex] = { ...items[itemIndex], checked: !items[itemIndex].checked };\n    updateChecklistMutation.mutate({ checklistId: checklist.id, items });\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast({\n      title: \"Copiado\",\n      description: \"Comando copiado para a área de transferência.\",\n      variant: \"success\",\n    });\n  };\n\n  if (projectLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-64\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {[...Array(4)].map((_, i) => (\n            <Skeleton key={i} className=\"h-24\" />\n          ))}\n        </div>\n        <Skeleton className=\"h-[400px]\" />\n      </div>\n    );\n  }\n\n  if (!project) {\n    return (\n      <div className=\"p-6 text-center\">\n        <p className=\"text-muted-foreground\">Projeto não encontrado</p>\n      </div>\n    );\n  }\n\n  const deliverables = (scope?.deliverables as string[]) || [];\n  const risks = (scope?.risks as string[]) || [];\n  const phases = (roadmap?.phases as any[]) || [];\n  const milestones = (roadmap?.milestones as any[]) || [];\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      <div className=\"p-4 md:p-6 border-b border-border bg-background flex-shrink-0\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n            </Button>\n            <AlertDialog>\n              <AlertDialogTrigger asChild>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"text-destructive\"\n                  data-testid=\"button-delete-project\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>Excluir Projeto</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    Tem certeza que deseja excluir o projeto \"{project.name}\"? Esta ação não pode ser desfeita e todos os dados serão perdidos permanentemente.\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                  <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                  <AlertDialogAction\n                    onClick={() => deleteProjectMutation.mutate()}\n                    className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                    disabled={deleteProjectMutation.isPending}\n                  >\n                    {deleteProjectMutation.isPending ? (\n                      <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n                    ) : null}\n                    Excluir\n                  </AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n            <div>\n              <div className=\"flex items-center gap-3 flex-wrap\">\n                <h1 className=\"text-xl font-semibold text-foreground\">\n                  {project.name}\n                </h1>\n                <Badge className={statusColors[project.status]} variant=\"secondary\">\n                  {statusLabels[project.status]}\n                </Badge>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                {client?.name} - {methodologyLabels[project.methodology || \"hybrid\"]}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"text-right hidden sm:block\">\n              <p className=\"text-sm text-muted-foreground\">Progresso</p>\n              <p className=\"font-semibold text-foreground\">{project.progress || 0}%</p>\n            </div>\n            <Progress value={project.progress || 0} className=\"w-32 h-2\" />\n            {project.status === \"briefing\" && (\n              <Link href={`/projects/${projectId}/briefing`}>\n                <Button data-testid=\"button-continue-briefing\">\n                  <Brain className=\"w-4 h-4 mr-2\" />\n                  Continuar Briefing\n                </Button>\n              </Link>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 overflow-hidden\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"h-full flex flex-col\">\n          <div className=\"border-b border-border px-4 md:px-6 flex-shrink-0\">\n            <TabsList className=\"h-12 bg-transparent gap-2\">\n              <Link href={`/projects/${projectId}/briefing`}>\n                <Button variant=\"ghost\" size=\"sm\" className=\"h-9\" data-testid=\"button-briefing-nav\">\n                  <Brain className=\"w-4 h-4 mr-2\" />\n                  Briefing\n                </Button>\n              </Link>\n              <TabsTrigger value=\"overview\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-overview\">\n                <Target className=\"w-4 h-4 mr-2\" />\n                Visão Geral\n              </TabsTrigger>\n              <TabsTrigger value=\"scope\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-scope\">\n                <FileText className=\"w-4 h-4 mr-2\" />\n                Escopo\n              </TabsTrigger>\n              <TabsTrigger value=\"roadmap\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-roadmap\">\n                <GitBranch className=\"w-4 h-4 mr-2\" />\n                Roadmap\n              </TabsTrigger>\n              <TabsTrigger value=\"execution\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-execution\">\n                <ListChecks className=\"w-4 h-4 mr-2\" />\n                Execução\n              </TabsTrigger>\n              <TabsTrigger value=\"ai-command\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-ai-command\">\n                <Code className=\"w-4 h-4 mr-2\" />\n                Comando IA\n              </TabsTrigger>\n              <TabsTrigger value=\"docs\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-docs\">\n                <BookOpen className=\"w-4 h-4 mr-2\" />\n                Documentação\n              </TabsTrigger>\n              <TabsTrigger value=\"team\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-team\">\n                <Users className=\"w-4 h-4 mr-2\" />\n                Equipe\n              </TabsTrigger>\n            </TabsList>\n          </div>\n\n          <ScrollArea className=\"flex-1\">\n            <div className=\"p-4 md:p-6\">\n              <TabsContent value=\"overview\" className=\"mt-0\">\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                  <div className=\"lg:col-span-2 space-y-6\">\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg\">Objetivo</CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <p className=\"text-foreground\">\n                          {scope?.objective || briefing?.businessObjective || \"Objetivo não definido ainda.\"}\n                        </p>\n                      </CardContent>\n                    </Card>\n\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\n                          <CheckSquare className=\"w-5 h-5\" />\n                          Entregáveis\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        {deliverables.length > 0 ? (\n                          <ul className=\"space-y-2\">\n                            {deliverables.map((item: string, index: number) => (\n                              <li key={index} className=\"flex items-start gap-2\">\n                                <div className=\"w-1.5 h-1.5 rounded-full bg-primary mt-2 flex-shrink-0\" />\n                                <span className=\"text-foreground\">{item}</span>\n                              </li>\n                            ))}\n                          </ul>\n                        ) : (\n                          <p className=\"text-muted-foreground\">Entregáveis serão definidos após o briefing.</p>\n                        )}\n                      </CardContent>\n                    </Card>\n\n                    {risks.length > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"text-lg flex items-center gap-2\">\n                            <AlertTriangle className=\"w-5 h-5 text-yellow-500\" />\n                            Riscos Identificados\n                          </CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                          <ul className=\"space-y-2\">\n                            {risks.map((risk: string, index: number) => (\n                              <li key={index} className=\"flex items-start gap-2\">\n                                <div className=\"w-1.5 h-1.5 rounded-full bg-yellow-500 mt-2 flex-shrink-0\" />\n                                <span className=\"text-foreground\">{risk}</span>\n                              </li>\n                            ))}\n                          </ul>\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-6\">\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg\">Detalhes</CardTitle>\n                      </CardHeader>\n                      <CardContent className=\"space-y-4\">\n                        <div>\n                          <p className=\"text-sm text-muted-foreground\">Tipo de Projeto</p>\n                          <p className=\"font-medium text-foreground\">{briefing?.projectType || \"Não definido\"}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-muted-foreground\">Stack</p>\n                          <p className=\"font-medium text-foreground\">{briefing?.stack || \"Não definida\"}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-muted-foreground\">Prazo</p>\n                          <p className=\"font-medium text-foreground\">\n                            {briefing?.deadline ? new Date(briefing.deadline).toLocaleDateString(\"pt-BR\") : \"Não definido\"}\n                          </p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-muted-foreground\">Orçamento</p>\n                          <p className=\"font-medium text-foreground\">{briefing?.budget || \"Não definido\"}</p>\n                        </div>\n                      </CardContent>\n                    </Card>\n\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\n                          <Calendar className=\"w-5 h-5\" />\n                          Estágios\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        {stages && stages.length > 0 ? (\n                          <div className=\"space-y-3\">\n                            {stages.sort((a, b) => a.order - b.order).map((stage) => (\n                              <div key={stage.id} className=\"space-y-1\">\n                                <div className=\"flex items-center justify-between\">\n                                  <span className=\"text-sm font-medium text-foreground\">{stage.name}</span>\n                                  <span className=\"text-xs text-muted-foreground\">{stage.progress}%</span>\n                                </div>\n                                <Progress value={stage.progress || 0} className=\"h-1.5\" />\n                              </div>\n                            ))}\n                          </div>\n                        ) : (\n                          <p className=\"text-sm text-muted-foreground\">Estágios serão criados após o briefing.</p>\n                        )}\n                      </CardContent>\n                    </Card>\n                  </div>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"scope\" className=\"mt-0\">\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                  <Card>\n                    <CardHeader>\n                      <CardTitle>Objetivo do Projeto</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-foreground\">{scope?.objective || \"Não definido\"}</p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader>\n                      <CardTitle>Entregáveis</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      {deliverables.length > 0 ? (\n                        <ul className=\"space-y-2\">\n                          {deliverables.map((item: string, index: number) => (\n                            <li key={index} className=\"flex items-start gap-2\">\n                              <CheckSquare className=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                              <span className=\"text-foreground\">{item}</span>\n                            </li>\n                          ))}\n                        </ul>\n                      ) : (\n                        <p className=\"text-muted-foreground\">Nenhum entregavel definido.</p>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader>\n                      <CardTitle>Fora do Escopo</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      {(scope?.outOfScope as string[])?.length > 0 ? (\n                        <ul className=\"space-y-2\">\n                          {(scope?.outOfScope as string[]).map((item: string, index: number) => (\n                            <li key={index} className=\"flex items-start gap-2\">\n                              <div className=\"w-1.5 h-1.5 rounded-full bg-red-500 mt-2 flex-shrink-0\" />\n                              <span className=\"text-foreground\">{item}</span>\n                            </li>\n                          ))}\n                        </ul>\n                      ) : (\n                        <p className=\"text-muted-foreground\">Nenhum item fora do escopo.</p>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        <Lightbulb className=\"w-5 h-5\" />\n                        Premissas\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      {(scope?.assumptions as string[])?.length > 0 ? (\n                        <ul className=\"space-y-2\">\n                          {(scope?.assumptions as string[]).map((item: string, index: number) => (\n                            <li key={index} className=\"flex items-start gap-2\">\n                              <div className=\"w-1.5 h-1.5 rounded-full bg-blue-500 mt-2 flex-shrink-0\" />\n                              <span className=\"text-foreground\">{item}</span>\n                            </li>\n                          ))}\n                        </ul>\n                      ) : (\n                        <p className=\"text-muted-foreground\">Nenhuma premissa definida.</p>\n                      )}\n                    </CardContent>\n                  </Card>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"roadmap\" className=\"mt-0\">\n                <div className=\"space-y-6\">\n                  {phases.length > 0 ? (\n                    <div className=\"relative\">\n                      <div className=\"absolute left-4 top-0 bottom-0 w-0.5 bg-border\" />\n                      <div className=\"space-y-6\">\n                        {phases.map((phase: any, index: number) => (\n                          <div key={index} className=\"relative pl-10\">\n                            <div className=\"absolute left-2.5 w-3 h-3 rounded-full bg-primary\" />\n                            <Card>\n                              <CardHeader className=\"pb-2\">\n                                <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                                  <CardTitle className=\"text-base\">{phase.name}</CardTitle>\n                                  {phase.duration && (\n                                    <Badge variant=\"secondary\">{phase.duration}</Badge>\n                                  )}\n                                </div>\n                              </CardHeader>\n                              <CardContent>\n                                <p className=\"text-sm text-muted-foreground\">{phase.description}</p>\n                                {phase.tasks && phase.tasks.length > 0 && (\n                                  <ul className=\"mt-3 space-y-1\">\n                                    {phase.tasks.map((task: string, taskIndex: number) => (\n                                      <li key={taskIndex} className=\"text-sm text-foreground flex items-center gap-2\">\n                                        <div className=\"w-1 h-1 rounded-full bg-muted-foreground\" />\n                                        {task}\n                                      </li>\n                                    ))}\n                                  </ul>\n                                )}\n                              </CardContent>\n                            </Card>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ) : (\n                    <Card>\n                      <CardContent className=\"py-12 text-center\">\n                        <GitBranch className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                        <h3 className=\"font-medium text-foreground mb-2\">Roadmap não gerado</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          O roadmap será gerado automaticamente após o briefing.\n                        </p>\n                      </CardContent>\n                    </Card>\n                  )}\n\n                  {milestones.length > 0 && (\n                    <Card>\n                      <CardHeader>\n                        <CardTitle>Marcos do Projeto</CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                          {milestones.map((milestone: any, index: number) => (\n                            <div key={index} className=\"p-4 rounded-lg bg-muted\">\n                              <p className=\"font-medium text-foreground\">{milestone.name}</p>\n                              {milestone.date && (\n                                <p className=\"text-sm text-muted-foreground\">\n                                  {new Date(milestone.date).toLocaleDateString(\"pt-BR\")}\n                                </p>\n                              )}\n                            </div>\n                          ))}\n                        </div>\n                      </CardContent>\n                    </Card>\n                  )}\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"execution\" className=\"mt-0\">\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                    <div>\n                      <h2 className=\"text-lg font-semibold text-foreground\">Estágios do Projeto</h2>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Gerencie o progresso e aprovação de cada estágio\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <Link href={`/projects/${projectId}/agents`}>\n                        <Button variant=\"outline\" data-testid=\"button-view-agents\">\n                          <Bot className=\"w-4 h-4 mr-2\" />\n                          Análises Agentes IA\n                        </Button>\n                      </Link>\n                      <Link href={`/projects/${projectId}/mindmap`}>\n                        <Button variant=\"outline\" data-testid=\"button-view-mindmap\">\n                          <GitBranch className=\"w-4 h-4 mr-2\" />\n                          Mapa Mental\n                        </Button>\n                      </Link>\n                      <Link href={`/projects/${projectId}/vault`}>\n                        <Button variant=\"outline\" data-testid=\"button-view-vault\">\n                          <Shield className=\"w-4 h-4 mr-2\" />\n                          Cofre\n                        </Button>\n                      </Link>\n                      <Link href={`/projects/${projectId}/timeline`}>\n                        <Button variant=\"outline\" data-testid=\"button-view-timeline\">\n                          <Calendar className=\"w-4 h-4 mr-2\" />\n                          Timeline\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n\n                  {stages && stages.length > 0 ? (\n                    <div className=\"space-y-4\">\n                      {stages.sort((a, b) => a.order - b.order).map((stage) => {\n                        const approvalHistory = (stage.approvalHistory as any[]) || [];\n                        const isApproved = stage.status === \"approved\";\n                        const isRejected = stage.status === \"rejected\";\n                        const canApprove = (stage.progress || 0) >= 100 && !isApproved;\n                        \n                        return (\n                          <Card key={stage.id} data-testid={`stage-card-${stage.id}`}>\n                            <CardHeader className=\"pb-2\">\n                              <div className=\"flex items-center justify-between gap-3 flex-wrap\">\n                                <div className=\"flex items-center gap-3\">\n                                  <div className={`p-2 rounded-lg ${\n                                    isApproved ? \"bg-green-500/10\" :\n                                    isRejected ? \"bg-red-500/10\" :\n                                    stage.status === \"in_progress\" ? \"bg-blue-500/10\" :\n                                    \"bg-muted\"\n                                  }`}>\n                                    {isApproved ? <CheckCircle2 className=\"w-5 h-5 text-green-500\" /> :\n                                     isRejected ? <XCircle className=\"w-5 h-5 text-red-500\" /> :\n                                     stage.status === \"in_progress\" ? <Clock className=\"w-5 h-5 text-blue-500\" /> :\n                                     <ListChecks className=\"w-5 h-5 text-muted-foreground\" />}\n                                  </div>\n                                  <div>\n                                    <CardTitle className=\"text-base\">{stage.name}</CardTitle>\n                                    <p className=\"text-xs text-muted-foreground\">Peso: {stage.weight}%</p>\n                                  </div>\n                                </div>\n                                <div className=\"flex items-center gap-2 flex-wrap\">\n                                  <Badge\n                                    variant=\"secondary\"\n                                    className={\n                                      isApproved ? \"bg-green-500/10 text-green-600 dark:text-green-400\" :\n                                      isRejected ? \"bg-red-500/10 text-red-600 dark:text-red-400\" :\n                                      stage.status === \"in_progress\" ? \"bg-blue-500/10 text-blue-600 dark:text-blue-400\" :\n                                      \"\"\n                                    }\n                                  >\n                                    {isApproved ? \"Aprovado\" : \n                                     isRejected ? \"Rejeitado\" :\n                                     stage.status === \"in_progress\" ? \"Em andamento\" : \n                                     \"Pendente\"}\n                                  </Badge>\n                                  {canApprove && (\n                                    <>\n                                      <Button\n                                        size=\"sm\"\n                                        onClick={() => approveStage.mutate({ stageId: stage.id, approved: true })}\n                                        disabled={approveStage.isPending}\n                                        data-testid={`button-approve-${stage.id}`}\n                                      >\n                                        {approveStage.isPending ? (\n                                          <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                        ) : (\n                                          <>\n                                            <CheckCircle2 className=\"w-4 h-4 mr-1\" />\n                                            Aprovar\n                                          </>\n                                        )}\n                                      </Button>\n                                      <Button\n                                        size=\"sm\"\n                                        variant=\"destructive\"\n                                        onClick={() => approveStage.mutate({ stageId: stage.id, approved: false })}\n                                        disabled={approveStage.isPending}\n                                        data-testid={`button-reject-${stage.id}`}\n                                      >\n                                        <XCircle className=\"w-4 h-4 mr-1\" />\n                                        Rejeitar\n                                      </Button>\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </CardHeader>\n                            <CardContent>\n                              <div className=\"space-y-3\">\n                                <div className=\"space-y-1\">\n                                  <div className=\"flex items-center justify-between text-sm\">\n                                    <span className=\"text-muted-foreground\">Progresso</span>\n                                    <span className=\"font-medium text-foreground\">{stage.progress}%</span>\n                                  </div>\n                                  <Progress value={stage.progress || 0} className=\"h-2\" />\n                                </div>\n\n                                {isApproved && stage.approvedAt && (\n                                  <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                                    <CheckCircle2 className=\"w-3 h-3 text-green-500\" />\n                                    Aprovado em {new Date(stage.approvedAt).toLocaleDateString(\"pt-BR\")}\n                                  </div>\n                                )}\n\n                                {approvalHistory.length > 0 && (\n                                  <div className=\"pt-2 border-t border-border\">\n                                    <div className=\"flex items-center gap-2 text-xs text-muted-foreground mb-2\">\n                                      <History className=\"w-3 h-3\" />\n                                      Histórico de aprovações\n                                    </div>\n                                    <div className=\"space-y-1\">\n                                      {approvalHistory.slice(-3).reverse().map((entry: any, idx: number) => (\n                                        <div key={idx} className=\"flex items-center gap-2 text-xs\">\n                                          {entry.action === \"approved\" ? (\n                                            <CheckCircle2 className=\"w-3 h-3 text-green-500\" />\n                                          ) : (\n                                            <XCircle className=\"w-3 h-3 text-red-500\" />\n                                          )}\n                                          <span className=\"text-muted-foreground\">\n                                            {entry.action === \"approved\" ? \"Aprovado\" : \"Rejeitado\"} em{\" \"}\n                                            {new Date(entry.timestamp).toLocaleDateString(\"pt-BR\")}\n                                          </span>\n                                        </div>\n                                      ))}\n                                    </div>\n                                  </div>\n                                )}\n\n                                <div className=\"pt-3 border-t border-border\">\n                                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                                    <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                                      <Users className=\"w-3 h-3\" />\n                                      Responsáveis\n                                    </span>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      onClick={() => setAssignStageId(stage.id)}\n                                      data-testid={`button-assign-${stage.id}`}\n                                    >\n                                      <UserPlus className=\"w-3 h-3 mr-1\" />\n                                      Atribuir\n                                    </Button>\n                                  </div>\n                                  {((stage as any).assignments?.length > 0) && (\n                                    <div className=\"flex items-center gap-2 mt-2 flex-wrap\">\n                                      {((stage as any).assignments as any[]).map((assignment: any) => (\n                                        <Badge \n                                          key={assignment.id} \n                                          variant=\"secondary\" \n                                          className=\"text-xs\"\n                                          data-testid={`badge-assignee-${assignment.id}`}\n                                        >\n                                          {assignment.member?.name || \"Membro\"}\n                                          {assignment.member?.specialty && (\n                                            <span className=\"ml-1 text-muted-foreground\">\n                                              ({assignment.member.specialty})\n                                            </span>\n                                          )}\n                                        </Badge>\n                                      ))}\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                            </CardContent>\n                          </Card>\n                        );\n                      })}\n                    </div>\n                  ) : (\n                    <Card>\n                      <CardContent className=\"py-12 text-center\">\n                        <ListChecks className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                        <h3 className=\"font-medium text-foreground mb-2\">Estágios não criados</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          Os estágios serão criados após o briefing.\n                        </p>\n                      </CardContent>\n                    </Card>\n                  )}\n\n                  {checklists && checklists.length > 0 && (\n                    <div>\n                      <h3 className=\"text-lg font-semibold mb-4 text-foreground\">Checklists</h3>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        {checklists.map((checklist) => (\n                          <Card key={checklist.id}>\n                            <CardHeader className=\"pb-2\">\n                              <CardTitle className=\"text-base capitalize\">{checklist.type}</CardTitle>\n                            </CardHeader>\n                            <CardContent>\n                              <ul className=\"space-y-2\">\n                                {(checklist.items as any[])?.map((item: any, index: number) => (\n                                  <li\n                                    key={index}\n                                    className=\"flex items-center gap-2 text-sm cursor-pointer hover-elevate rounded p-1 -m-1\"\n                                    onClick={() => toggleChecklistItem(checklist, index)}\n                                    data-testid={`checklist-item-${checklist.id}-${index}`}\n                                  >\n                                    <div\n                                      className={`w-4 h-4 rounded border flex-shrink-0 flex items-center justify-center ${\n                                        item.checked ? \"bg-primary border-primary\" : \"border-muted-foreground\"\n                                      }`}\n                                    >\n                                      {item.checked && <CheckCircle2 className=\"w-3 h-3 text-primary-foreground\" />}\n                                    </div>\n                                    <span className={item.checked ? \"line-through text-muted-foreground\" : \"text-foreground\"}>\n                                      {item.text}\n                                    </span>\n                                  </li>\n                                ))}\n                              </ul>\n                            </CardContent>\n                          </Card>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"ai-command\" className=\"mt-0\">\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                    <div>\n                      <h2 className=\"text-lg font-semibold text-foreground\">Comando para IA de Desenvolvimento</h2>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Use este comando com Cursor, Devin, Windsurf ou ChatGPT Dev\n                      </p>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => regenerateAiCommandMutation.mutate()}\n                        disabled={regenerateAiCommandMutation.isPending}\n                        data-testid=\"button-regenerate-command\"\n                      >\n                        {regenerateAiCommandMutation.isPending ? (\n                          <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                        ) : (\n                          <RefreshCw className=\"w-4 h-4 mr-2\" />\n                        )}\n                        Regenerar\n                      </Button>\n                    </div>\n                  </div>\n\n                  {aiCommand ? (\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                      <Card>\n                        <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n                          <CardTitle className=\"text-base\">Prompt Técnico</CardTitle>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => copyToClipboard(aiCommand.promptText || \"\")}\n                            data-testid=\"button-copy-prompt\"\n                          >\n                            <Copy className=\"w-4 h-4\" />\n                          </Button>\n                        </CardHeader>\n                        <CardContent>\n                          <pre className=\"p-4 rounded-lg bg-muted text-sm font-mono overflow-x-auto whitespace-pre-wrap\">\n                            {aiCommand.promptText}\n                          </pre>\n                        </CardContent>\n                      </Card>\n\n                      <Card>\n                        <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n                          <CardTitle className=\"text-base\">JSON Estruturado</CardTitle>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => copyToClipboard(JSON.stringify(aiCommand.jsonCommand, null, 2))}\n                            data-testid=\"button-copy-json\"\n                          >\n                            <Copy className=\"w-4 h-4\" />\n                          </Button>\n                        </CardHeader>\n                        <CardContent>\n                          <pre className=\"p-4 rounded-lg bg-muted text-sm font-mono overflow-x-auto\">\n                            {JSON.stringify(aiCommand.jsonCommand, null, 2)}\n                          </pre>\n                        </CardContent>\n                      </Card>\n                    </div>\n                  ) : (\n                    <Card>\n                      <CardContent className=\"py-12 text-center\">\n                        <Code className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                        <h3 className=\"font-medium text-foreground mb-2\">Comando não gerado</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          O comando para IA será gerado após o briefing.\n                        </p>\n                      </CardContent>\n                    </Card>\n                  )}\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"docs\" className=\"mt-0\">\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                    <div>\n                      <h2 className=\"text-lg font-semibold text-foreground\">Documentação do Projeto</h2>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Documentação técnica gerada automaticamente por IA\n                      </p>\n                    </div>\n                    <Link href={`/projects/${projectId}/documents`}>\n                      <Button data-testid=\"button-manage-docs\">\n                        <BookOpen className=\"w-4 h-4 mr-2\" />\n                        Gerenciar Documentos\n                      </Button>\n                    </Link>\n                  </div>\n\n                  {documents && documents.length > 0 ? (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      {documents.map((doc) => (\n                        <Card key={doc.id}>\n                          <CardHeader className=\"pb-2\">\n                            <div className=\"flex items-center justify-between gap-2\">\n                              <CardTitle className=\"text-base\">{doc.title}</CardTitle>\n                              <Badge variant=\"secondary\" className=\"text-xs\">{doc.type}</Badge>\n                            </div>\n                          </CardHeader>\n                          <CardContent>\n                            <p className=\"text-sm text-muted-foreground line-clamp-3\">\n                              {doc.content?.substring(0, 200)}...\n                            </p>\n                            <Link href={`/projects/${projectId}/documents`}>\n                              <Button variant=\"outline\" size=\"sm\" className=\"mt-3\" data-testid={`button-view-doc-${doc.id}`}>\n                                Ver Documento\n                              </Button>\n                            </Link>\n                          </CardContent>\n                        </Card>\n                      ))}\n                    </div>\n                  ) : (\n                    <Card>\n                      <CardContent className=\"py-12 text-center\">\n                        <BookOpen className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                        <h3 className=\"font-medium text-foreground mb-2\">Nenhum documento gerado</h3>\n                        <p className=\"text-sm text-muted-foreground mb-4\">\n                          Os documentos serão gerados após o briefing ou podem ser criados manualmente.\n                        </p>\n                        <Link href={`/projects/${projectId}/documents`}>\n                          <Button data-testid=\"button-create-docs\">\n                            <BookOpen className=\"w-4 h-4 mr-2\" />\n                            Gerar Documentos\n                          </Button>\n                        </Link>\n                      </CardContent>\n                    </Card>\n                  )}\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"team\" className=\"mt-0\">\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                    <div>\n                      <h2 className=\"text-lg font-semibold text-foreground\">Equipe do Projeto</h2>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Gerencie os profissionais e delegue tarefas\n                      </p>\n                    </div>\n                    <Button onClick={() => setShowAddMemberModal(true)} data-testid=\"button-add-member\">\n                      <UserPlus className=\"w-4 h-4 mr-2\" />\n                      Adicionar Membro\n                    </Button>\n                  </div>\n\n                  {members && members.length > 0 ? (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      {members.map((member) => (\n                        <Card key={member.id} data-testid={`card-member-${member.id}`}>\n                          <CardContent className=\"p-4\">\n                            <div className=\"flex items-start justify-between gap-2\">\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                                  <Users className=\"w-5 h-5 text-primary\" />\n                                </div>\n                                <div>\n                                  <p className=\"font-medium text-foreground\">{member.name}</p>\n                                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                                    <Mail className=\"w-3 h-3\" />\n                                    {member.email}\n                                  </p>\n                                </div>\n                              </div>\n                              <div className=\"flex items-center gap-1\">\n                                <Button \n                                  variant=\"ghost\" \n                                  size=\"icon\" \n                                  onClick={() => {\n                                    setEditingMember(member);\n                                    setEditMemberData({\n                                      name: member.name,\n                                      role: member.role,\n                                      specialty: member.specialty || \"\",\n                                      password: \"\"\n                                    });\n                                    setShowEditPassword(false);\n                                  }}\n                                  data-testid={`button-edit-member-${member.id}`}\n                                >\n                                  <Pencil className=\"w-4 h-4 text-muted-foreground\" />\n                                </Button>\n                                <AlertDialog>\n                                  <AlertDialogTrigger asChild>\n                                    <Button variant=\"ghost\" size=\"icon\" data-testid={`button-remove-member-${member.id}`}>\n                                      <Trash2 className=\"w-4 h-4 text-muted-foreground\" />\n                                    </Button>\n                                  </AlertDialogTrigger>\n                                  <AlertDialogContent>\n                                    <AlertDialogHeader>\n                                      <AlertDialogTitle>Remover membro?</AlertDialogTitle>\n                                      <AlertDialogDescription>\n                                        Esta ação removerá {member.name} da equipe do projeto. As tarefas atribuídas a ele serão desvinculadas.\n                                      </AlertDialogDescription>\n                                    </AlertDialogHeader>\n                                    <AlertDialogFooter>\n                                      <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                                      <AlertDialogAction\n                                        onClick={() => removeMemberMutation.mutate(member.id)}\n                                        className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                                      >\n                                        Remover\n                                      </AlertDialogAction>\n                                    </AlertDialogFooter>\n                                  </AlertDialogContent>\n                                </AlertDialog>\n                              </div>\n                            </div>\n                            <div className=\"mt-3 flex items-center gap-2 flex-wrap\">\n                              <Badge \n                                variant={member.role === \"manager\" ? \"default\" : \"secondary\"}\n                                className=\"text-xs\"\n                              >\n                                {member.role === \"owner\" ? \"Proprietário\" : \n                                 member.role === \"manager\" ? \"Gerente\" : \"Colaborador\"}\n                              </Badge>\n                              {member.specialty && (\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                  <Briefcase className=\"w-3 h-3 mr-1\" />\n                                  {member.specialty}\n                                </Badge>\n                              )}\n                              <Badge \n                                variant={member.status === \"active\" ? \"default\" : \"secondary\"}\n                                className={`text-xs ${member.status === \"active\" ? \"bg-green-500/10 text-green-600\" : \"bg-yellow-500/10 text-yellow-600\"}`}\n                              >\n                                {member.status === \"active\" ? \"Ativo\" : \"Pendente\"}\n                              </Badge>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                    </div>\n                  ) : (\n                    <Card>\n                      <CardContent className=\"py-12 text-center\">\n                        <Users className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                        <h3 className=\"font-medium text-foreground mb-2\">Nenhum membro na equipe</h3>\n                        <p className=\"text-sm text-muted-foreground mb-4\">\n                          Adicione profissionais para delegar tarefas e acompanhar o progresso.\n                        </p>\n                        <Button onClick={() => setShowAddMemberModal(true)} data-testid=\"button-add-first-member\">\n                          <UserPlus className=\"w-4 h-4 mr-2\" />\n                          Adicionar Primeiro Membro\n                        </Button>\n                      </CardContent>\n                    </Card>\n                  )}\n                </div>\n              </TabsContent>\n            </div>\n          </ScrollArea>\n        </Tabs>\n      </div>\n\n      <Dialog open={showAddMemberModal} onOpenChange={setShowAddMemberModal}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Adicionar Membro à Equipe</DialogTitle>\n            <DialogDescription>\n              Cadastre um profissional para participar do projeto. Se ele já tiver uma conta, será vinculado automaticamente.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"member-name\">Nome</Label>\n              <Input\n                id=\"member-name\"\n                placeholder=\"Nome do profissional\"\n                value={newMember.name}\n                onChange={(e) => setNewMember({ ...newMember, name: e.target.value })}\n                data-testid=\"input-member-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"member-email\">Email</Label>\n              <Input\n                id=\"member-email\"\n                type=\"email\"\n                placeholder=\"email@exemplo.com\"\n                value={newMember.email}\n                onChange={(e) => setNewMember({ ...newMember, email: e.target.value })}\n                data-testid=\"input-member-email\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"member-role\">Papel</Label>\n              <Select\n                value={newMember.role}\n                onValueChange={(value) => setNewMember({ ...newMember, role: value })}\n              >\n                <SelectTrigger id=\"member-role\" data-testid=\"select-member-role\">\n                  <SelectValue placeholder=\"Selecione o papel\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"contributor\">Colaborador (apenas suas tarefas)</SelectItem>\n                  <SelectItem value=\"manager\">Gerente (pode delegar tarefas)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"member-specialty\">Especialidade (opcional)</Label>\n              <Input\n                id=\"member-specialty\"\n                placeholder=\"Ex: Frontend, Backend, Design...\"\n                value={newMember.specialty}\n                onChange={(e) => setNewMember({ ...newMember, specialty: e.target.value })}\n                data-testid=\"input-member-specialty\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"member-password\">Senha Provisória</Label>\n              <div className=\"relative\">\n                <Input\n                  id=\"member-password\"\n                  type={showAddPassword ? \"text\" : \"password\"}\n                  placeholder=\"Senha inicial para o membro\"\n                  value={newMember.password}\n                  onChange={(e) => setNewMember({ ...newMember, password: e.target.value })}\n                  data-testid=\"input-member-password\"\n                  className=\"pr-10\"\n                />\n                <button\n                  type=\"button\"\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n                  onClick={() => setShowAddPassword(!showAddPassword)}\n                  data-testid=\"button-toggle-add-password\"\n                >\n                  {showAddPassword ? (\n                    <Eye className=\"w-4 h-4\" />\n                  ) : (\n                    <EyeOff className=\"w-4 h-4\" />\n                  )}\n                </button>\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                O membro usará esta senha para fazer login. Recomende que ele altere após o primeiro acesso.\n              </p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowAddMemberModal(false)}>\n              Cancelar\n            </Button>\n            <Button \n              onClick={() => addMemberMutation.mutate(newMember)}\n              disabled={!newMember.name || !newMember.email || !newMember.password || newMember.password.length < 6 || addMemberMutation.isPending}\n              data-testid=\"button-confirm-add-member\"\n            >\n              {addMemberMutation.isPending ? (\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n              ) : (\n                <UserPlus className=\"w-4 h-4 mr-2\" />\n              )}\n              Adicionar\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!assignStageId} onOpenChange={(open) => !open && setAssignStageId(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Atribuir Responsável</DialogTitle>\n            <DialogDescription>\n              Selecione um membro da equipe para ser responsável por este estágio.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {members && members.length > 0 ? (\n              <div className=\"space-y-2\">\n                <Label>Membro</Label>\n                <Select\n                  value={selectedMemberToAssign}\n                  onValueChange={setSelectedMemberToAssign}\n                >\n                  <SelectTrigger data-testid=\"select-assign-member\">\n                    <SelectValue placeholder=\"Selecione um membro\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {members.map((member) => (\n                      <SelectItem key={member.id} value={member.id}>\n                        <div className=\"flex items-center gap-2\">\n                          <span>{member.name}</span>\n                          {member.specialty && (\n                            <span className=\"text-xs text-muted-foreground\">({member.specialty})</span>\n                          )}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            ) : (\n              <div className=\"text-center py-4\">\n                <Users className=\"w-8 h-8 mx-auto text-muted-foreground mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">Nenhum membro na equipe.</p>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"mt-2\"\n                  onClick={() => {\n                    setAssignStageId(null);\n                    setActiveTab(\"team\");\n                  }}\n                >\n                  Adicionar Membro\n                </Button>\n              </div>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setAssignStageId(null)}>\n              Cancelar\n            </Button>\n            <Button\n              onClick={() => {\n                if (assignStageId && selectedMemberToAssign) {\n                  assignStageMutation.mutate({ stageId: assignStageId, memberId: selectedMemberToAssign });\n                }\n              }}\n              disabled={!selectedMemberToAssign || assignStageMutation.isPending}\n              data-testid=\"button-confirm-assign\"\n            >\n              {assignStageMutation.isPending ? (\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n              ) : (\n                <UserPlus className=\"w-4 h-4 mr-2\" />\n              )}\n              Atribuir\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!editingMember} onOpenChange={(open) => !open && setEditingMember(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Editar Membro</DialogTitle>\n            <DialogDescription>\n              Atualize as informações do membro da equipe.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-member-name\">Nome</Label>\n              <Input\n                id=\"edit-member-name\"\n                placeholder=\"Nome do profissional\"\n                value={editMemberData.name}\n                onChange={(e) => setEditMemberData({ ...editMemberData, name: e.target.value })}\n                data-testid=\"input-edit-member-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-member-role\">Papel</Label>\n              <Select\n                value={editMemberData.role}\n                onValueChange={(value) => setEditMemberData({ ...editMemberData, role: value })}\n              >\n                <SelectTrigger id=\"edit-member-role\" data-testid=\"select-edit-member-role\">\n                  <SelectValue placeholder=\"Selecione o papel\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"contributor\">Colaborador (apenas suas tarefas)</SelectItem>\n                  <SelectItem value=\"manager\">Gerente (pode delegar tarefas)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-member-specialty\">Especialidade (opcional)</Label>\n              <Input\n                id=\"edit-member-specialty\"\n                placeholder=\"Ex: Frontend, Backend, Design...\"\n                value={editMemberData.specialty}\n                onChange={(e) => setEditMemberData({ ...editMemberData, specialty: e.target.value })}\n                data-testid=\"input-edit-member-specialty\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-member-password\">Nova Senha (opcional)</Label>\n              <div className=\"relative\">\n                <Input\n                  id=\"edit-member-password\"\n                  type={showEditPassword ? \"text\" : \"password\"}\n                  placeholder=\"Deixe em branco para manter a atual\"\n                  value={editMemberData.password}\n                  onChange={(e) => setEditMemberData({ ...editMemberData, password: e.target.value })}\n                  data-testid=\"input-edit-member-password\"\n                  className=\"pr-10\"\n                />\n                <button\n                  type=\"button\"\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n                  onClick={() => setShowEditPassword(!showEditPassword)}\n                  data-testid=\"button-toggle-edit-password\"\n                >\n                  {showEditPassword ? (\n                    <Eye className=\"w-4 h-4\" />\n                  ) : (\n                    <EyeOff className=\"w-4 h-4\" />\n                  )}\n                </button>\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Preencha apenas se desejar alterar a senha do membro.\n              </p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditingMember(null)}>\n              Cancelar\n            </Button>\n            <Button \n              onClick={() => {\n                if (editingMember) {\n                  updateMemberMutation.mutate({ \n                    memberId: editingMember.id, \n                    data: editMemberData \n                  });\n                  setEditingMember(null);\n                }\n              }}\n              disabled={!editMemberData.name || updateMemberMutation.isPending}\n              data-testid=\"button-confirm-edit-member\"\n            >\n              {updateMemberMutation.isPending ? (\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n              ) : (\n                <Pencil className=\"w-4 h-4 mr-2\" />\n              )}\n              Salvar\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":71659,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-border bg-card p-6 shadow-xl duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-xl sm:rounded-xl\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3867,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { SidebarProvider, SidebarTrigger, SidebarInset } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport Login from \"@/pages/login\";\nimport Register from \"@/pages/register\";\nimport Dashboard from \"@/pages/dashboard\";\nimport KanbanPage from \"@/pages/kanban\";\nimport TimelinePage from \"@/pages/timeline\";\nimport DocumentsPage from \"@/pages/documents\";\nimport VaultPage from \"@/pages/vault\";\nimport MindMapPage from \"@/pages/mindmap\";\nimport AgentsPage from \"@/pages/agents\";\nimport ClientForm from \"@/pages/client-form\";\nimport ProjectForm from \"@/pages/project-form\";\nimport ProjectDetail from \"@/pages/project-detail\";\nimport BriefingPage from \"@/pages/briefing\";\nimport MyTasks from \"@/pages/my-tasks\";\nimport AcceptInvite from \"@/pages/accept-invite\";\nimport { Loader2 } from \"lucide-react\";\n\nfunction AuthenticatedLayout({ children }: { children: React.ReactNode }) {\n  const style = {\n    \"--sidebar-width\": \"18rem\",\n    \"--sidebar-width-icon\": \"3.5rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <SidebarInset className=\"flex flex-col flex-1 overflow-hidden\">\n          <header className=\"flex items-center justify-between gap-2 p-2 border-b border-border bg-background h-14 flex-shrink-0\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            <ThemeToggle />\n          </header>\n          <main className=\"flex-1 overflow-auto bg-background\">\n            {children}\n          </main>\n        </SidebarInset>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction AuthenticatedRouter() {\n  return (\n    <AuthenticatedLayout>\n      <Switch>\n        <Route path=\"/\" component={Dashboard} />\n        <Route path=\"/dashboard\" component={Dashboard} />\n        <Route path=\"/my-tasks\" component={MyTasks} />\n        <Route path=\"/kanban\" component={KanbanPage} />\n        <Route path=\"/clients/new\" component={ClientForm} />\n        <Route path=\"/clients/:id\" component={ClientForm} />\n        <Route path=\"/projects/new\" component={ProjectForm} />\n        <Route path=\"/projects/:id\" component={ProjectDetail} />\n        <Route path=\"/projects/:id/briefing\" component={BriefingPage} />\n        <Route path=\"/projects/:id/timeline\" component={TimelinePage} />\n        <Route path=\"/projects/:id/documents\" component={DocumentsPage} />\n        <Route path=\"/projects/:id/vault\" component={VaultPage} />\n        <Route path=\"/projects/:id/mindmap\" component={MindMapPage} />\n        <Route path=\"/projects/:id/agents\" component={AgentsPage} />\n        <Route component={NotFound} />\n      </Switch>\n    </AuthenticatedLayout>\n  );\n}\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <Switch>\n        <Route path=\"/\" component={Landing} />\n        <Route path=\"/login\" component={Login} />\n        <Route path=\"/register\" component={Register} />\n        <Route path=\"/convite/:token\" component={AcceptInvite} />\n        <Route component={Landing} />\n      </Switch>\n    );\n  }\n\n  return <AuthenticatedRouter />;\n}\n\nfunction App() {\n  return (\n    <ThemeProvider defaultTheme=\"dark\" storageKey=\"project-ai-theme\">\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </QueryClientProvider>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":4190,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    limit: '20mb',\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false, limit: '20mb' }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2594,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/pages/timeline.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  ArrowLeft,\n  Calendar,\n  Clock,\n  Target,\n  ChevronLeft,\n  ChevronRight,\n  CheckCircle2,\n  Circle,\n  AlertCircle,\n} from \"lucide-react\";\nimport type { Project, Roadmap, Stage } from \"@shared/schema\";\n\ninterface Phase {\n  name: string;\n  duration: string;\n  deliverables: string[];\n  objectives: string[];\n  suggestedStartDate?: string;\n  suggestedEndDate?: string;\n}\n\ninterface Milestone {\n  name: string;\n  description: string;\n  suggestedDate?: string;\n  dependencies?: string[];\n}\n\nconst phaseColors: Record<number, string> = {\n  0: \"bg-blue-500\",\n  1: \"bg-purple-500\",\n  2: \"bg-orange-500\",\n  3: \"bg-pink-500\",\n  4: \"bg-cyan-500\",\n  5: \"bg-green-500\",\n};\n\nexport default function TimelinePage() {\n  const [, navigate] = useLocation();\n  const [, params] = useRoute(\"/projects/:id/timeline\");\n  const projectId = params?.id;\n  const [viewMode, setViewMode] = useState<\"months\" | \"weeks\">(\"months\");\n\n  const { data: project, isLoading: projectLoading } = useQuery<Project>({\n    queryKey: [\"/api/projects\", projectId],\n    enabled: !!projectId,\n  });\n\n  const { data: roadmap, isLoading: roadmapLoading } = useQuery<Roadmap>({\n    queryKey: [\"/api/projects\", projectId, \"roadmap\"],\n    enabled: !!projectId,\n  });\n\n  const { data: stages, isLoading: stagesLoading } = useQuery<Stage[]>({\n    queryKey: [\"/api/projects\", projectId, \"stages\"],\n    enabled: !!projectId,\n  });\n\n  const isLoading = projectLoading || roadmapLoading || stagesLoading;\n\n  const phases = (roadmap?.phases as Phase[]) || [];\n  const milestones = (roadmap?.milestones as Milestone[]) || [];\n\n  const now = new Date();\n  const startDate = project?.startDate ? new Date(project.startDate) : now;\n  const endDate = project?.deadline\n    ? new Date(project.deadline)\n    : new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000);\n\n  const totalDays = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));\n  const totalWeeks = Math.ceil(totalDays / 7);\n  const totalMonths = Math.ceil(totalDays / 30);\n\n  const getMonthLabels = () => {\n    const labels = [];\n    const date = new Date(startDate);\n    while (date <= endDate) {\n      labels.push({\n        month: date.toLocaleDateString(\"pt-BR\", { month: \"short\" }),\n        year: date.getFullYear(),\n      });\n      date.setMonth(date.getMonth() + 1);\n    }\n    return labels;\n  };\n\n  const getWeekLabels = () => {\n    const labels = [];\n    const date = new Date(startDate);\n    let week = 1;\n    while (date <= endDate) {\n      labels.push({ week, date: new Date(date) });\n      date.setDate(date.getDate() + 7);\n      week++;\n    }\n    return labels;\n  };\n\n  const getPhasePosition = (index: number) => {\n    const phaseDuration = 100 / phases.length;\n    return {\n      left: `${index * phaseDuration}%`,\n      width: `${phaseDuration}%`,\n    };\n  };\n\n  const getMilestonePosition = (index: number) => {\n    const position = ((index + 1) / (milestones.length + 1)) * 100;\n    return { left: `${position}%` };\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"h-full flex flex-col p-6\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <Skeleton className=\"h-9 w-9\" />\n          <div>\n            <Skeleton className=\"h-6 w-48 mb-2\" />\n            <Skeleton className=\"h-4 w-32\" />\n          </div>\n        </div>\n        <Skeleton className=\"flex-1\" />\n      </div>\n    );\n  }\n\n  if (!roadmap || phases.length === 0) {\n    return (\n      <div className=\"h-full flex flex-col p-6\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => navigate(`/projects/${projectId}`)}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-xl font-semibold text-foreground\">Timeline</h1>\n            <p className=\"text-sm text-muted-foreground\">{project?.name}</p>\n          </div>\n        </div>\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <Calendar className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n            <h3 className=\"font-medium text-foreground mb-2\">Nenhum roadmap gerado</h3>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Complete o briefing para gerar o roadmap do projeto.\n            </p>\n            <Button onClick={() => navigate(`/projects/${projectId}/briefing`)}>\n              Ir para Briefing\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col p-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6\">\n        <div className=\"flex items-center gap-3\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => navigate(`/projects/${projectId}`)}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n          </Button>\n          <div>\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"w-5 h-5 text-primary\" />\n              <h1 className=\"text-xl font-semibold text-foreground\">Timeline</h1>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">{project?.name}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={viewMode === \"months\" ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setViewMode(\"months\")}\n            data-testid=\"button-view-months\"\n          >\n            Meses\n          </Button>\n          <Button\n            variant={viewMode === \"weeks\" ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setViewMode(\"weeks\")}\n            data-testid=\"button-view-weeks\"\n          >\n            Semanas\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-primary/10\">\n                <Target className=\"w-5 h-5 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Fases</p>\n                <p className=\"text-xl font-bold text-foreground\">{phases.length}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-green-500/10\">\n                <CheckCircle2 className=\"w-5 h-5 text-green-500\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Marcos</p>\n                <p className=\"text-xl font-bold text-foreground\">{milestones.length}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-orange-500/10\">\n                <Clock className=\"w-5 h-5 text-orange-500\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Duração</p>\n                <p className=\"text-xl font-bold text-foreground\">{totalDays} dias</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card className=\"flex-1\">\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-lg\">Roadmap Visual</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ScrollArea className=\"w-full\">\n            <div className=\"min-w-[800px] pb-4\">\n              <div className=\"flex border-b border-border pb-2 mb-4\">\n                {viewMode === \"months\" ? (\n                  getMonthLabels().map((label, i) => (\n                    <div key={i} className=\"flex-1 text-center text-sm text-muted-foreground\">\n                      <span className=\"font-medium\">{label.month}</span>\n                      <span className=\"text-xs ml-1\">{label.year}</span>\n                    </div>\n                  ))\n                ) : (\n                  getWeekLabels().map((label, i) => (\n                    <div key={i} className=\"flex-1 text-center text-sm text-muted-foreground\">\n                      <span className=\"font-medium\">S{label.week}</span>\n                    </div>\n                  ))\n                )}\n              </div>\n\n              <div className=\"relative h-32 mb-8\">\n                <div className=\"absolute inset-0 bg-muted/30 rounded-lg\" />\n                {phases.map((phase, index) => {\n                  const pos = getPhasePosition(index);\n                  const stage = stages?.find((s) => s.name.toLowerCase().includes(phase.name.toLowerCase()));\n                  const isComplete = stage?.status === \"approved\";\n                  const isActive = stage?.status === \"in_progress\";\n\n                  return (\n                    <div\n                      key={index}\n                      className=\"absolute top-2 bottom-2\"\n                      style={{ left: pos.left, width: pos.width }}\n                      data-testid={`phase-bar-${index}`}\n                    >\n                      <div\n                        className={`h-full mx-1 rounded-lg flex flex-col justify-center px-3 ${\n                          phaseColors[index % 6]\n                        } ${isComplete ? \"opacity-50\" : \"\"} ${isActive ? \"ring-2 ring-white ring-offset-2\" : \"\"}`}\n                      >\n                        <p className=\"font-medium text-white text-sm truncate\">\n                          {phase.name}\n                        </p>\n                        <p className=\"text-xs text-white/80\">{phase.duration}</p>\n                        {isComplete && (\n                          <CheckCircle2 className=\"w-4 h-4 text-white absolute top-2 right-2\" />\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n\n              {milestones.length > 0 && (\n                <>\n                  <div className=\"text-sm font-medium text-muted-foreground mb-3\">\n                    Marcos do Projeto\n                  </div>\n                  <div className=\"relative h-20 mb-4\">\n                    <div className=\"absolute left-0 right-0 top-1/2 h-px bg-border\" />\n                    {milestones.map((milestone, index) => {\n                      const pos = getMilestonePosition(index);\n                      return (\n                        <div\n                          key={index}\n                          className=\"absolute transform -translate-x-1/2\"\n                          style={{ left: pos.left }}\n                          data-testid={`milestone-${index}`}\n                        >\n                          <div className=\"flex flex-col items-center\">\n                            <div className=\"w-4 h-4 rounded-full bg-primary flex items-center justify-center\">\n                              <Circle className=\"w-2 h-2 text-white fill-white\" />\n                            </div>\n                            <div className=\"mt-2 text-center max-w-[120px]\">\n                              <p className=\"text-xs font-medium text-foreground truncate\">\n                                {milestone.name}\n                              </p>\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </>\n              )}\n            </div>\n            <ScrollBar orientation=\"horizontal\" />\n          </ScrollArea>\n\n          <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <h4 className=\"font-medium text-foreground mb-3\">Fases do Projeto</h4>\n              <div className=\"space-y-2\">\n                {phases.map((phase, index) => (\n                  <div\n                    key={index}\n                    className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50\"\n                  >\n                    <div className={`w-3 h-3 rounded-full ${phaseColors[index % 6]}`} />\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium text-foreground text-sm\">{phase.name}</p>\n                      <p className=\"text-xs text-muted-foreground\">{phase.duration}</p>\n                    </div>\n                    <Badge variant=\"secondary\">\n                      {phase.deliverables?.length || 0} entregáveis\n                    </Badge>\n                  </div>\n                ))}\n              </div>\n            </div>\n            <div>\n              <h4 className=\"font-medium text-foreground mb-3\">Marcos</h4>\n              <div className=\"space-y-2\">\n                {milestones.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground text-center py-4\">\n                    Nenhum marco definido\n                  </p>\n                ) : (\n                  milestones.map((milestone, index) => (\n                    <div\n                      key={index}\n                      className=\"flex items-start gap-3 p-3 rounded-lg bg-muted/50\"\n                    >\n                      <Circle className=\"w-3 h-3 mt-1 text-primary fill-primary\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-medium text-foreground text-sm\">{milestone.name}</p>\n                        <p className=\"text-xs text-muted-foreground line-clamp-2\">\n                          {milestone.description}\n                        </p>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":14556,"size_tokens":null},"client/src/hooks/use-upload.ts":{"content":"import { useState, useCallback } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface UploadOptions {\n  onSuccess?: (response: { objectPath: string }) => void;\n  onError?: (error: Error) => void;\n  isPrivate?: boolean;\n}\n\ninterface UploadState {\n  isUploading: boolean;\n  progress: number;\n  error: Error | null;\n}\n\nexport function useUpload(options: UploadOptions = {}) {\n  const { onSuccess, onError, isPrivate = true } = options;\n  const [state, setState] = useState<UploadState>({\n    isUploading: false,\n    progress: 0,\n    error: null,\n  });\n\n  const uploadFile = useCallback(\n    async (file: File): Promise<string | null> => {\n      setState({ isUploading: true, progress: 0, error: null });\n\n      try {\n        setState((prev) => ({ ...prev, progress: 10 }));\n\n        const arrayBuffer = await file.arrayBuffer();\n        const base64 = btoa(\n          new Uint8Array(arrayBuffer).reduce(\n            (data, byte) => data + String.fromCharCode(byte),\n            \"\"\n          )\n        );\n\n        setState((prev) => ({ ...prev, progress: 50 }));\n\n        const response = await apiRequest(\"POST\", \"/api/uploads/request-url\", {\n          name: file.name,\n          contentType: file.type,\n          isPrivate,\n          data: base64,\n        });\n\n        const { objectPath } = await response.json() as { objectPath: string };\n\n        setState({ isUploading: false, progress: 100, error: null });\n        onSuccess?.({ objectPath });\n\n        return objectPath;\n      } catch (error) {\n        const err = error instanceof Error ? error : new Error(\"Upload failed\");\n        setState({ isUploading: false, progress: 0, error: err });\n        onError?.(err);\n        return null;\n      }\n    },\n    [isPrivate, onSuccess, onError]\n  );\n\n  const reset = useCallback(() => {\n    setState({ isUploading: false, progress: 0, error: null });\n  }, []);\n\n  return {\n    uploadFile,\n    reset,\n    isUploading: state.isUploading,\n    progress: state.progress,\n    error: state.error,\n  };\n}\n","path":null,"size_bytes":2015,"size_tokens":null},"server/replit_integrations/object_storage/routes.ts":{"content":"import type { Express, RequestHandler, Request, Response } from \"express\";\nimport { objectStorageService } from \"./objectStorage\";\n\nexport function registerObjectStorageRoutes(app: Express, authMiddleware?: RequestHandler) {\n  const serveHandler = async (req: Request, res: Response) => {\n    try {\n      const objectPath = req.params[0];\n      if (!objectPath) {\n        return res.status(400).json({ message: \"Missing object path\" });\n      }\n\n      const content = await objectStorageService.getFileContent(objectPath, 10 * 1024 * 1024);\n      \n      const ext = objectPath.split('.').pop()?.toLowerCase();\n      const mimeTypes: Record<string, string> = {\n        'png': 'image/png',\n        'jpg': 'image/jpeg',\n        'jpeg': 'image/jpeg',\n        'gif': 'image/gif',\n        'webp': 'image/webp',\n        'svg': 'image/svg+xml',\n      };\n      \n      res.setHeader('Content-Type', mimeTypes[ext || ''] || 'application/octet-stream');\n      res.setHeader('Cache-Control', 'public, max-age=31536000');\n      res.send(content);\n    } catch (error) {\n      console.error(\"Error serving file:\", error);\n      res.status(404).json({ message: \"File not found\" });\n    }\n  };\n\n  const uploadHandler = async (req: any, res: any) => {\n    try {\n      const { name, contentType, isPrivate = true, data } = req.body;\n\n      if (!name || !contentType || !data) {\n        return res.status(400).json({ message: \"Missing required fields: name, contentType, data\" });\n      }\n\n      const buffer = Buffer.from(data, \"base64\");\n      \n      if (buffer.length > 10 * 1024 * 1024) {\n        return res.status(400).json({ message: \"File too large. Maximum size is 10MB.\" });\n      }\n\n      const result = await objectStorageService.uploadFile(\n        name,\n        buffer,\n        contentType,\n        isPrivate\n      );\n\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error uploading file:\", error);\n      res.status(500).json({ message: \"Failed to upload file\" });\n    }\n  };\n\n  const downloadHandler = async (req: any, res: any) => {\n    try {\n      const { objectPath } = req.body;\n\n      if (!objectPath) {\n        return res.status(400).json({ message: \"Missing objectPath\" });\n      }\n\n      const content = await objectStorageService.getFileContent(objectPath);\n      const downloadURL = objectStorageService.getPublicUrl(objectPath);\n      res.json({ downloadURL, content: content.toString(\"base64\") });\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      res.status(500).json({ message: \"Failed to download file\" });\n    }\n  };\n\n  app.get(\"/api/files/*\", serveHandler);\n\n  if (authMiddleware) {\n    app.post(\"/api/uploads/request-url\", authMiddleware, uploadHandler);\n    app.post(\"/api/uploads/download-url\", authMiddleware, downloadHandler);\n  } else {\n    app.post(\"/api/uploads/request-url\", uploadHandler);\n    app.post(\"/api/uploads/download-url\", downloadHandler);\n  }\n}\n","path":null,"size_bytes":2928,"size_tokens":null},"client/src/pages/kanban.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Plus,\n  FolderKanban,\n  Clock,\n  User,\n  ArrowRight,\n} from \"lucide-react\";\nimport type { Client, Project } from \"@shared/schema\";\n\nconst kanbanColumns = [\n  { status: \"briefing\", label: \"Briefing\", color: \"bg-yellow-500\" },\n  { status: \"planning\", label: \"Planejamento\", color: \"bg-blue-500\" },\n  { status: \"design\", label: \"Design\", color: \"bg-purple-500\" },\n  { status: \"development\", label: \"Desenvolvimento\", color: \"bg-orange-500\" },\n  { status: \"testing\", label: \"Testes\", color: \"bg-pink-500\" },\n  { status: \"deploy\", label: \"Deploy\", color: \"bg-cyan-500\" },\n  { status: \"completed\", label: \"Concluído\", color: \"bg-green-500\" },\n];\n\nexport default function KanbanPage() {\n  const { data: clients, isLoading: clientsLoading } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const { data: projects, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const isLoading = clientsLoading || projectsLoading;\n\n  const getClientName = (clientId: string) => {\n    return clients?.find((c) => c.id === clientId)?.name || \"Cliente\";\n  };\n\n  const getProjectsByStatus = (status: string) => {\n    return projects?.filter((p) => p.status === status) || [];\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"h-full flex flex-col p-6\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <Skeleton className=\"h-8 w-48\" />\n          <Skeleton className=\"h-10 w-32\" />\n        </div>\n        <div className=\"flex-1 flex gap-4 overflow-x-auto pb-4\">\n          {kanbanColumns.map((col) => (\n            <div key={col.status} className=\"flex-shrink-0 w-72\">\n              <Skeleton className=\"h-8 w-full mb-4\" />\n              <div className=\"space-y-3\">\n                {[...Array(3)].map((_, i) => (\n                  <Skeleton key={i} className=\"h-32 w-full\" />\n                ))}\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col p-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6\">\n        <div>\n          <h1 className=\"text-2xl font-semibold text-foreground\">Kanban</h1>\n          <p className=\"text-muted-foreground\">\n            Visualize seus projetos por status\n          </p>\n        </div>\n        <Link href=\"/projects/new\">\n          <Button data-testid=\"button-new-project-kanban\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Novo Projeto\n          </Button>\n        </Link>\n      </div>\n\n      <ScrollArea className=\"flex-1\">\n        <div className=\"flex gap-4 pb-4 min-h-full\">\n          {kanbanColumns.map((column) => {\n            const columnProjects = getProjectsByStatus(column.status);\n            return (\n              <div\n                key={column.status}\n                className=\"flex-shrink-0 w-72\"\n                data-testid={`kanban-column-${column.status}`}\n              >\n                <div className=\"flex items-center gap-2 mb-4 px-1\">\n                  <div className={`w-3 h-3 rounded-full ${column.color}`} />\n                  <h3 className=\"font-medium text-foreground\">{column.label}</h3>\n                  <Badge variant=\"secondary\" size=\"sm\" className=\"ml-auto\">\n                    {columnProjects.length}\n                  </Badge>\n                </div>\n\n                <div className=\"space-y-3\">\n                  {columnProjects.length === 0 ? (\n                    <div className=\"p-4 rounded-lg border border-dashed border-border text-center\">\n                      <p className=\"text-sm text-muted-foreground\">\n                        Nenhum projeto\n                      </p>\n                    </div>\n                  ) : (\n                    columnProjects.map((project) => (\n                      <Link\n                        key={project.id}\n                        href={`/projects/${project.id}`}\n                      >\n                        <Card\n                          className=\"cursor-pointer hover-elevate\"\n                          data-testid={`kanban-card-${project.id}`}\n                        >\n                          <CardContent className=\"p-4\">\n                            <h4 className=\"font-medium text-foreground mb-2 line-clamp-2\">\n                              {project.name}\n                            </h4>\n                            \n                            <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-3\">\n                              <User className=\"w-3 h-3\" />\n                              <span className=\"truncate\">\n                                {getClientName(project.clientId)}\n                              </span>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                              <div className=\"flex items-center justify-between text-xs\">\n                                <span className=\"text-muted-foreground\">Progresso</span>\n                                <span className=\"font-medium text-foreground\">\n                                  {project.progress || 0}%\n                                </span>\n                              </div>\n                              <Progress\n                                value={project.progress || 0}\n                                className=\"h-1.5\"\n                              />\n                            </div>\n\n                            {project.deadline && (\n                              <div className=\"flex items-center gap-1 mt-3 text-xs text-muted-foreground\">\n                                <Clock className=\"w-3 h-3\" />\n                                <span>\n                                  {new Date(project.deadline).toLocaleDateString(\"pt-BR\")}\n                                </span>\n                              </div>\n                            )}\n                          </CardContent>\n                        </Card>\n                      </Link>\n                    ))\n                  )}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n        <ScrollBar orientation=\"horizontal\" />\n      </ScrollArea>\n    </div>\n  );\n}\n","path":null,"size_bytes":6644,"size_tokens":null},"server/replit_integrations/object_storage/objectStorage.ts":{"content":"import { Client } from \"@replit/object-storage\";\n\nexport function getBucketId(): string {\n  const bucketId = process.env.DEFAULT_OBJECT_STORAGE_BUCKET_ID;\n  if (!bucketId) {\n    throw new Error(\"Object storage not configured. Please set up object storage first.\");\n  }\n  return bucketId;\n}\n\nconst client = new Client({ bucketId: getBucketId() });\n\nexport class ObjectStorageService {\n  async uploadFile(\n    filename: string,\n    content: Buffer,\n    contentType: string,\n    isPrivate: boolean = true\n  ): Promise<{ objectPath: string }> {\n    const directory = isPrivate \n      ? process.env.PRIVATE_OBJECT_DIR?.split(\"/\").pop() || \".private\"\n      : \"public\";\n    const objectPath = `${directory}/${Date.now()}-${filename}`;\n    \n    const result = await client.uploadFromBytes(objectPath, content);\n    \n    if (!result.ok) {\n      throw new Error(`Failed to upload file: ${result.error}`);\n    }\n\n    return { objectPath };\n  }\n\n  async getFileContent(objectPath: string, maxSizeBytes: number = 512 * 1024): Promise<Buffer> {\n    const result = await client.downloadAsBytes(objectPath);\n    \n    if (!result.ok) {\n      throw new Error(`Failed to download file: ${result.error}`);\n    }\n    \n    const buffer = result.value[0];\n    if (buffer.length > maxSizeBytes) {\n      throw new Error(`File too large: ${buffer.length} bytes (max: ${maxSizeBytes})`);\n    }\n    \n    return buffer;\n  }\n\n  async deleteFile(objectPath: string): Promise<void> {\n    const result = await client.delete(objectPath);\n    if (!result.ok) {\n      throw new Error(`Failed to delete file: ${result.error}`);\n    }\n  }\n\n  getPublicUrl(objectPath: string): string {\n    return `https://storage.googleapis.com/${getBucketId()}/${objectPath}`;\n  }\n\n  async exists(objectPath: string): Promise<boolean> {\n    const result = await client.exists(objectPath);\n    return result.ok && result.value;\n  }\n}\n\nexport const objectStorageService = new ObjectStorageService();\n","path":null,"size_bytes":1944,"size_tokens":null},"server/replit_integrations/object_storage/index.ts":{"content":"export { ObjectStorageService, objectStorageService } from \"./objectStorage\";\nexport { registerObjectStorageRoutes } from \"./routes\";\n","path":null,"size_bytes":134,"size_tokens":null},"client/src/pages/mindmap.tsx":{"content":"import { useState, useRef, useCallback } from \"react\";\nimport { useRoute, Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  ArrowLeft,\n  Download,\n  ZoomIn,\n  ZoomOut,\n  RotateCcw,\n  GitBranch,\n  Target,\n  CheckSquare,\n  AlertTriangle,\n  Lightbulb,\n  Users,\n} from \"lucide-react\";\nimport type { Project, Scope, Roadmap, Briefing } from \"@shared/schema\";\n\ninterface MindMapNode {\n  id: string;\n  label: string;\n  children?: MindMapNode[];\n  color?: string;\n  icon?: string;\n}\n\nexport default function MindMap() {\n  const [, params] = useRoute(\"/projects/:id/mindmap\");\n  const projectId = params?.id;\n  const { toast } = useToast();\n  const svgRef = useRef<SVGSVGElement>(null);\n  const [zoom, setZoom] = useState(1);\n  const [expandedNodes, setExpandedNodes] = useState<Set<string>>(new Set([\"root\", \"scope\", \"roadmap\", \"briefing\"]));\n\n  const { data: project, isLoading: projectLoading } = useQuery<Project>({\n    queryKey: [\"/api/projects\", projectId],\n    enabled: !!projectId,\n  });\n\n  const { data: scope } = useQuery<Scope>({\n    queryKey: [\"/api/projects\", projectId, \"scope\"],\n    enabled: !!projectId,\n  });\n\n  const { data: roadmap } = useQuery<Roadmap>({\n    queryKey: [\"/api/projects\", projectId, \"roadmap\"],\n    enabled: !!projectId,\n  });\n\n  const { data: briefing } = useQuery<Briefing>({\n    queryKey: [\"/api/projects\", projectId, \"briefing\"],\n    enabled: !!projectId,\n  });\n\n  const toggleNode = (nodeId: string) => {\n    setExpandedNodes((prev) => {\n      const next = new Set(prev);\n      if (next.has(nodeId)) {\n        next.delete(nodeId);\n      } else {\n        next.add(nodeId);\n      }\n      return next;\n    });\n  };\n\n  const buildMindMapData = useCallback((): MindMapNode => {\n    const deliverables = (scope?.deliverables as string[]) || [];\n    const risks = (scope?.risks as string[]) || [];\n    const phases = (roadmap?.phases as any[]) || [];\n    const milestones = (roadmap?.milestones as any[]) || [];\n    const assumptions = (scope?.assumptions as string[]) || [];\n\n    return {\n      id: \"root\",\n      label: project?.name || \"Projeto\",\n      color: \"hsl(var(--primary))\",\n      children: [\n        {\n          id: \"briefing\",\n          label: \"Briefing\",\n          color: \"hsl(210, 70%, 50%)\",\n          icon: \"briefing\",\n          children: [\n            { id: \"b-type\", label: `Tipo: ${briefing?.projectType || \"N/A\"}` },\n            { id: \"b-audience\", label: `Público: ${briefing?.targetAudience || \"N/A\"}` },\n            { id: \"b-stack\", label: `Stack: ${briefing?.stack || \"N/A\"}` },\n            { id: \"b-budget\", label: `Orçamento: ${briefing?.budget || \"N/A\"}` },\n          ],\n        },\n        {\n          id: \"scope\",\n          label: \"Escopo\",\n          color: \"hsl(150, 70%, 40%)\",\n          icon: \"scope\",\n          children: [\n            {\n              id: \"deliverables\",\n              label: `Entregáveis (${deliverables.length})`,\n              children: deliverables.map((d, i) => ({\n                id: `d-${i}`,\n                label: d,\n              })),\n            },\n            {\n              id: \"risks\",\n              label: `Riscos (${risks.length})`,\n              children: risks.map((r, i) => ({\n                id: `r-${i}`,\n                label: r,\n              })),\n            },\n            {\n              id: \"assumptions\",\n              label: `Premissas (${assumptions.length})`,\n              children: assumptions.map((a, i) => ({\n                id: `a-${i}`,\n                label: a,\n              })),\n            },\n          ],\n        },\n        {\n          id: \"roadmap\",\n          label: \"Roadmap\",\n          color: \"hsl(280, 70%, 50%)\",\n          icon: \"roadmap\",\n          children: [\n            {\n              id: \"phases\",\n              label: `Fases (${phases.length})`,\n              children: phases.map((p, i) => ({\n                id: `p-${i}`,\n                label: p.name,\n                children: p.tasks?.map((t: string, j: number) => ({\n                  id: `p-${i}-t-${j}`,\n                  label: t,\n                })),\n              })),\n            },\n            {\n              id: \"milestones\",\n              label: `Marcos (${milestones.length})`,\n              children: milestones.map((m, i) => ({\n                id: `m-${i}`,\n                label: m.name,\n              })),\n            },\n          ],\n        },\n      ],\n    };\n  }, [project, scope, roadmap, briefing]);\n\n  const downloadSVG = () => {\n    if (!svgRef.current) return;\n\n    const svgData = new XMLSerializer().serializeToString(svgRef.current);\n    const svgBlob = new Blob([svgData], { type: \"image/svg+xml;charset=utf-8\" });\n    const svgUrl = URL.createObjectURL(svgBlob);\n    const downloadLink = document.createElement(\"a\");\n    downloadLink.href = svgUrl;\n    downloadLink.download = `${project?.name || \"mindmap\"}-mindmap.svg`;\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n    URL.revokeObjectURL(svgUrl);\n    toast({\n      title: \"Download iniciado\",\n      description: \"O mapa mental foi exportado como SVG.\",\n      variant: \"success\",\n    });\n  };\n\n  const downloadPNG = async () => {\n    if (!svgRef.current) return;\n\n    const svgData = new XMLSerializer().serializeToString(svgRef.current);\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\");\n    const img = new Image();\n\n    img.onload = () => {\n      canvas.width = img.width * 2;\n      canvas.height = img.height * 2;\n      ctx?.scale(2, 2);\n      ctx?.drawImage(img, 0, 0);\n      \n      const pngUrl = canvas.toDataURL(\"image/png\");\n      const downloadLink = document.createElement(\"a\");\n      downloadLink.href = pngUrl;\n      downloadLink.download = `${project?.name || \"mindmap\"}-mindmap.png`;\n      document.body.appendChild(downloadLink);\n      downloadLink.click();\n      document.body.removeChild(downloadLink);\n    };\n\n    img.src = \"data:image/svg+xml;base64,\" + btoa(unescape(encodeURIComponent(svgData)));\n    toast({\n      title: \"Download iniciado\",\n      description: \"O mapa mental foi exportado como PNG.\",\n      variant: \"success\",\n    });\n  };\n\n  if (projectLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-64\" />\n        <Skeleton className=\"h-[500px]\" />\n      </div>\n    );\n  }\n\n  if (!project) {\n    return (\n      <div className=\"p-6 text-center\">\n        <p className=\"text-muted-foreground\">Projeto não encontrado</p>\n      </div>\n    );\n  }\n\n  const mindMapData = buildMindMapData();\n\n  const renderNode = (node: MindMapNode, depth: number = 0, parentExpanded: boolean = true): React.ReactNode => {\n    if (!parentExpanded) return null;\n\n    const isExpanded = expandedNodes.has(node.id);\n    const hasChildren = node.children && node.children.length > 0;\n    const bgColor = depth === 0 \n      ? \"bg-primary text-primary-foreground\" \n      : depth === 1 \n        ? \"bg-muted\" \n        : \"bg-background border border-border\";\n\n    const iconMap: Record<string, typeof Target> = {\n      briefing: Users,\n      scope: Target,\n      roadmap: GitBranch,\n    };\n\n    const Icon = node.icon ? iconMap[node.icon] : null;\n\n    return (\n      <div key={node.id} className=\"flex flex-col\" style={{ marginLeft: depth > 0 ? 24 : 0 }}>\n        <div\n          className={`flex items-center gap-2 p-2 rounded-md cursor-pointer transition-colors ${bgColor} hover-elevate`}\n          onClick={() => hasChildren && toggleNode(node.id)}\n          data-testid={`node-${node.id}`}\n        >\n          {hasChildren && (\n            <span className=\"text-xs text-muted-foreground w-4\">\n              {isExpanded ? \"-\" : \"+\"}\n            </span>\n          )}\n          {Icon && <Icon className=\"w-4 h-4 flex-shrink-0\" />}\n          <span className={`text-sm ${depth === 0 ? \"font-semibold\" : depth === 1 ? \"font-medium\" : \"\"}`}>\n            {node.label}\n          </span>\n        </div>\n        {hasChildren && isExpanded && (\n          <div className=\"ml-2 mt-1 border-l border-border pl-2 space-y-1\">\n            {node.children!.map((child) => renderNode(child, depth + 1, isExpanded))}\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      <div className=\"p-4 md:p-6 border-b border-border bg-background flex-shrink-0\">\n        <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n          <div className=\"flex items-center gap-3\">\n            <Link href={`/projects/${projectId}`}>\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                <ArrowLeft className=\"w-4 h-4\" />\n              </Button>\n            </Link>\n            <div>\n              <h1 className=\"text-xl font-semibold text-foreground flex items-center gap-2\">\n                <GitBranch className=\"w-5 h-5\" />\n                Mapa Mental\n              </h1>\n              <p className=\"text-sm text-muted-foreground\">\n                {project.name} - Visualização hierárquica do projeto\n              </p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => setZoom((z) => Math.max(0.5, z - 0.1))}\n              data-testid=\"button-zoom-out\"\n            >\n              <ZoomOut className=\"w-4 h-4\" />\n            </Button>\n            <span className=\"text-sm text-muted-foreground w-12 text-center\">\n              {Math.round(zoom * 100)}%\n            </span>\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => setZoom((z) => Math.min(2, z + 0.1))}\n              data-testid=\"button-zoom-in\"\n            >\n              <ZoomIn className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => {\n                setZoom(1);\n                setExpandedNodes(new Set([\"root\", \"scope\", \"roadmap\", \"briefing\"]));\n              }}\n              data-testid=\"button-reset\"\n            >\n              <RotateCcw className=\"w-4 h-4\" />\n            </Button>\n            <Button variant=\"outline\" onClick={downloadSVG} data-testid=\"button-download-svg\">\n              <Download className=\"w-4 h-4 mr-2\" />\n              SVG\n            </Button>\n            <Button variant=\"outline\" onClick={downloadPNG} data-testid=\"button-download-png\">\n              <Download className=\"w-4 h-4 mr-2\" />\n              PNG\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 overflow-auto p-4 md:p-6\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <div className=\"lg:col-span-2\">\n            <Card className=\"h-full\">\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Estrutura do Projeto</CardTitle>\n              </CardHeader>\n              <CardContent style={{ transform: `scale(${zoom})`, transformOrigin: \"top left\" }}>\n                <div className=\"space-y-2\">\n                  {renderNode(mindMapData)}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <Target className=\"w-4 h-4\" />\n                  Resumo do Escopo\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Entregáveis</span>\n                  <Badge variant=\"secondary\">{((scope?.deliverables as string[]) || []).length}</Badge>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Riscos</span>\n                  <Badge variant=\"secondary\">{((scope?.risks as string[]) || []).length}</Badge>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Premissas</span>\n                  <Badge variant=\"secondary\">{((scope?.assumptions as string[]) || []).length}</Badge>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <GitBranch className=\"w-4 h-4\" />\n                  Resumo do Roadmap\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Fases</span>\n                  <Badge variant=\"secondary\">{((roadmap?.phases as any[]) || []).length}</Badge>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Marcos</span>\n                  <Badge variant=\"secondary\">{((roadmap?.milestones as any[]) || []).length}</Badge>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Legenda</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded bg-primary\" />\n                  <span className=\"text-sm\">Projeto (raiz)</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded bg-muted\" />\n                  <span className=\"text-sm\">Categoria principal</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded border border-border\" />\n                  <span className=\"text-sm\">Itens</span>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n\n      <svg ref={svgRef} style={{ position: \"absolute\", left: \"-9999px\" }} width=\"800\" height=\"600\">\n        <rect fill=\"hsl(var(--background))\" width=\"100%\" height=\"100%\" />\n        <text x=\"400\" y=\"50\" textAnchor=\"middle\" fill=\"hsl(var(--foreground))\" fontSize=\"24\" fontWeight=\"bold\">\n          {project.name}\n        </text>\n        <text x=\"400\" y=\"80\" textAnchor=\"middle\" fill=\"hsl(var(--muted-foreground))\" fontSize=\"14\">\n          Mapa Mental do Projeto\n        </text>\n      </svg>\n    </div>\n  );\n}\n","path":null,"size_bytes":15088,"size_tokens":null},"replit.md":{"content":"# Project Intelligence Platform for AI-Powered Project Management\n\n## Overview\n\nThis is a SaaS platform designed to transform project briefings (text, audio, or conversation) into complete, structured, and executable projects. The system provides AI-powered generation of scope, roadmaps, technical documentation, and execution commands for AI development tools. It targets digital agencies, consultancies, software houses, and internal product/technology teams.\n\nThe platform follows a multi-level structure: Client → Project → (Briefing, Scope, Roadmap, Execution, Documents, Vault, History).\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React with TypeScript, built using Vite\n- **Routing**: Wouter (lightweight React router)\n- **State Management**: TanStack React Query for server state\n- **UI Components**: Shadcn/ui with Radix UI primitives\n- **Styling**: Tailwind CSS with custom design tokens and CSS variables\n- **Design System**: Hybrid approach combining Linear's aesthetics, Notion's content hierarchy, and Material Design 3's structured components\n\n### Backend Architecture\n- **Framework**: Express.js with TypeScript\n- **API Pattern**: RESTful JSON API at `/api/*` endpoints\n- **Authentication**: Session-based auth using express-session with bcrypt password hashing\n- **Database ORM**: Drizzle ORM with PostgreSQL dialect\n- **AI Integration**: OpenAI-compatible API through Replit's AI Integrations service (GPT-4.1 model)\n\n### Data Layer\n- **Database**: PostgreSQL with Drizzle ORM\n- **Schema Location**: `shared/schema.ts` - shared between client and server\n- **Migrations**: Drizzle Kit with `drizzle-kit push` command\n- **Session Storage**: PostgreSQL-backed sessions via connect-pg-simple\n\n### Project Structure\n```\nclient/           # React frontend application\n├── src/\n│   ├── components/   # UI components (Shadcn/ui based)\n│   ├── pages/        # Route pages\n│   ├── hooks/        # Custom React hooks\n│   └── lib/          # Utilities and query client\nserver/           # Express backend\n├── routes.ts     # API route definitions\n├── storage.ts    # Database operations layer\n├── auth.ts       # Authentication logic\n├── openai.ts     # AI integration functions\n└── db.ts         # Database connection\nshared/           # Shared code between client/server\n└── schema.ts     # Drizzle database schema and types\n```\n\n### Key Design Decisions\n\n1. **Monorepo Structure**: Client and server share types through `@shared/*` path alias, ensuring type safety across the stack.\n\n2. **AI-First Briefing**: The briefing system uses conversational AI to collect project requirements, automatically detecting missing fields and generating structured project artifacts.\n\n3. **Multi-tenant Architecture**: Users own clients, clients own projects, enabling agency-style multi-client management.\n\n4. **Specialized AI Agents**: The platform includes specialized agents for analysis, code review, testing, and security assessments.\n\n## External Dependencies\n\n### Database\n- **PostgreSQL**: Primary database, connection via `DATABASE_URL` environment variable\n\n### AI Services\n- **OpenAI-compatible API**: Via Replit AI Integrations (`AI_INTEGRATIONS_OPENAI_BASE_URL`, `AI_INTEGRATIONS_OPENAI_API_KEY`)\n- Used for briefing analysis, scope generation, roadmap creation, documentation generation, and specialized agent tasks\n\n### Object Storage\n- **Google Cloud Storage**: For file uploads via `@google-cloud/storage`\n- Bucket configured via `DEFAULT_OBJECT_STORAGE_BUCKET_ID` environment variable\n- Uses presigned URLs for secure uploads/downloads\n\n### Authentication\n- Session secret via `SESSION_SECRET` environment variable\n- Sessions stored in PostgreSQL\n\n### Required Environment Variables\n- `DATABASE_URL` - PostgreSQL connection string\n- `SESSION_SECRET` - Session encryption secret\n- `AI_INTEGRATIONS_OPENAI_BASE_URL` - AI API endpoint\n- `AI_INTEGRATIONS_OPENAI_API_KEY` - AI API key\n- `DEFAULT_OBJECT_STORAGE_BUCKET_ID` - GCS bucket ID (optional, for file uploads)","path":null,"size_bytes":4159,"size_tokens":null},"client/src/pages/register.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Loader2, UserPlus } from \"lucide-react\";\n\nconst EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\ninterface FormErrors {\n  email?: string;\n  password?: string;\n  confirmPassword?: string;\n}\n\nexport default function Register() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [firstName, setFirstName] = useState(\"\");\n  const [lastName, setLastName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [errors, setErrors] = useState<FormErrors>({});\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: { email: string; password: string; firstName?: string; lastName?: string }) => {\n      return await apiRequest(\"POST\", \"/api/auth/register\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Conta criada\",\n        description: \"Sua conta foi criada com sucesso!\",\n        variant: \"success\",\n      });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro no cadastro\",\n        description: error.message || \"Não foi possível criar a conta\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const validateForm = (): boolean => {\n    const newErrors: FormErrors = {};\n    \n    if (!email) {\n      newErrors.email = \"Email é obrigatório\";\n    } else if (!EMAIL_REGEX.test(email)) {\n      newErrors.email = \"Formato de email inválido\";\n    }\n    \n    if (!password) {\n      newErrors.password = \"Senha é obrigatória\";\n    } else if (password.length < 6) {\n      newErrors.password = \"A senha deve ter pelo menos 6 caracteres\";\n    }\n    \n    if (!confirmPassword) {\n      newErrors.confirmPassword = \"Confirmação de senha é obrigatória\";\n    } else if (password !== confirmPassword) {\n      newErrors.confirmPassword = \"As senhas não coincidem\";\n    }\n    \n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (validateForm()) {\n      registerMutation.mutate({ email, password, firstName, lastName });\n    }\n  };\n\n  const clearError = (field: keyof FormErrors) => {\n    if (errors[field]) {\n      setErrors({ ...errors, [field]: undefined });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"text-2xl\">Criar Conta</CardTitle>\n          <CardDescription>\n            Cadastre-se para comecar a gerenciar seus projetos\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"firstName\">Nome</Label>\n                <Input\n                  id=\"firstName\"\n                  type=\"text\"\n                  placeholder=\"Seu nome\"\n                  value={firstName}\n                  onChange={(e) => setFirstName(e.target.value)}\n                  data-testid=\"input-first-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"lastName\">Sobrenome</Label>\n                <Input\n                  id=\"lastName\"\n                  type=\"text\"\n                  placeholder=\"Seu sobrenome\"\n                  value={lastName}\n                  onChange={(e) => setLastName(e.target.value)}\n                  data-testid=\"input-last-name\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"seu@email.com\"\n                value={email}\n                onChange={(e) => {\n                  setEmail(e.target.value);\n                  clearError(\"email\");\n                }}\n                className={errors.email ? \"border-destructive\" : \"\"}\n                data-testid=\"input-email\"\n              />\n              {errors.email && (\n                <p className=\"text-sm text-destructive\" data-testid=\"error-email\">{errors.email}</p>\n              )}\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Senha</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"Mínimo 6 caracteres\"\n                value={password}\n                onChange={(e) => {\n                  setPassword(e.target.value);\n                  clearError(\"password\");\n                }}\n                className={errors.password ? \"border-destructive\" : \"\"}\n                data-testid=\"input-password\"\n              />\n              {errors.password && (\n                <p className=\"text-sm text-destructive\" data-testid=\"error-password\">{errors.password}</p>\n              )}\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"confirmPassword\">Confirmar Senha</Label>\n              <Input\n                id=\"confirmPassword\"\n                type=\"password\"\n                placeholder=\"Confirme sua senha\"\n                value={confirmPassword}\n                onChange={(e) => {\n                  setConfirmPassword(e.target.value);\n                  clearError(\"confirmPassword\");\n                }}\n                className={errors.confirmPassword ? \"border-destructive\" : \"\"}\n                data-testid=\"input-confirm-password\"\n              />\n              {errors.confirmPassword && (\n                <p className=\"text-sm text-destructive\" data-testid=\"error-confirm-password\">{errors.confirmPassword}</p>\n              )}\n            </div>\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={registerMutation.isPending}\n              data-testid=\"button-register\"\n            >\n              {registerMutation.isPending ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  Criando conta...\n                </>\n              ) : (\n                <>\n                  <UserPlus className=\"w-4 h-4 mr-2\" />\n                  Criar Conta\n                </>\n              )}\n            </Button>\n          </form>\n          <div className=\"mt-4 text-center text-sm text-muted-foreground\">\n            Já tem uma conta?{\" \"}\n            <Link href=\"/login\" className=\"text-primary hover:underline\" data-testid=\"link-login\">\n              Entrar\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":7359,"size_tokens":null},"client/src/pages/agents.tsx":{"content":"import { useState } from \"react\";\nimport { useRoute, Link, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  ArrowLeft,\n  ArrowRight,\n  Bot,\n  Brain,\n  Code,\n  Clock,\n  AlertTriangle,\n  DollarSign,\n  FileText,\n  Target,\n  Loader2,\n  Sparkles,\n  CheckCircle,\n  XCircle,\n  AlertCircle,\n  Lightbulb,\n  PlayCircle,\n  RefreshCw,\n  Gauge,\n  Eye,\n  Save,\n  HelpCircle,\n  Ban,\n  Shield,\n  Zap,\n  ListChecks,\n} from \"lucide-react\";\nimport type { Project, AgentAnalysis, OrchestratorSession, Scope } from \"@shared/schema\";\n\ninterface AgentConfig {\n  id: string;\n  name: string;\n  description: string;\n  icon: typeof Brain;\n  color: string;\n  bgColor: string;\n}\n\nconst agentConfigs: AgentConfig[] = [\n  {\n    id: \"scope\",\n    name: \"Agente de Escopo\",\n    description: \"Analisa completude do escopo, gaps e dependências entre entregáveis.\",\n    icon: Target,\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n  },\n  {\n    id: \"technical\",\n    name: \"Agente Técnico\",\n    description: \"Avalia viabilidade técnica, arquitetura e complexidade de implementação.\",\n    icon: Code,\n    color: \"text-green-500\",\n    bgColor: \"bg-green-500/10\",\n  },\n  {\n    id: \"timeline\",\n    name: \"Agente de Prazos\",\n    description: \"Analisa estimativas de tempo, caminho crítico e riscos de atraso.\",\n    icon: Clock,\n    color: \"text-purple-500\",\n    bgColor: \"bg-purple-500/10\",\n  },\n  {\n    id: \"risks\",\n    name: \"Agente de Riscos\",\n    description: \"Identifica riscos técnicos, de negócio e operacionais com mitigações.\",\n    icon: AlertTriangle,\n    color: \"text-orange-500\",\n    bgColor: \"bg-orange-500/10\",\n  },\n  {\n    id: \"financial\",\n    name: \"Agente Financeiro\",\n    description: \"Estima custos de desenvolvimento, manutenção e ROI do projeto.\",\n    icon: DollarSign,\n    color: \"text-emerald-500\",\n    bgColor: \"bg-emerald-500/10\",\n  },\n  {\n    id: \"documentation\",\n    name: \"Agente de Documentação\",\n    description: \"Avalia necessidades de documentação e gera estrutura de docs.\",\n    icon: FileText,\n    color: \"text-cyan-500\",\n    bgColor: \"bg-cyan-500/10\",\n  },\n];\n\nconst readinessLabels: Record<string, { label: string; color: string; icon: typeof CheckCircle }> = {\n  excellent: { label: \"Excelente\", color: \"text-green-500\", icon: CheckCircle },\n  ready: { label: \"Pronto\", color: \"text-blue-500\", icon: CheckCircle },\n  needs_work: { label: \"Precisa de Trabalho\", color: \"text-yellow-500\", icon: AlertCircle },\n  not_ready: { label: \"Não Pronto\", color: \"text-red-500\", icon: XCircle },\n};\n\nexport default function Agents() {\n  const [, params] = useRoute(\"/projects/:id/agents\");\n  const [, navigate] = useLocation();\n  const projectId = params?.id;\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [selectedAgent, setSelectedAgent] = useState<AgentAnalysis | null>(null);\n  const [selectedAgentConfig, setSelectedAgentConfig] = useState<AgentConfig | null>(null);\n  const [selectedRecommendations, setSelectedRecommendations] = useState<string[]>([]);\n  const [userNotes, setUserNotes] = useState(\"\");\n  const [showApplyModeModal, setShowApplyModeModal] = useState(false);\n\n  const { data: project, isLoading: projectLoading } = useQuery<Project>({\n    queryKey: [\"/api/projects\", projectId],\n    enabled: !!projectId,\n  });\n\n  const { data: analyses, isLoading: analysesLoading } = useQuery<AgentAnalysis[]>({\n    queryKey: [\"/api/projects\", projectId, \"agents\"],\n    enabled: !!projectId,\n  });\n\n  const { data: sessions, isLoading: sessionsLoading } = useQuery<OrchestratorSession[]>({\n    queryKey: [\"/api/projects\", projectId, \"orchestrator-sessions\"],\n    enabled: !!projectId,\n  });\n\n  const { data: scope } = useQuery<Scope>({\n    queryKey: [\"/api/projects\", projectId, \"scope\"],\n    enabled: !!projectId,\n  });\n\n  const getAppliedRecommendations = (): string[] => {\n    const scopeData = scope as any;\n    const metadata = scopeData?.metadata;\n    if (!metadata?.appliedRecommendations) return [];\n    return metadata.appliedRecommendations.flatMap((entry: any) => entry.recommendations || []);\n  };\n\n  const appliedRecommendationsList = getAppliedRecommendations();\n\n  const runOrchestrator = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/agents/orchestrate`, {\n        agentTypes: [\"scope\", \"technical\", \"timeline\", \"risks\", \"financial\", \"documentation\"],\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"agents\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"orchestrator-sessions\"] });\n      toast({\n        title: \"Análise concluída\",\n        description: \"Todos os agentes especializados finalizaram suas análises.\",\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível executar a análise orquestrada.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const runSingleAgent = useMutation({\n    mutationFn: async (agentType: string) => {\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/agents/${agentType}`, {});\n    },\n    onSuccess: (_, agentType) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"agents\"] });\n      const config = agentConfigs.find(a => a.id === agentType);\n      toast({\n        title: \"Agente concluiu\",\n        description: `${config?.name || agentType} finalizou a análise.`,\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível executar o agente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const applyRecommendations = useMutation({\n    mutationFn: async (data: { agentType: string; recommendations: string[]; notes: string; mode?: string }) => {\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/agents/apply-recommendations`, data);\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"briefing\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"scope\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"stages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"checklists\"] });\n      const appliedCount = variables.recommendations.length;\n      toast({\n        title: `${appliedCount} recomendação${appliedCount > 1 ? 'ões' : ''} aplicada${appliedCount > 1 ? 's' : ''}`,\n        description: \"As recomendações foram adicionadas ao projeto.\",\n        variant: \"success\",\n        action: (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => navigate(`/projects/${projectId}`)}\n            data-testid=\"button-view-improvements\"\n          >\n            Ver Melhorias\n          </Button>\n        ),\n      });\n      closeAgentModal();\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível aplicar as recomendações.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const openAgentModal = (analysis: AgentAnalysis, config: AgentConfig) => {\n    setSelectedRecommendations([]);\n    setUserNotes(\"\");\n    setSelectedAgent(analysis);\n    setSelectedAgentConfig(config);\n  };\n\n  const closeAgentModal = () => {\n    setSelectedAgent(null);\n    setSelectedAgentConfig(null);\n    setSelectedRecommendations([]);\n    setUserNotes(\"\");\n  };\n\n  const toggleRecommendation = (rec: string) => {\n    setSelectedRecommendations(prev => \n      prev.includes(rec) ? prev.filter(r => r !== rec) : [...prev, rec]\n    );\n  };\n\n  const handleApplyRecommendations = () => {\n    if (!selectedAgent || !selectedAgentConfig) return;\n    if (selectedRecommendations.length === 0 && !userNotes) return;\n    setShowApplyModeModal(true);\n  };\n\n  const handleApplyDirect = () => {\n    if (!selectedAgent || !selectedAgentConfig) return;\n    applyRecommendations.mutate({\n      agentType: selectedAgentConfig.id,\n      recommendations: selectedRecommendations,\n      notes: userNotes,\n      mode: \"direct\",\n    });\n    setShowApplyModeModal(false);\n  };\n\n  const handleApplyWithTracking = () => {\n    if (!selectedAgent || !selectedAgentConfig) return;\n    const pendingRecommendations = {\n      agentType: selectedAgentConfig.id,\n      recommendations: selectedRecommendations,\n      notes: userNotes,\n    };\n    sessionStorage.setItem(\"pendingRecommendations\", JSON.stringify(pendingRecommendations));\n    setShowApplyModeModal(false);\n    closeAgentModal();\n    navigate(`/projects/${projectId}/briefing?applyRecommendations=true`);\n  };\n\n  const latestSession = sessions?.[0];\n  const latestConsolidated = latestSession?.consolidatedResult as any;\n\n  const getAgentAnalysis = (agentType: string) => {\n    return analyses?.find(a => a.agentType === agentType);\n  };\n\n  const renderFormattedAnalysis = (result: any) => {\n    if (typeof result === 'string') {\n      return (\n        <div className=\"text-sm text-foreground bg-muted/50 p-4 rounded-md whitespace-pre-wrap\">\n          {result}\n        </div>\n      );\n    }\n\n    if (!result || typeof result !== 'object') {\n      return (\n        <div className=\"text-sm text-muted-foreground italic\">\n          Nenhuma análise disponível\n        </div>\n      );\n    }\n\n    const sections = [];\n\n    if (result.clarity !== undefined || result.completeness !== undefined) {\n      sections.push(\n        <div key=\"metrics\" className=\"grid grid-cols-2 gap-4\">\n          {result.clarity !== undefined && (\n            <div className=\"bg-muted/50 p-4 rounded-md\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                <Gauge className=\"w-4 h-4 text-blue-500\" />\n                <span className=\"text-sm font-medium text-foreground\">Clareza</span>\n              </div>\n              <div className=\"text-2xl font-bold text-foreground\">{result.clarity}%</div>\n              <Progress value={result.clarity} className=\"mt-2 h-2\" />\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                {result.clarity >= 80 ? 'Ótimo nível de clareza' : result.clarity >= 60 ? 'Clareza adequada, mas pode melhorar' : 'Precisa de mais detalhamento'}\n              </p>\n            </div>\n          )}\n          {result.completeness !== undefined && (\n            <div className=\"bg-muted/50 p-4 rounded-md\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                <ListChecks className=\"w-4 h-4 text-green-500\" />\n                <span className=\"text-sm font-medium text-foreground\">Completude</span>\n              </div>\n              <div className=\"text-2xl font-bold text-foreground\">{result.completeness}%</div>\n              <Progress value={result.completeness} className=\"mt-2 h-2\" />\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                {result.completeness >= 80 ? 'Escopo bem definido' : result.completeness >= 60 ? 'Alguns pontos podem ser adicionados' : 'Vários itens faltando'}\n              </p>\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    if (result.ambiguities?.length > 0) {\n      sections.push(\n        <div key=\"ambiguities\">\n          <h4 className=\"font-medium text-foreground mb-3 flex items-center gap-2\">\n            <HelpCircle className=\"w-4 h-4 text-yellow-500\" />\n            Pontos que precisam de esclarecimento ({result.ambiguities.length})\n          </h4>\n          <ul className=\"space-y-2\">\n            {result.ambiguities.map((item: string, index: number) => (\n              <li key={index} className=\"flex items-start gap-2 text-sm bg-yellow-500/10 p-3 rounded-md\">\n                <AlertCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" />\n                <span className=\"text-foreground\">{item}</span>\n              </li>\n            ))}\n          </ul>\n        </div>\n      );\n    }\n\n    if (result.outOfScopeItems?.length > 0) {\n      sections.push(\n        <div key=\"outOfScope\">\n          <h4 className=\"font-medium text-foreground mb-3 flex items-center gap-2\">\n            <Ban className=\"w-4 h-4 text-muted-foreground\" />\n            Itens fora do escopo ({result.outOfScopeItems.length})\n          </h4>\n          <ul className=\"space-y-2\">\n            {result.outOfScopeItems.map((item: string, index: number) => (\n              <li key={index} className=\"flex items-start gap-2 text-sm bg-muted/50 p-3 rounded-md\">\n                <XCircle className=\"w-4 h-4 text-muted-foreground mt-0.5 flex-shrink-0\" />\n                <span className=\"text-muted-foreground\">{item}</span>\n              </li>\n            ))}\n          </ul>\n        </div>\n      );\n    }\n\n    if (result.risks?.length > 0) {\n      sections.push(\n        <div key=\"risks\">\n          <h4 className=\"font-medium text-foreground mb-3 flex items-center gap-2\">\n            <Shield className=\"w-4 h-4 text-red-500\" />\n            Riscos Identificados ({result.risks.length})\n          </h4>\n          <ul className=\"space-y-2\">\n            {result.risks.map((risk: any, index: number) => (\n              <li key={index} className=\"bg-red-500/10 p-3 rounded-md\">\n                <div className=\"flex items-start gap-2 text-sm\">\n                  <AlertTriangle className=\"w-4 h-4 text-red-500 mt-0.5 flex-shrink-0\" />\n                  <div>\n                    <span className=\"text-foreground font-medium\">{typeof risk === 'string' ? risk : risk.description || risk.name}</span>\n                    {risk.mitigation && (\n                      <p className=\"text-xs text-muted-foreground mt-1\">Mitigação: {risk.mitigation}</p>\n                    )}\n                    {risk.severity && (\n                      <Badge variant=\"outline\" className=\"mt-2 text-xs\">{risk.severity}</Badge>\n                    )}\n                  </div>\n                </div>\n              </li>\n            ))}\n          </ul>\n        </div>\n      );\n    }\n\n    if (result.costs || result.estimatedCost || result.totalCost) {\n      const cost = result.costs || result.estimatedCost || result.totalCost;\n      sections.push(\n        <div key=\"costs\" className=\"bg-emerald-500/10 p-4 rounded-md\">\n          <h4 className=\"font-medium text-foreground mb-3 flex items-center gap-2\">\n            <DollarSign className=\"w-4 h-4 text-emerald-500\" />\n            Estimativa de Custos\n          </h4>\n          {typeof cost === 'object' ? (\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              {cost.development && <div><span className=\"text-muted-foreground\">Desenvolvimento:</span> <span className=\"font-medium text-foreground\">{cost.development}</span></div>}\n              {cost.maintenance && <div><span className=\"text-muted-foreground\">Manutenção:</span> <span className=\"font-medium text-foreground\">{cost.maintenance}</span></div>}\n              {cost.infrastructure && <div><span className=\"text-muted-foreground\">Infraestrutura:</span> <span className=\"font-medium text-foreground\">{cost.infrastructure}</span></div>}\n              {cost.total && <div className=\"col-span-2 pt-2 border-t\"><span className=\"text-muted-foreground\">Total:</span> <span className=\"font-bold text-foreground text-lg\">{cost.total}</span></div>}\n            </div>\n          ) : (\n            <div className=\"text-xl font-bold text-foreground\">{cost}</div>\n          )}\n        </div>\n      );\n    }\n\n    if (result.timeline || result.estimatedDuration || result.realistic || result.optimistic || result.pessimistic) {\n      const estimatedDur = result.estimatedDuration;\n      const hasEstimatedDurationScenarios = estimatedDur && typeof estimatedDur === 'object' && (estimatedDur.realistic || estimatedDur.optimistic || estimatedDur.pessimistic);\n      const hasRootScenarios = result.realistic || result.optimistic || result.pessimistic;\n      const scenarios = hasEstimatedDurationScenarios ? estimatedDur : (hasRootScenarios ? result : null);\n      \n      sections.push(\n        <div key=\"timeline\" className=\"bg-purple-500/10 p-4 rounded-md\">\n          <h4 className=\"font-medium text-foreground mb-3 flex items-center gap-2\">\n            <Clock className=\"w-4 h-4 text-purple-500\" />\n            Cronograma Estimado\n          </h4>\n          {scenarios ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {scenarios.optimistic && (\n                <div className=\"bg-green-500/10 p-3 rounded-md\">\n                  <div className=\"text-xs text-green-600 dark:text-green-400 font-medium mb-1\">Otimista</div>\n                  <div className=\"text-lg font-bold text-foreground\">{typeof scenarios.optimistic === 'object' ? (scenarios.optimistic.duration || scenarios.optimistic.estimate || JSON.stringify(scenarios.optimistic)) : scenarios.optimistic}</div>\n                </div>\n              )}\n              {scenarios.realistic && (\n                <div className=\"bg-blue-500/10 p-3 rounded-md\">\n                  <div className=\"text-xs text-blue-600 dark:text-blue-400 font-medium mb-1\">Realista</div>\n                  <div className=\"text-lg font-bold text-foreground\">{typeof scenarios.realistic === 'object' ? (scenarios.realistic.duration || scenarios.realistic.estimate || JSON.stringify(scenarios.realistic)) : scenarios.realistic}</div>\n                </div>\n              )}\n              {scenarios.pessimistic && (\n                <div className=\"bg-orange-500/10 p-3 rounded-md\">\n                  <div className=\"text-xs text-orange-600 dark:text-orange-400 font-medium mb-1\">Pessimista</div>\n                  <div className=\"text-lg font-bold text-foreground\">{typeof scenarios.pessimistic === 'object' ? (scenarios.pessimistic.duration || scenarios.pessimistic.estimate || JSON.stringify(scenarios.pessimistic)) : scenarios.pessimistic}</div>\n                </div>\n              )}\n            </div>\n          ) : typeof result.timeline === 'object' ? (\n            <div className=\"space-y-2 text-sm\">\n              {Object.entries(result.timeline).map(([phase, duration]: [string, any]) => (\n                <div key={phase} className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground capitalize\">{phase}:</span>\n                  <span className=\"font-medium text-foreground\">{typeof duration === 'object' ? JSON.stringify(duration) : duration}</span>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-lg font-medium text-foreground\">{typeof result.timeline === 'string' ? result.timeline : (typeof result.estimatedDuration === 'string' ? result.estimatedDuration : '')}</div>\n          )}\n        </div>\n      );\n    }\n\n    if (result.technicalRequirements?.length > 0) {\n      sections.push(\n        <div key=\"techReqs\">\n          <h4 className=\"font-medium text-foreground mb-3 flex items-center gap-2\">\n            <Zap className=\"w-4 h-4 text-cyan-500\" />\n            Requisitos Técnicos ({result.technicalRequirements.length})\n          </h4>\n          <ul className=\"space-y-2\">\n            {result.technicalRequirements.map((req: string, index: number) => (\n              <li key={index} className=\"flex items-start gap-2 text-sm bg-cyan-500/10 p-3 rounded-md\">\n                <Code className=\"w-4 h-4 text-cyan-500 mt-0.5 flex-shrink-0\" />\n                <span className=\"text-foreground\">{req}</span>\n              </li>\n            ))}\n          </ul>\n        </div>\n      );\n    }\n\n    if (result.summary) {\n      sections.unshift(\n        <div key=\"summary\" className=\"bg-muted/50 p-4 rounded-md\">\n          <h4 className=\"font-medium text-foreground mb-2 flex items-center gap-2\">\n            <Brain className=\"w-4 h-4\" />\n            Resumo da Análise\n          </h4>\n          <p className=\"text-sm text-foreground\">{result.summary}</p>\n        </div>\n      );\n    }\n\n    if (sections.length === 0) {\n      const knownKeys = ['clarity', 'completeness', 'ambiguities', 'outOfScopeItems', 'risks', 'costs', 'estimatedCost', 'totalCost', 'timeline', 'estimatedDuration', 'technicalRequirements', 'summary', 'recommendations', 'realistic', 'optimistic', 'pessimistic', 'warnings'];\n      const otherKeys = Object.keys(result).filter(k => !knownKeys.includes(k));\n      \n      if (otherKeys.length > 0) {\n        sections.push(\n          <div key=\"other\" className=\"space-y-4\">\n            {otherKeys.map(key => {\n              const value = result[key];\n              if (Array.isArray(value) && value.length > 0) {\n                return (\n                  <div key={key}>\n                    <h4 className=\"font-medium text-foreground mb-2 capitalize\">{key.replace(/([A-Z])/g, ' $1').trim()}</h4>\n                    <ul className=\"space-y-2\">\n                      {value.map((item: any, index: number) => (\n                        <li key={index} className=\"text-sm bg-muted/50 p-3 rounded-md text-foreground\">\n                          {typeof item === 'string' ? item : JSON.stringify(item)}\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                );\n              } else if (typeof value === 'string' || typeof value === 'number') {\n                return (\n                  <div key={key} className=\"bg-muted/50 p-3 rounded-md\">\n                    <span className=\"text-sm text-muted-foreground capitalize\">{key.replace(/([A-Z])/g, ' $1').trim()}: </span>\n                    <span className=\"text-sm font-medium text-foreground\">{value}</span>\n                  </div>\n                );\n              }\n              return null;\n            })}\n          </div>\n        );\n      }\n    }\n\n    return sections.length > 0 ? <div className=\"space-y-6\">{sections}</div> : (\n      <div className=\"text-sm text-muted-foreground italic\">\n        Nenhum dado estruturado disponível\n      </div>\n    );\n  };\n\n  if (projectLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-64\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[...Array(6)].map((_, i) => (\n            <Skeleton key={i} className=\"h-40\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!project) {\n    return (\n      <div className=\"p-6 text-center\">\n        <p className=\"text-muted-foreground\">Projeto não encontrado</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      <div className=\"p-4 md:p-6 border-b border-border bg-background flex-shrink-0\">\n        <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n          <div className=\"flex items-center gap-3\">\n            <Link href={`/projects/${projectId}`}>\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                <ArrowLeft className=\"w-4 h-4\" />\n              </Button>\n            </Link>\n            <div>\n              <h1 className=\"text-xl font-semibold text-foreground flex items-center gap-2\">\n                <Bot className=\"w-5 h-5\" />\n                Agentes IA Especializados\n              </h1>\n              <p className=\"text-sm text-muted-foreground\">\n                {project.name} - Análise inteligente do projeto\n              </p>\n            </div>\n          </div>\n          <Button\n            onClick={() => runOrchestrator.mutate()}\n            disabled={runOrchestrator.isPending}\n            data-testid=\"button-run-orchestrator\"\n          >\n            {runOrchestrator.isPending ? (\n              <>\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                Analisando...\n              </>\n            ) : (\n              <>\n                <Sparkles className=\"w-4 h-4 mr-2\" />\n                Executar Todos os Agentes\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\n        <div className=\"border-b border-border px-4 md:px-6 flex-shrink-0\">\n          <TabsList className=\"h-12 bg-transparent gap-2\">\n            <TabsTrigger value=\"overview\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-overview\">\n              <Gauge className=\"w-4 h-4 mr-2\" />\n              Visão Geral\n            </TabsTrigger>\n            <TabsTrigger value=\"agents\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-agents\">\n              <Bot className=\"w-4 h-4 mr-2\" />\n              Análises dos Agentes\n            </TabsTrigger>\n            <TabsTrigger value=\"history\" className=\"data-[state=active]:bg-muted\" data-testid=\"tab-history\">\n              <Clock className=\"w-4 h-4 mr-2\" />\n              Histórico\n            </TabsTrigger>\n          </TabsList>\n        </div>\n\n        <ScrollArea className=\"flex-1\">\n          <div className=\"p-4 md:p-6\">\n            <TabsContent value=\"overview\" className=\"mt-0 space-y-6\">\n              {latestConsolidated ? (\n                <>\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <Card>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-sm text-muted-foreground\">Saúde Geral</p>\n                            <p className=\"text-2xl font-bold text-foreground\">{latestConsolidated.overallHealth}%</p>\n                          </div>\n                          <div className={`p-3 rounded-full ${latestConsolidated.overallHealth >= 80 ? 'bg-green-500/10' : latestConsolidated.overallHealth >= 60 ? 'bg-yellow-500/10' : 'bg-red-500/10'}`}>\n                            <Gauge className={`w-6 h-6 ${latestConsolidated.overallHealth >= 80 ? 'text-green-500' : latestConsolidated.overallHealth >= 60 ? 'text-yellow-500' : 'text-red-500'}`} />\n                          </div>\n                        </div>\n                        <Progress value={latestConsolidated.overallHealth} className=\"mt-3 h-2\" />\n                      </CardContent>\n                    </Card>\n\n                    <Card>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-sm text-muted-foreground\">Status do Projeto</p>\n                            {(() => {\n                              const status = readinessLabels[latestConsolidated.projectReadiness] || readinessLabels.not_ready;\n                              const StatusIcon = status.icon;\n                              return (\n                                <div className=\"flex items-center gap-2 mt-1\">\n                                  <StatusIcon className={`w-5 h-5 ${status.color}`} />\n                                  <span className={`text-lg font-semibold ${status.color}`}>{status.label}</span>\n                                </div>\n                              );\n                            })()}\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n\n                    <Card>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-sm text-muted-foreground\">Alertas Criticos</p>\n                            <p className=\"text-2xl font-bold text-foreground\">{latestConsolidated.criticalIssues?.length || 0}</p>\n                          </div>\n                          <div className=\"p-3 rounded-full bg-orange-500/10\">\n                            <AlertTriangle className=\"w-6 h-6 text-orange-500\" />\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </div>\n\n                  {latestConsolidated.summary && (\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\n                          <Brain className=\"w-5 h-5\" />\n                          Resumo Executivo\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <p className=\"text-foreground\">{latestConsolidated.summary}</p>\n                      </CardContent>\n                    </Card>\n                  )}\n\n                  {latestConsolidated.criticalIssues?.length > 0 && (\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\n                          <AlertTriangle className=\"w-5 h-5 text-orange-500\" />\n                          Problemas Críticos\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <ul className=\"space-y-2\">\n                          {latestConsolidated.criticalIssues.map((issue: string, index: number) => (\n                            <li key={index} className=\"flex items-start gap-2\">\n                              <XCircle className=\"w-4 h-4 text-red-500 mt-0.5 flex-shrink-0\" />\n                              <span className=\"text-foreground\">{issue}</span>\n                            </li>\n                          ))}\n                        </ul>\n                      </CardContent>\n                    </Card>\n                  )}\n\n                  {latestConsolidated.topRecommendations?.length > 0 && (\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\n                          <Lightbulb className=\"w-5 h-5 text-yellow-500\" />\n                          Recomendações Principais\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <ul className=\"space-y-2\">\n                          {latestConsolidated.topRecommendations.map((rec: string, index: number) => (\n                            <li key={index} className=\"flex items-start gap-2\">\n                              <CheckCircle className=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                              <span className=\"text-foreground\">{rec}</span>\n                            </li>\n                          ))}\n                        </ul>\n                      </CardContent>\n                    </Card>\n                  )}\n                </>\n              ) : (\n                <Card>\n                  <CardContent className=\"py-12 text-center\">\n                    <Bot className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <h3 className=\"font-medium text-foreground mb-2\">Nenhuma análise realizada</h3>\n                    <p className=\"text-sm text-muted-foreground mb-4\">\n                      Execute os agentes especializados para obter uma análise completa do projeto.\n                    </p>\n                    <Button onClick={() => runOrchestrator.mutate()} disabled={runOrchestrator.isPending} data-testid=\"button-start-analysis\">\n                      {runOrchestrator.isPending ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                          Analisando...\n                        </>\n                      ) : (\n                        <>\n                          <PlayCircle className=\"w-4 h-4 mr-2\" />\n                          Iniciar Análise Completa\n                        </>\n                      )}\n                    </Button>\n                  </CardContent>\n                </Card>\n              )}\n            </TabsContent>\n\n            <TabsContent value=\"agents\" className=\"mt-0\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {agentConfigs.map((agent) => {\n                  const analysis = getAgentAnalysis(agent.id);\n                  const Icon = agent.icon;\n                  const hasAnalysis = analysis && analysis.status === \"completed\";\n\n                  return (\n                    <Card key={agent.id} data-testid={`card-agent-${agent.id}`}>\n                      <CardHeader className=\"pb-2\">\n                        <div className=\"flex items-center justify-between gap-2\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className={`p-2 rounded-md ${agent.bgColor}`}>\n                              <Icon className={`w-5 h-5 ${agent.color}`} />\n                            </div>\n                            <CardTitle className=\"text-base\">{agent.name}</CardTitle>\n                          </div>\n                          {hasAnalysis && (\n                            <Badge variant=\"secondary\" className=\"text-xs\">\n                              {analysis.confidence}%\n                            </Badge>\n                          )}\n                        </div>\n                        <CardDescription className=\"text-xs\">{agent.description}</CardDescription>\n                      </CardHeader>\n                      <CardContent className=\"space-y-3\">\n                        {hasAnalysis ? (\n                          <>\n                            <div className=\"text-sm text-foreground line-clamp-3\">\n                              {typeof analysis.result === 'string' \n                                ? analysis.result.substring(0, 150) + '...'\n                                : JSON.stringify(analysis.result).substring(0, 150) + '...'}\n                            </div>\n                            {(analysis.warnings as string[])?.length > 0 && (\n                              <button\n                                onClick={() => openAgentModal(analysis, agent)}\n                                className=\"flex items-center gap-1 text-xs text-orange-500 hover:underline cursor-pointer\"\n                                data-testid={`button-alerts-${agent.id}`}\n                              >\n                                <AlertTriangle className=\"w-3 h-3\" />\n                                {(analysis.warnings as string[]).length} alerta(s)\n                              </button>\n                            )}\n                            <div className=\"flex gap-2\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                className=\"flex-1\"\n                                onClick={() => openAgentModal(analysis, agent)}\n                                data-testid={`button-details-${agent.id}`}\n                              >\n                                <Eye className=\"w-3 h-3 mr-2\" />\n                                Ver Detalhes\n                              </Button>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => runSingleAgent.mutate(agent.id)}\n                                disabled={runSingleAgent.isPending}\n                                data-testid={`button-rerun-${agent.id}`}\n                              >\n                                <RefreshCw className=\"w-3 h-3\" />\n                              </Button>\n                            </div>\n                          </>\n                        ) : (\n                          <>\n                            <p className=\"text-sm text-muted-foreground\">Análise não executada ainda.</p>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              className=\"w-full\"\n                              onClick={() => runSingleAgent.mutate(agent.id)}\n                              disabled={runSingleAgent.isPending}\n                              data-testid={`button-run-${agent.id}`}\n                            >\n                              {runSingleAgent.isPending ? (\n                                <Loader2 className=\"w-3 h-3 mr-2 animate-spin\" />\n                              ) : (\n                                <PlayCircle className=\"w-3 h-3 mr-2\" />\n                              )}\n                              Executar\n                            </Button>\n                          </>\n                        )}\n                      </CardContent>\n                    </Card>\n                  );\n                })}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"history\" className=\"mt-0 space-y-4\">\n              {sessionsLoading ? (\n                <div className=\"space-y-4\">\n                  {[...Array(3)].map((_, i) => (\n                    <Skeleton key={i} className=\"h-24\" />\n                  ))}\n                </div>\n              ) : sessions && sessions.length > 0 ? (\n                sessions.map((session) => {\n                  const consolidated = session.consolidatedResult as any;\n                  const execLog = session.executionLog as any[];\n\n                  return (\n                    <Card key={session.id} data-testid={`card-session-${session.id}`}>\n                      <CardHeader className=\"pb-2\">\n                        <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                          <CardTitle className=\"text-base flex items-center gap-2\">\n                            <Bot className=\"w-4 h-4\" />\n                            Sessão de Análise\n                          </CardTitle>\n                          <div className=\"flex items-center gap-2\">\n                            <Badge variant={session.status === \"completed\" ? \"secondary\" : \"outline\"}>\n                              {session.status === \"completed\" ? \"Concluída\" : session.status}\n                            </Badge>\n                            {consolidated?.overallHealth && (\n                              <Badge variant=\"secondary\">\n                                {consolidated.overallHealth}% Saúde\n                              </Badge>\n                            )}\n                          </div>\n                        </div>\n                        <CardDescription className=\"text-xs\">\n                          {session.createdAt ? new Date(session.createdAt).toLocaleString('pt-BR') : 'Data desconhecida'}\n                        </CardDescription>\n                      </CardHeader>\n                      <CardContent>\n                        {execLog && execLog.length > 0 && (\n                          <div className=\"flex flex-wrap gap-2\">\n                            {execLog.map((log: any, i: number) => {\n                              const config = agentConfigs.find(a => a.id === log.agent);\n                              return (\n                                <Badge key={i} variant=\"outline\" className=\"text-xs\">\n                                  {config?.name || log.agent}: {log.confidence}%\n                                </Badge>\n                              );\n                            })}\n                          </div>\n                        )}\n                      </CardContent>\n                    </Card>\n                  );\n                })\n              ) : (\n                <Card>\n                  <CardContent className=\"py-12 text-center\">\n                    <Clock className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <h3 className=\"font-medium text-foreground mb-2\">Nenhum histórico</h3>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Execute uma análise orquestrada para ver o histórico de sessões.\n                    </p>\n                  </CardContent>\n                </Card>\n              )}\n            </TabsContent>\n          </div>\n        </ScrollArea>\n      </Tabs>\n\n      <Dialog open={!!selectedAgent} onOpenChange={() => closeAgentModal()}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-hidden flex flex-col\">\n          {selectedAgent && selectedAgentConfig && (\n            <>\n              <DialogHeader className=\"flex-shrink-0\">\n                <div className=\"flex items-center gap-3\">\n                  <div className={`p-2 rounded-md ${selectedAgentConfig.bgColor}`}>\n                    {(() => {\n                      const Icon = selectedAgentConfig.icon;\n                      return <Icon className={`w-5 h-5 ${selectedAgentConfig.color}`} />;\n                    })()}\n                  </div>\n                  <div>\n                    <DialogTitle className=\"flex items-center gap-2\">\n                      {selectedAgentConfig.name}\n                      <Badge variant=\"secondary\">{selectedAgent.confidence}%</Badge>\n                    </DialogTitle>\n                    <DialogDescription>{selectedAgentConfig.description}</DialogDescription>\n                  </div>\n                </div>\n              </DialogHeader>\n\n              <div className=\"flex-1 overflow-y-auto max-h-[calc(90vh-200px)] pr-2\">\n                <div className=\"space-y-6 pr-2\">\n                  {renderFormattedAnalysis(selectedAgent.result)}\n\n                  {(selectedAgent.warnings as string[])?.length > 0 && (\n                    <div>\n                      <h4 className=\"font-medium text-foreground mb-2 flex items-center gap-2\">\n                        <AlertTriangle className=\"w-4 h-4 text-orange-500\" />\n                        Alertas ({(selectedAgent.warnings as string[]).length})\n                      </h4>\n                      <ul className=\"space-y-2\">\n                        {(selectedAgent.warnings as string[]).map((warning, index) => (\n                          <li key={index} className=\"flex items-start gap-2 text-sm bg-orange-500/10 p-3 rounded-md\">\n                            <XCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" />\n                            <span className=\"text-foreground\">{warning}</span>\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                  )}\n\n                  {(selectedAgent.recommendations as string[])?.length > 0 && (\n                    <div>\n                      <h4 className=\"font-medium text-foreground mb-2 flex items-center gap-2\">\n                        <Lightbulb className=\"w-4 h-4 text-yellow-500\" />\n                        Recomendações - Selecione para aplicar\n                      </h4>\n                      <div className=\"space-y-2\">\n                        {(selectedAgent.recommendations as string[]).map((rec, index) => {\n                          const isAlreadyApplied = appliedRecommendationsList.includes(rec);\n                          const isSelected = selectedRecommendations.includes(rec);\n                          \n                          return (\n                            <div \n                              key={index} \n                              className={`flex items-start gap-3 p-3 rounded-md transition-colors ${\n                                isAlreadyApplied\n                                  ? 'bg-green-500/10 border border-green-500/30 cursor-default'\n                                  : isSelected \n                                    ? 'bg-primary/10 border border-primary/30 cursor-pointer' \n                                    : 'bg-muted/50 cursor-pointer'\n                              }`}\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                if (!isAlreadyApplied) {\n                                  toggleRecommendation(rec);\n                                }\n                              }}\n                            >\n                              <Checkbox \n                                checked={isAlreadyApplied || isSelected}\n                                disabled={isAlreadyApplied}\n                                onCheckedChange={() => {\n                                  if (!isAlreadyApplied) {\n                                    toggleRecommendation(rec);\n                                  }\n                                }}\n                                onClick={(e) => e.stopPropagation()}\n                                data-testid={`checkbox-rec-${index}`}\n                                className={isAlreadyApplied ? 'data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500' : ''}\n                              />\n                              <div className=\"flex-1\">\n                                <span className={`text-sm ${isAlreadyApplied ? 'text-muted-foreground line-through' : 'text-foreground'}`}>\n                                  {rec}\n                                </span>\n                                {isAlreadyApplied && (\n                                  <div className=\"flex items-center gap-1 mt-1\">\n                                    <CheckCircle className=\"w-3 h-3 text-green-500\" />\n                                    <span className=\"text-xs text-green-600 dark:text-green-400\">Aplicada ao projeto</span>\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </div>\n                  )}\n\n                  <div>\n                    <Label htmlFor=\"user-notes\" className=\"flex items-center gap-2 mb-2\">\n                      <FileText className=\"w-4 h-4\" />\n                      Notas e Decisões\n                    </Label>\n                    <Textarea\n                      id=\"user-notes\"\n                      placeholder=\"Adicione notas, contexto ou decisões sobre as recomendações selecionadas...\"\n                      value={userNotes}\n                      onChange={(e) => setUserNotes(e.target.value)}\n                      className=\"min-h-[100px]\"\n                      data-testid=\"textarea-user-notes\"\n                    />\n                  </div>\n\n                  <div className=\"bg-blue-500/10 border border-blue-500/30 p-4 rounded-md\">\n                    <h4 className=\"font-medium text-foreground mb-3 flex items-center gap-2\">\n                      <ArrowRight className=\"w-4 h-4 text-blue-500\" />\n                      O que acontece após aplicar?\n                    </h4>\n                    <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                      <li className=\"flex items-start gap-2\">\n                        <CheckCircle className=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                        <span>As recomendações selecionadas serão salvas no histórico do projeto</span>\n                      </li>\n                      <li className=\"flex items-start gap-2\">\n                        <CheckCircle className=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                        <span>O escopo será atualizado com as melhorias sugeridas</span>\n                      </li>\n                      <li className=\"flex items-start gap-2\">\n                        <CheckCircle className=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                        <span>Você poderá revisar e editar no Briefing ou Escopo do projeto</span>\n                      </li>\n                    </ul>\n                    <div className=\"mt-4 flex flex-wrap gap-2\">\n                      <Link href={`/projects/${projectId}/briefing`}>\n                        <Button variant=\"outline\" size=\"sm\" data-testid=\"link-briefing\">\n                          <FileText className=\"w-3 h-3 mr-2\" />\n                          Ir para Briefing\n                        </Button>\n                      </Link>\n                      <Link href={`/projects/${projectId}/scope`}>\n                        <Button variant=\"outline\" size=\"sm\" data-testid=\"link-scope\">\n                          <Target className=\"w-3 h-3 mr-2\" />\n                          Ir para Escopo\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <DialogFooter className=\"flex-shrink-0 pt-4 border-t gap-2\">\n                <Button variant=\"outline\" onClick={closeAgentModal} data-testid=\"button-close-modal\">\n                  Fechar\n                </Button>\n                <Button\n                  onClick={handleApplyRecommendations}\n                  disabled={applyRecommendations.isPending || (selectedRecommendations.length === 0 && !userNotes)}\n                  data-testid=\"button-apply-recommendations\"\n                >\n                  {applyRecommendations.isPending ? (\n                    <>\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                      Aplicando...\n                    </>\n                  ) : (\n                    <>\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      Aplicar ao Projeto\n                    </>\n                  )}\n                </Button>\n              </DialogFooter>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Modal de escolha do modo de aplicação */}\n      <Dialog open={showApplyModeModal} onOpenChange={setShowApplyModeModal}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Sparkles className=\"w-5 h-5 text-primary\" />\n              Como deseja aplicar as recomendações?\n            </DialogTitle>\n            <DialogDescription>\n              Você selecionou {selectedRecommendations.length} recomendação{selectedRecommendations.length !== 1 ? 'ões' : ''} para aplicar ao projeto.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-4\">\n            <Card \n              className=\"cursor-pointer hover-elevate border-2 border-transparent hover:border-primary/50 transition-all\"\n              onClick={handleApplyDirect}\n              data-testid=\"card-apply-direct\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"p-2 rounded-md bg-primary/10\">\n                    <Zap className=\"w-5 h-5 text-primary\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-medium text-foreground\">Aplicar Diretamente</h4>\n                    <p className=\"text-sm text-muted-foreground mt-1\">\n                      Todas as recomendações serão aplicadas simultaneamente ao projeto. \n                      O escopo, roadmap e estágios serão atualizados automaticamente.\n                    </p>\n                    <Badge variant=\"secondary\" className=\"mt-2\">\n                      Rápido\n                    </Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card \n              className=\"cursor-pointer hover-elevate border-2 border-transparent hover:border-primary/50 transition-all\"\n              onClick={handleApplyWithTracking}\n              data-testid=\"card-apply-tracking\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"p-2 rounded-md bg-blue-500/10\">\n                    <Eye className=\"w-5 h-5 text-blue-500\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-medium text-foreground\">Acompanhar Modificações</h4>\n                    <p className=\"text-sm text-muted-foreground mt-1\">\n                      Você será direcionado para o Briefing onde cada recomendação será \n                      aplicada uma por vez, permitindo revisar e ajustar cada mudança.\n                    </p>\n                    <Badge variant=\"outline\" className=\"mt-2\">\n                      Passo a passo\n                    </Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowApplyModeModal(false)} data-testid=\"button-cancel-apply-mode\">\n              Cancelar\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":53617,"size_tokens":null},"client/src/pages/login.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Loader2, LogIn } from \"lucide-react\";\n\nconst EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [errors, setErrors] = useState<{ email?: string; password?: string }>({});\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: { email: string; password: string }) => {\n      return await apiRequest(\"POST\", \"/api/auth/login\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Login realizado\",\n        description: \"Bem-vindo de volta!\",\n        variant: \"success\",\n      });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro no login\",\n        description: error.message || \"Email ou senha incorretos\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const validateForm = (): boolean => {\n    const newErrors: { email?: string; password?: string } = {};\n    \n    if (!email) {\n      newErrors.email = \"Email é obrigatório\";\n    } else if (!EMAIL_REGEX.test(email)) {\n      newErrors.email = \"Formato de email inválido\";\n    }\n    \n    if (!password) {\n      newErrors.password = \"Senha é obrigatória\";\n    }\n    \n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (validateForm()) {\n      loginMutation.mutate({ email, password });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"text-2xl\">Entrar</CardTitle>\n          <CardDescription>\n            Acesse sua conta para gerenciar seus projetos\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"seu@email.com\"\n                value={email}\n                onChange={(e) => {\n                  setEmail(e.target.value);\n                  if (errors.email) setErrors({ ...errors, email: undefined });\n                }}\n                className={errors.email ? \"border-destructive\" : \"\"}\n                data-testid=\"input-email\"\n              />\n              {errors.email && (\n                <p className=\"text-sm text-destructive\" data-testid=\"error-email\">{errors.email}</p>\n              )}\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Senha</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"Sua senha\"\n                value={password}\n                onChange={(e) => {\n                  setPassword(e.target.value);\n                  if (errors.password) setErrors({ ...errors, password: undefined });\n                }}\n                className={errors.password ? \"border-destructive\" : \"\"}\n                data-testid=\"input-password\"\n              />\n              {errors.password && (\n                <p className=\"text-sm text-destructive\" data-testid=\"error-password\">{errors.password}</p>\n              )}\n            </div>\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={loginMutation.isPending}\n              data-testid=\"button-login\"\n            >\n              {loginMutation.isPending ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  Entrando...\n                </>\n              ) : (\n                <>\n                  <LogIn className=\"w-4 h-4 mr-2\" />\n                  Entrar\n                </>\n              )}\n            </Button>\n          </form>\n          <div className=\"mt-4 text-center text-sm text-muted-foreground\">\n            Não tem uma conta?{\" \"}\n            <Link href=\"/register\" className=\"text-primary hover:underline\" data-testid=\"link-register\">\n              Cadastre-se\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4940,"size_tokens":null},"server/auth.ts":{"content":"import { Express, Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport bcrypt from \"bcrypt\";\nimport { storage } from \"./storage\";\nimport type { User } from \"@shared/schema\";\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n  }\n}\n\nexport interface AuthenticatedRequest extends Request {\n  user?: User;\n}\n\nconst SALT_ROUNDS = 10;\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\nconst EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\nexport function setupAuth(app: Express) {\n  app.use(\n    session({\n      secret: process.env.SESSION_SECRET || \"dev-secret-change-in-production\",\n      resave: false,\n      saveUninitialized: false,\n      cookie: {\n        secure: process.env.NODE_ENV === \"production\",\n        httpOnly: true,\n        sameSite: \"strict\",\n        maxAge: 7 * 24 * 60 * 60 * 1000,\n      },\n    })\n  );\n\n  app.post(\"/api/auth/register\", async (req: Request, res: Response) => {\n    try {\n      const { email, password, firstName, lastName } = req.body;\n\n      if (!email || !password) {\n        return res.status(400).json({ message: \"Email e senha são obrigatórios\" });\n      }\n\n      if (!EMAIL_REGEX.test(email)) {\n        return res.status(400).json({ message: \"Formato de email inválido\" });\n      }\n\n      if (password.length < 6) {\n        return res.status(400).json({ message: \"A senha deve ter pelo menos 6 caracteres\" });\n      }\n\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Este email já está cadastrado\" });\n      }\n\n      const hashedPassword = await hashPassword(password);\n      const user = await storage.createUser({\n        email,\n        password: hashedPassword,\n        firstName,\n        lastName,\n      });\n\n      req.session.userId = user.id;\n      \n      res.status(201).json({\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n      });\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      res.status(500).json({ message: \"Erro ao registrar usuário\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req: Request, res: Response) => {\n    try {\n      const { email, password } = req.body;\n\n      if (!email || !password) {\n        return res.status(400).json({ message: \"Email e senha são obrigatórios\" });\n      }\n\n      if (!EMAIL_REGEX.test(email)) {\n        return res.status(400).json({ message: \"Formato de email inválido\" });\n      }\n\n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(401).json({ message: \"Email ou senha incorretos\" });\n      }\n\n      const isValid = await verifyPassword(password, user.password);\n      if (!isValid) {\n        return res.status(401).json({ message: \"Email ou senha incorretos\" });\n      }\n\n      req.session.userId = user.id;\n      \n      res.json({\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n      });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Erro ao fazer login\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req: Request, res: Response) => {\n    req.session.destroy((err) => {\n      if (err) {\n        console.error(\"Logout error:\", err);\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ message: \"Logout realizado com sucesso\" });\n    });\n  });\n\n  app.get(\"/api/auth/user\", async (req: Request, res: Response) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Não autenticado\" });\n      }\n\n      const user = await storage.getUser(req.session.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"Usuário não encontrado\" });\n      }\n\n      res.json({\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n      });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ message: \"Erro ao buscar usuario\" });\n    }\n  });\n}\n\nexport function isAuthenticated(req: AuthenticatedRequest, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"Não autenticado\" });\n  }\n  \n  storage.getUser(req.session.userId).then((user) => {\n    if (!user) {\n      return res.status(401).json({ message: \"Usuário não encontrado\" });\n    }\n    req.user = user;\n    next();\n  }).catch((error) => {\n    console.error(\"Auth middleware error:\", error);\n    res.status(500).json({ message: \"Erro de autenticação\" });\n  });\n}\n","path":null,"size_bytes":4936,"size_tokens":null},"client/src/pages/documents.tsx":{"content":"import { useState } from \"react\";\nimport { useRoute, Link } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  ArrowLeft,\n  FileText,\n  Code,\n  Server,\n  Download,\n  RefreshCw,\n  Loader2,\n  Copy,\n  BookOpen,\n  Wrench,\n} from \"lucide-react\";\nimport type { Project, Document } from \"@shared/schema\";\n\nconst documentTypes = [\n  { type: \"technical\", label: \"Documentação Técnica\", icon: FileText, description: \"Especificação técnica completa do projeto\" },\n  { type: \"architecture\", label: \"Arquitetura\", icon: Server, description: \"Diagramas e decisões arquiteturais\" },\n  { type: \"api\", label: \"Documentação API\", icon: Code, description: \"Endpoints, parâmetros e exemplos\" },\n  { type: \"installation\", label: \"Guia de Instalação\", icon: Wrench, description: \"Instruções de deploy e configuração\" },\n] as const;\n\nexport default function Documents() {\n  const [, params] = useRoute(\"/projects/:id/documents\");\n  const projectId = params?.id;\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"technical\");\n  const [generatingType, setGeneratingType] = useState<string | null>(null);\n\n  const { data: project, isLoading: projectLoading } = useQuery<Project>({\n    queryKey: [\"/api/projects\", projectId],\n    enabled: !!projectId,\n  });\n\n  const { data: documents, isLoading: docsLoading } = useQuery<Document[]>({\n    queryKey: [\"/api/projects\", projectId, \"documents\"],\n    enabled: !!projectId,\n  });\n\n  const generateDoc = useMutation({\n    mutationFn: async (type: string) => {\n      setGeneratingType(type);\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/documents/generate`, { type });\n    },\n    onSuccess: (_, type) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"documents\"] });\n      toast({\n        title: \"Documento Gerado\",\n        description: `${documentTypes.find(d => d.type === type)?.label} foi gerado com sucesso.`,\n        variant: \"success\",\n      });\n      setGeneratingType(null);\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível gerar o documento.\",\n        variant: \"destructive\",\n      });\n      setGeneratingType(null);\n    },\n  });\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast({\n      title: \"Copiado\",\n      description: \"Conteúdo copiado para a área de transferência.\",\n      variant: \"success\",\n    });\n  };\n\n  const downloadDocument = (doc: Document) => {\n    const blob = new Blob([doc.content || \"\"], { type: \"text/markdown\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `${doc.title.toLowerCase().replace(/\\s+/g, \"-\")}.md`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  if (projectLoading || docsLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-64\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {[...Array(4)].map((_, i) => (\n            <Skeleton key={i} className=\"h-24\" />\n          ))}\n        </div>\n        <Skeleton className=\"h-[400px]\" />\n      </div>\n    );\n  }\n\n  if (!project) {\n    return (\n      <div className=\"p-6 text-center\">\n        <p className=\"text-muted-foreground\">Projeto não encontrado</p>\n      </div>\n    );\n  }\n\n  const getDocument = (type: string) => documents?.find(d => d.type === type);\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      <div className=\"p-4 md:p-6 border-b border-border bg-background flex-shrink-0\">\n        <div className=\"flex items-center gap-3\">\n          <Link href={`/projects/${projectId}`}>\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n              <ArrowLeft className=\"w-4 h-4\" />\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-xl font-semibold text-foreground\">\n              Documentação - {project.name}\n            </h1>\n            <p className=\"text-sm text-muted-foreground\">\n              Gere e gerencie a documentação técnica do projeto\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 min-h-0 overflow-hidden p-4 md:p-6\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6 h-full min-h-0\">\n          <div className=\"lg:col-span-1 space-y-3\">\n            <h2 className=\"text-sm font-medium text-muted-foreground mb-3\">Tipos de Documento</h2>\n            {documentTypes.map((docType) => {\n              const doc = getDocument(docType.type);\n              const isGenerating = generatingType === docType.type;\n              const Icon = docType.icon;\n              \n              return (\n                <Card \n                  key={docType.type}\n                  className={`cursor-pointer transition-colors ${activeTab === docType.type ? \"border-primary\" : \"\"}`}\n                  onClick={() => setActiveTab(docType.type)}\n                  data-testid={`card-doc-${docType.type}`}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"p-2 rounded-md bg-muted\">\n                        <Icon className=\"w-4 h-4\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                          <p className=\"font-medium text-sm text-foreground\">{docType.label}</p>\n                          {doc ? (\n                            <Badge variant=\"secondary\" className=\"text-xs\">Gerado</Badge>\n                          ) : (\n                            <Badge variant=\"outline\" className=\"text-xs\">Pendente</Badge>\n                          )}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">{docType.description}</p>\n                      </div>\n                    </div>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full mt-3\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        generateDoc.mutate(docType.type);\n                      }}\n                      disabled={isGenerating}\n                      data-testid={`button-generate-${docType.type}`}\n                    >\n                      {isGenerating ? (\n                        <>\n                          <Loader2 className=\"w-3 h-3 mr-2 animate-spin\" />\n                          Gerando...\n                        </>\n                      ) : doc ? (\n                        <>\n                          <RefreshCw className=\"w-3 h-3 mr-2\" />\n                          Regenerar\n                        </>\n                      ) : (\n                        <>\n                          <BookOpen className=\"w-3 h-3 mr-2\" />\n                          Gerar\n                        </>\n                      )}\n                    </Button>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n\n          <div className=\"lg:col-span-3 min-h-0 overflow-hidden\">\n            <Card className=\"h-full flex flex-col min-h-0\">\n              <CardHeader className=\"flex-shrink-0 flex flex-row items-center justify-between gap-2 pb-4\">\n                <CardTitle className=\"text-lg\">\n                  {documentTypes.find(d => d.type === activeTab)?.label}\n                </CardTitle>\n                {getDocument(activeTab) && (\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => copyToClipboard(getDocument(activeTab)?.content || \"\")}\n                      data-testid=\"button-copy-doc\"\n                    >\n                      <Copy className=\"w-4 h-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => downloadDocument(getDocument(activeTab)!)}\n                      data-testid=\"button-download-doc\"\n                    >\n                      <Download className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                )}\n              </CardHeader>\n              <CardContent className=\"flex-1 min-h-0 overflow-hidden p-4\">\n                <ScrollArea className=\"h-full pr-4\">\n                  {getDocument(activeTab) ? (\n                    <div className=\"prose prose-sm dark:prose-invert max-w-none pb-4\">\n                      <pre className=\"whitespace-pre-wrap text-sm text-foreground bg-muted p-4 rounded-md overflow-x-auto\">\n                        {getDocument(activeTab)?.content}\n                      </pre>\n                    </div>\n                  ) : (\n                    <div className=\"flex flex-col items-center justify-center h-64 text-center\">\n                      <BookOpen className=\"w-12 h-12 text-muted-foreground mb-4\" />\n                      <h3 className=\"font-medium text-foreground mb-2\">\n                        Documento não gerado\n                      </h3>\n                      <p className=\"text-sm text-muted-foreground mb-4\">\n                        Clique em \"Gerar\" para criar este documento automaticamente.\n                      </p>\n                      <Button\n                        onClick={() => generateDoc.mutate(activeTab)}\n                        disabled={generatingType === activeTab}\n                        data-testid=\"button-generate-empty\"\n                      >\n                        {generatingType === activeTab ? (\n                          <>\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                            Gerando...\n                          </>\n                        ) : (\n                          <>\n                            <BookOpen className=\"w-4 h-4 mr-2\" />\n                            Gerar Documento\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  )}\n                </ScrollArea>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10977,"size_tokens":null},"client/src/pages/vault.tsx":{"content":"import { useState } from \"react\";\nimport { useRoute, Link } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  ArrowLeft,\n  Key,\n  Plus,\n  Eye,\n  EyeOff,\n  Copy,\n  Trash2,\n  Edit,\n  Lock,\n  Shield,\n  Loader2,\n} from \"lucide-react\";\nimport type { Project, VaultItem } from \"@shared/schema\";\n\nconst typeLabels: Record<string, string> = {\n  api_key: \"Chave de API\",\n  password: \"Senha\",\n  token: \"Token\",\n  certificate: \"Certificado\",\n  connection_string: \"String de Conexão\",\n  other: \"Outro\",\n};\n\nconst typeIcons: Record<string, typeof Key> = {\n  api_key: Key,\n  password: Lock,\n  token: Shield,\n  certificate: Shield,\n  connection_string: Key,\n  other: Key,\n};\n\nconst environmentLabels: Record<string, string> = {\n  development: \"Desenvolvimento\",\n  staging: \"Staging\",\n  production: \"Produção\",\n};\n\nconst environmentColors: Record<string, string> = {\n  development: \"bg-blue-500/10 text-blue-600 dark:text-blue-400\",\n  staging: \"bg-yellow-500/10 text-yellow-600 dark:text-yellow-400\",\n  production: \"bg-green-500/10 text-green-600 dark:text-green-400\",\n};\n\nexport default function Vault() {\n  const [, params] = useRoute(\"/projects/:id/vault\");\n  const projectId = params?.id;\n  const { toast } = useToast();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingItem, setEditingItem] = useState<VaultItem | null>(null);\n  const [visibleValues, setVisibleValues] = useState<Set<string>>(new Set());\n  const [formData, setFormData] = useState({\n    name: \"\",\n    type: \"api_key\",\n    value: \"\",\n    description: \"\",\n    environment: \"production\",\n  });\n\n  const { data: project, isLoading: projectLoading } = useQuery<Project>({\n    queryKey: [\"/api/projects\", projectId],\n    enabled: !!projectId,\n  });\n\n  const { data: vaultItems, isLoading: vaultLoading } = useQuery<VaultItem[]>({\n    queryKey: [\"/api/projects\", projectId, \"vault\"],\n    enabled: !!projectId,\n  });\n\n  const createItem = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      return await apiRequest(\"POST\", `/api/projects/${projectId}/vault`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"vault\"] });\n      toast({\n        title: \"Credencial Salva\",\n        description: \"A credencial foi adicionada ao cofre com segurança.\",\n        variant: \"success\",\n      });\n      resetForm();\n      setIsDialogOpen(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível salvar a credencial.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateItem = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<typeof formData> }) => {\n      return await apiRequest(\"PATCH\", `/api/vault/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"vault\"] });\n      toast({\n        title: \"Credencial Atualizada\",\n        description: \"A credencial foi atualizada.\",\n        variant: \"success\",\n      });\n      resetForm();\n      setIsDialogOpen(false);\n      setEditingItem(null);\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível atualizar a credencial.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteItem = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/vault/${id}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"vault\"] });\n      toast({\n        title: \"Credencial Removida\",\n        description: \"A credencial foi removida do cofre.\",\n        variant: \"success\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível remover a credencial.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      name: \"\",\n      type: \"api_key\",\n      value: \"\",\n      description: \"\",\n      environment: \"production\",\n    });\n  };\n\n  const handleEdit = (item: VaultItem) => {\n    setEditingItem(item);\n    setFormData({\n      name: item.name,\n      type: item.type,\n      value: item.value,\n      description: item.description || \"\",\n      environment: item.environment || \"production\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleSubmit = () => {\n    if (!formData.name || !formData.value) {\n      toast({\n        title: \"Campos obrigatórios\",\n        description: \"Preencha o nome e o valor da credencial.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (editingItem) {\n      updateItem.mutate({ id: editingItem.id, data: formData });\n    } else {\n      createItem.mutate(formData);\n    }\n  };\n\n  const [revealedValues, setRevealedValues] = useState<Record<string, string>>({});\n\n  const toggleVisibility = async (id: string) => {\n    if (visibleValues.has(id)) {\n      setVisibleValues((prev) => {\n        const next = new Set(prev);\n        next.delete(id);\n        return next;\n      });\n    } else {\n      try {\n        const res = await fetch(`/api/projects/${projectId}/vault/${id}/reveal`, {\n          credentials: \"include\",\n        });\n        if (res.ok) {\n          const data = await res.json();\n          setRevealedValues((prev) => ({ ...prev, [id]: data.value }));\n          setVisibleValues((prev) => {\n            const next = new Set(prev);\n            next.add(id);\n            return next;\n          });\n        }\n      } catch (error) {\n        toast({\n          title: \"Erro\",\n          description: \"Não foi possível revelar o valor.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const copyToClipboard = async (id: string) => {\n    try {\n      const res = await fetch(`/api/projects/${projectId}/vault/${id}/reveal`, {\n        credentials: \"include\",\n      });\n      if (res.ok) {\n        const data = await res.json();\n        navigator.clipboard.writeText(data.value);\n        toast({\n          title: \"Copiado\",\n          description: \"Valor copiado para a área de transferência.\",\n          variant: \"success\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível copiar o valor.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (projectLoading || vaultLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-64\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {[...Array(4)].map((_, i) => (\n            <Skeleton key={i} className=\"h-32\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!project) {\n    return (\n      <div className=\"p-6 text-center\">\n        <p className=\"text-muted-foreground\">Projeto não encontrado</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      <div className=\"p-4 md:p-6 border-b border-border bg-background flex-shrink-0\">\n        <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n          <div className=\"flex items-center gap-3\">\n            <Link href={`/projects/${projectId}`}>\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                <ArrowLeft className=\"w-4 h-4\" />\n              </Button>\n            </Link>\n            <div>\n              <h1 className=\"text-xl font-semibold text-foreground flex items-center gap-2\">\n                <Shield className=\"w-5 h-5\" />\n                Cofre de Credenciais\n              </h1>\n              <p className=\"text-sm text-muted-foreground\">\n                {project.name} - Gerencie chaves de API, senhas e tokens\n              </p>\n            </div>\n          </div>\n\n          <Dialog open={isDialogOpen} onOpenChange={(open) => {\n            setIsDialogOpen(open);\n            if (!open) {\n              setEditingItem(null);\n              resetForm();\n            }\n          }}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-credential\">\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Adicionar Credencial\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>\n                  {editingItem ? \"Editar Credencial\" : \"Nova Credencial\"}\n                </DialogTitle>\n                <DialogDescription>\n                  Armazene suas credenciais de forma segura\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4 py-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"name\">Nome</Label>\n                  <Input\n                    id=\"name\"\n                    placeholder=\"Ex: OpenAI API Key\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    data-testid=\"input-vault-name\"\n                  />\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Tipo</Label>\n                    <Select\n                      value={formData.type}\n                      onValueChange={(value) => setFormData({ ...formData, type: value })}\n                    >\n                      <SelectTrigger data-testid=\"select-vault-type\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"api_key\">Chave de API</SelectItem>\n                        <SelectItem value=\"password\">Senha</SelectItem>\n                        <SelectItem value=\"token\">Token</SelectItem>\n                        <SelectItem value=\"certificate\">Certificado</SelectItem>\n                        <SelectItem value=\"connection_string\">String de Conexão</SelectItem>\n                        <SelectItem value=\"other\">Outro</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Ambiente</Label>\n                    <Select\n                      value={formData.environment}\n                      onValueChange={(value) => setFormData({ ...formData, environment: value })}\n                    >\n                      <SelectTrigger data-testid=\"select-vault-environment\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"development\">Desenvolvimento</SelectItem>\n                        <SelectItem value=\"staging\">Staging</SelectItem>\n                        <SelectItem value=\"production\">Produção</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"value\">Valor</Label>\n                  <Textarea\n                    id=\"value\"\n                    placeholder=\"Insira a chave, senha ou token\"\n                    value={formData.value}\n                    onChange={(e) => setFormData({ ...formData, value: e.target.value })}\n                    className=\"font-mono text-sm\"\n                    data-testid=\"input-vault-value\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Descrição (opcional)</Label>\n                  <Input\n                    id=\"description\"\n                    placeholder=\"Descrição ou observações\"\n                    value={formData.description}\n                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                    data-testid=\"input-vault-description\"\n                  />\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                  Cancelar\n                </Button>\n                <Button\n                  onClick={handleSubmit}\n                  disabled={createItem.isPending || updateItem.isPending}\n                  data-testid=\"button-save-credential\"\n                >\n                  {(createItem.isPending || updateItem.isPending) && (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  )}\n                  {editingItem ? \"Salvar Alterações\" : \"Adicionar\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-4 md:p-6\">\n          {vaultItems && vaultItems.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {vaultItems.map((item) => {\n                const Icon = typeIcons[item.type] || Key;\n                const isVisible = visibleValues.has(item.id);\n\n                return (\n                  <Card key={item.id} data-testid={`card-vault-item-${item.id}`}>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <div className=\"flex items-center gap-2 min-w-0 flex-1\">\n                          <div className=\"p-2 rounded-md bg-muted flex-shrink-0\">\n                            <Icon className=\"w-4 h-4\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <CardTitle className=\"text-sm truncate\">{item.name}</CardTitle>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {typeLabels[item.type]}\n                            </p>\n                          </div>\n                        </div>\n                        <Badge\n                          className={environmentColors[item.environment || \"production\"]}\n                          variant=\"secondary\"\n                        >\n                          {environmentLabels[item.environment || \"production\"]}\n                        </Badge>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <code className=\"flex-1 text-xs bg-muted p-2 rounded font-mono truncate\">\n                          {isVisible && revealedValues[item.id] ? revealedValues[item.id] : \"••••••••••••••••\"}\n                        </code>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => toggleVisibility(item.id)}\n                          data-testid={`button-toggle-visibility-${item.id}`}\n                        >\n                          {isVisible ? (\n                            <EyeOff className=\"w-4 h-4\" />\n                          ) : (\n                            <Eye className=\"w-4 h-4\" />\n                          )}\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => copyToClipboard(item.id)}\n                          data-testid={`button-copy-${item.id}`}\n                        >\n                          <Copy className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                      {item.description && (\n                        <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                      )}\n                      <div className=\"flex items-center gap-2 pt-2 border-t border-border\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleEdit(item)}\n                          data-testid={`button-edit-${item.id}`}\n                        >\n                          <Edit className=\"w-3 h-3 mr-1\" />\n                          Editar\n                        </Button>\n                        <AlertDialog>\n                          <AlertDialogTrigger asChild>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              data-testid={`button-delete-${item.id}`}\n                            >\n                              <Trash2 className=\"w-3 h-3 mr-1\" />\n                              Excluir\n                            </Button>\n                          </AlertDialogTrigger>\n                          <AlertDialogContent>\n                            <AlertDialogHeader>\n                              <AlertDialogTitle>Confirmar exclusão</AlertDialogTitle>\n                              <AlertDialogDescription>\n                                Tem certeza que deseja excluir \"{item.name}\"? Esta ação não pode ser desfeita.\n                              </AlertDialogDescription>\n                            </AlertDialogHeader>\n                            <AlertDialogFooter>\n                              <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                              <AlertDialogAction\n                                onClick={() => deleteItem.mutate(item.id)}\n                                data-testid={`button-confirm-delete-${item.id}`}\n                              >\n                                Excluir\n                              </AlertDialogAction>\n                            </AlertDialogFooter>\n                          </AlertDialogContent>\n                        </AlertDialog>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          ) : (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <Shield className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                <h3 className=\"font-medium text-foreground mb-2\">Cofre vazio</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Adicione suas chaves de API, senhas e tokens de forma segura.\n                </p>\n                <Button onClick={() => setIsDialogOpen(true)} data-testid=\"button-add-first\">\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  Adicionar Primeira Credencial\n                </Button>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n","path":null,"size_bytes":19816,"size_tokens":null},"client/src/pages/my-tasks.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  ListChecks,\n  ChevronRight,\n  Calendar,\n  Clock,\n  CheckCircle2,\n  Circle,\n  ArrowLeft,\n  FolderOpen\n} from \"lucide-react\";\n\ninterface StageWithProject {\n  id: string;\n  name: string;\n  status: string;\n  progress: number;\n  projectId: string;\n  projectName: string;\n}\n\ninterface MyTasksResponse {\n  assignments: StageWithProject[];\n  totalStages: number;\n  completedStages: number;\n}\n\nexport default function MyTasks() {\n  const { data, isLoading } = useQuery<MyTasksResponse>({\n    queryKey: [\"/api/users/me/tasks\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background p-6\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <Skeleton className=\"h-10 w-64\" />\n          <div className=\"grid gap-4\">\n            {[1, 2, 3].map((i) => (\n              <Skeleton key={i} className=\"h-32\" />\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const groupedByProject = data?.assignments.reduce((acc, stage) => {\n    if (!acc[stage.projectId]) {\n      acc[stage.projectId] = {\n        projectName: stage.projectName,\n        stages: []\n      };\n    }\n    acc[stage.projectId].stages.push(stage);\n    return acc;\n  }, {} as Record<string, { projectName: string; stages: StageWithProject[] }>) || {};\n\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <div className=\"max-w-4xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n          <div className=\"flex items-center gap-4\">\n            <Link href=\"/dashboard\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back-dashboard\">\n                <ArrowLeft className=\"w-5 h-5\" />\n              </Button>\n            </Link>\n            <div>\n              <h1 className=\"text-2xl font-bold text-foreground\">Minhas Tarefas</h1>\n              <p className=\"text-sm text-muted-foreground\">\n                Estágios atribuídos a você em todos os projetos\n              </p>\n            </div>\n          </div>\n          {data && (\n            <div className=\"flex items-center gap-4\">\n              <div className=\"text-right\">\n                <p className=\"text-2xl font-bold text-foreground\">{data.completedStages}/{data.totalStages}</p>\n                <p className=\"text-xs text-muted-foreground\">concluídos</p>\n              </div>\n              <Progress \n                value={data.totalStages > 0 ? (data.completedStages / data.totalStages) * 100 : 0} \n                className=\"w-24 h-2\" \n              />\n            </div>\n          )}\n        </div>\n\n        {Object.keys(groupedByProject).length > 0 ? (\n          <div className=\"space-y-6\">\n            {Object.entries(groupedByProject).map(([projectId, { projectName, stages }]) => (\n              <Card key={projectId} data-testid={`card-project-tasks-${projectId}`}>\n                <CardHeader className=\"pb-2\">\n                  <div className=\"flex items-center justify-between gap-2\">\n                    <CardTitle className=\"flex items-center gap-2 text-lg\">\n                      <FolderOpen className=\"w-5 h-5 text-primary\" />\n                      {projectName}\n                    </CardTitle>\n                    <Link href={`/projects/${projectId}`}>\n                      <Button variant=\"outline\" size=\"sm\" data-testid={`button-view-project-${projectId}`}>\n                        Ver Projeto\n                        <ChevronRight className=\"w-4 h-4 ml-1\" />\n                      </Button>\n                    </Link>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"divide-y divide-border\">\n                    {stages.map((stage) => (\n                      <div\n                        key={stage.id}\n                        className=\"py-3 flex items-center justify-between gap-4\"\n                        data-testid={`row-stage-${stage.id}`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          {stage.status === \"approved\" ? (\n                            <CheckCircle2 className=\"w-5 h-5 text-green-500\" />\n                          ) : stage.status === \"in_progress\" ? (\n                            <Clock className=\"w-5 h-5 text-blue-500\" />\n                          ) : (\n                            <Circle className=\"w-5 h-5 text-muted-foreground\" />\n                          )}\n                          <div>\n                            <p className=\"font-medium text-foreground\">{stage.name}</p>\n                            <div className=\"flex items-center gap-2 mt-1\">\n                              <Badge\n                                variant=\"secondary\"\n                                className={`text-xs ${\n                                  stage.status === \"approved\"\n                                    ? \"bg-green-500/10 text-green-600\"\n                                    : stage.status === \"in_progress\"\n                                    ? \"bg-blue-500/10 text-blue-600\"\n                                    : \"\"\n                                }`}\n                              >\n                                {stage.status === \"approved\"\n                                  ? \"Aprovado\"\n                                  : stage.status === \"in_progress\"\n                                  ? \"Em andamento\"\n                                  : stage.status === \"rejected\"\n                                  ? \"Rejeitado\"\n                                  : \"Pendente\"}\n                              </Badge>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                          <div className=\"text-right\">\n                            <p className=\"text-sm font-medium text-foreground\">{stage.progress}%</p>\n                            <Progress value={stage.progress || 0} className=\"w-20 h-1.5\" />\n                          </div>\n                          <Link href={`/projects/${projectId}?tab=execution`}>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-go-stage-${stage.id}`}>\n                              <ChevronRight className=\"w-4 h-4\" />\n                            </Button>\n                          </Link>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <ListChecks className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <h3 className=\"font-medium text-foreground mb-2\">Nenhuma tarefa atribuída</h3>\n              <p className=\"text-sm text-muted-foreground mb-4\">\n                Você não tem estágios atribuídos em nenhum projeto.\n              </p>\n              <Link href=\"/dashboard\">\n                <Button variant=\"outline\" data-testid=\"button-go-projects\">\n                  <FolderOpen className=\"w-4 h-4 mr-2\" />\n                  Ver Projetos\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7663,"size_tokens":null},"client/src/pages/accept-invite.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, CheckCircle2, XCircle, Mail, User, Lock, FolderKanban } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nconst acceptInviteSchema = z.object({\n  firstName: z.string().min(2, \"Nome deve ter pelo menos 2 caracteres\"),\n  lastName: z.string().optional(),\n  password: z.string().min(6, \"Senha deve ter pelo menos 6 caracteres\"),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"As senhas não coincidem\",\n  path: [\"confirmPassword\"],\n});\n\ntype AcceptInviteFormData = z.infer<typeof acceptInviteSchema>;\n\ninterface InviteInfo {\n  email: string;\n  projectName: string;\n  memberName: string;\n  role: string;\n}\n\nexport default function AcceptInvite() {\n  const { token } = useParams<{ token: string }>();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isAccepted, setIsAccepted] = useState(false);\n\n  const { data: inviteInfo, isLoading, error } = useQuery<InviteInfo>({\n    queryKey: ['/api/invites', token],\n    enabled: !!token,\n  });\n\n  const form = useForm<AcceptInviteFormData>({\n    resolver: zodResolver(acceptInviteSchema),\n    defaultValues: {\n      firstName: \"\",\n      lastName: \"\",\n      password: \"\",\n      confirmPassword: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (inviteInfo?.memberName) {\n      const nameParts = inviteInfo.memberName.split(\" \");\n      form.setValue(\"firstName\", nameParts[0] || \"\");\n      form.setValue(\"lastName\", nameParts.slice(1).join(\" \") || \"\");\n    }\n  }, [inviteInfo, form]);\n\n  const acceptMutation = useMutation({\n    mutationFn: async (data: AcceptInviteFormData) => {\n      const response = await apiRequest(\"POST\", `/api/invites/${token}/accept`, {\n        firstName: data.firstName,\n        lastName: data.lastName,\n        password: data.password,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      setIsAccepted(true);\n      toast({\n        title: \"Conta criada com sucesso!\",\n        description: \"Você será redirecionado para o login.\",\n      });\n      setTimeout(() => {\n        setLocation(\"/login\");\n      }, 3000);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro ao criar conta\",\n        description: error.message || \"Tente novamente mais tarde.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: AcceptInviteFormData) => {\n    acceptMutation.mutate(data);\n  };\n\n  const getRoleLabel = (role: string) => {\n    switch (role) {\n      case \"owner\": return \"Proprietário\";\n      case \"manager\": return \"Gerente\";\n      default: return \"Colaborador\";\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"flex flex-col items-center gap-4\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          <p className=\"text-muted-foreground\">Validando convite...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !inviteInfo) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-destructive/10\">\n              <XCircle className=\"h-8 w-8 text-destructive\" />\n            </div>\n            <CardTitle>Convite Inválido</CardTitle>\n            <CardDescription>\n              Este convite não existe, já foi aceito ou expirou.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"flex justify-center\">\n            <Button onClick={() => setLocation(\"/login\")} data-testid=\"button-go-login\">\n              Ir para Login\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isAccepted) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10\">\n              <CheckCircle2 className=\"h-8 w-8 text-green-500\" />\n            </div>\n            <CardTitle>Conta Criada!</CardTitle>\n            <CardDescription>\n              Sua conta foi criada com sucesso. Redirecionando para o login...\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"flex justify-center\">\n            <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-primary/10\">\n            <Mail className=\"h-8 w-8 text-primary\" />\n          </div>\n          <CardTitle>Aceitar Convite</CardTitle>\n          <CardDescription>\n            Você foi convidado para participar de um projeto\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"rounded-lg border bg-muted/30 p-4 space-y-3\">\n            <div className=\"flex items-center gap-2\">\n              <FolderKanban className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-sm text-muted-foreground\">Projeto:</span>\n              <span className=\"font-medium\" data-testid=\"text-project-name\">{inviteInfo.projectName}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Mail className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-sm text-muted-foreground\">E-mail:</span>\n              <span className=\"font-medium\" data-testid=\"text-invite-email\">{inviteInfo.email}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <User className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-sm text-muted-foreground\">Função:</span>\n              <Badge variant=\"secondary\" data-testid=\"badge-invite-role\">{getRoleLabel(inviteInfo.role)}</Badge>\n            </div>\n          </div>\n\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"firstName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Nome</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Seu nome\" \n                          data-testid=\"input-first-name\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"lastName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Sobrenome</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Seu sobrenome\" \n                          data-testid=\"input-last-name\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Senha</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input \n                          type=\"password\" \n                          placeholder=\"Crie uma senha\" \n                          className=\"pl-10\"\n                          data-testid=\"input-password\"\n                          {...field} \n                        />\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"confirmPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Confirmar Senha</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input \n                          type=\"password\" \n                          placeholder=\"Confirme a senha\" \n                          className=\"pl-10\"\n                          data-testid=\"input-confirm-password\"\n                          {...field} \n                        />\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button \n                type=\"submit\" \n                className=\"w-full\" \n                disabled={acceptMutation.isPending}\n                data-testid=\"button-accept-invite\"\n              >\n                {acceptMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Criando conta...\n                  </>\n                ) : (\n                  \"Aceitar Convite e Criar Conta\"\n                )}\n              </Button>\n            </form>\n          </Form>\n\n          <p className=\"text-center text-sm text-muted-foreground\">\n            Já tem uma conta?{\" \"}\n            <Button \n              variant=\"ghost\" \n              className=\"p-0 h-auto text-primary underline-offset-4 hover:underline\"\n              onClick={() => setLocation(\"/login\")}\n              data-testid=\"link-login\"\n            >\n              Fazer login\n            </Button>\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":11244,"size_tokens":null},"server/email.ts":{"content":"// Email service using Resend integration\nimport { Resend } from 'resend';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=resend',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  if (!connectionSettings || (!connectionSettings.settings.api_key)) {\n    throw new Error('Resend not connected');\n  }\n  return {\n    apiKey: connectionSettings.settings.api_key, \n    fromEmail: connectionSettings.settings.from_email\n  };\n}\n\nasync function getResendClient() {\n  const { apiKey, fromEmail } = await getCredentials();\n  return {\n    client: new Resend(apiKey),\n    fromEmail\n  };\n}\n\nexport interface SendInviteEmailParams {\n  toEmail: string;\n  inviteeName: string;\n  projectName: string;\n  inviterName: string;\n  inviteToken: string;\n  role: string;\n}\n\nexport async function sendInviteEmail(params: SendInviteEmailParams): Promise<boolean> {\n  try {\n    const { client, fromEmail } = await getResendClient();\n    \n    let baseUrl = 'http://localhost:5000';\n    if (process.env.REPLIT_DEPLOYMENT_URL) {\n      baseUrl = process.env.REPLIT_DEPLOYMENT_URL;\n    } else if (process.env.REPLIT_DEV_DOMAIN) {\n      baseUrl = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    }\n    \n    console.log(`[Email] Using base URL for invite: ${baseUrl}`);\n    \n    const inviteUrl = `${baseUrl}/convite/${params.inviteToken}`;\n    \n    const roleLabel = params.role === 'owner' ? 'Proprietário' \n      : params.role === 'manager' ? 'Gerente' \n      : 'Colaborador';\n\n    const htmlContent = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <style>\n    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; }\n    .container { max-width: 600px; margin: 0 auto; padding: 40px 20px; }\n    .header { text-align: center; margin-bottom: 40px; }\n    .header h1 { color: #1a1a2e; margin: 0; font-size: 28px; }\n    .content { background: #f8f9fa; border-radius: 12px; padding: 32px; margin-bottom: 32px; }\n    .project-name { font-size: 20px; font-weight: 600; color: #1a1a2e; margin-bottom: 16px; }\n    .role-badge { display: inline-block; background: #e8f4ff; color: #0066cc; padding: 4px 12px; border-radius: 16px; font-size: 14px; margin-bottom: 16px; }\n    .button { display: inline-block; background: #0066cc; color: white !important; text-decoration: none; padding: 14px 32px; border-radius: 8px; font-weight: 600; margin: 24px 0; }\n    .footer { text-align: center; color: #666; font-size: 14px; }\n    .link-text { word-break: break-all; color: #666; font-size: 12px; margin-top: 16px; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Convite para Projeto</h1>\n    </div>\n    <div class=\"content\">\n      <p>Olá <strong>${params.inviteeName}</strong>,</p>\n      <p><strong>${params.inviterName}</strong> convidou você para participar do projeto:</p>\n      <div class=\"project-name\">${params.projectName}</div>\n      <div class=\"role-badge\">${roleLabel}</div>\n      <p>Clique no botão abaixo para aceitar o convite e criar sua conta:</p>\n      <center>\n        <a href=\"${inviteUrl}\" class=\"button\">Aceitar Convite</a>\n      </center>\n      <p class=\"link-text\">Ou copie e cole este link no seu navegador:<br>${inviteUrl}</p>\n    </div>\n    <div class=\"footer\">\n      <p>Este convite expira em 7 dias.</p>\n      <p>Se você não esperava este e-mail, pode ignorá-lo com segurança.</p>\n    </div>\n  </div>\n</body>\n</html>\n    `;\n\n    const textContent = `\nOlá ${params.inviteeName},\n\n${params.inviterName} convidou você para participar do projeto \"${params.projectName}\" como ${roleLabel}.\n\nClique no link abaixo para aceitar o convite e criar sua conta:\n${inviteUrl}\n\nEste convite expira em 7 dias.\n\nSe você não esperava este e-mail, pode ignorá-lo com segurança.\n    `;\n\n    await client.emails.send({\n      from: fromEmail || 'noreply@resend.dev',\n      to: params.toEmail,\n      subject: `Convite para o projeto: ${params.projectName}`,\n      html: htmlContent,\n      text: textContent,\n    });\n\n    console.log(`Invite email sent successfully to ${params.toEmail}`);\n    return true;\n  } catch (error) {\n    console.error('Failed to send invite email:', error);\n    return false;\n  }\n}\n","path":null,"size_bytes":4793,"size_tokens":null}},"version":2}